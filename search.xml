<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>åˆ©ç”¨Pythonæ‰¹é‡ä¸‹è½½RSSæºå›¾ç‰‡é›†</title>
      <link href="/posts/23cb2647/"/>
      <url>/posts/23cb2647/</url>
      
        <content type="html"><![CDATA[<h2 id="âš ï¸-æ³¨æ„äº‹é¡¹"><a href="#âš ï¸-æ³¨æ„äº‹é¡¹" class="headerlink" title="âš ï¸ æ³¨æ„äº‹é¡¹"></a>âš ï¸ æ³¨æ„äº‹é¡¹</h2><ul><li>è¯·å°Šé‡ç½‘ç«™çš„ç‰ˆæƒå’Œ robots.txt åè®®ã€‚</li><li>è¯·å‹¿å°†å¹¶å‘æ•°è®¾ç½®å¾—è¿‡é«˜ï¼Œè¿‡åº¦é¢‘ç¹çš„è¯·æ±‚å¯èƒ½ä¼šç»™ç›®æ ‡æœåŠ¡å™¨å¸¦æ¥è¾ƒå¤§è´Ÿæ‹…ï¼Œç”šè‡³å¯¼è‡´ä½ IPè¢«å°ç¦ã€‚</li><li>æœ¬è„šæœ¬ä»…ä¾›å­¦ä¹ å’Œä¸ªäººæ”¶è—ç”¨é€”ï¼Œè¯·å‹¿ç”¨äºéæ³•å•†ä¸šæ´»åŠ¨ã€‚</li></ul><h2 id="ğŸ“-æ–‡ä»¶ç»“æ„"><a href="#ğŸ“-æ–‡ä»¶ç»“æ„" class="headerlink" title="ğŸ“ æ–‡ä»¶ç»“æ„"></a>ğŸ“ æ–‡ä»¶ç»“æ„</h2><p>åœ¨è¿è¡Œå‰ï¼Œè¯·ç¡®ä¿æ‚¨çš„é¡¹ç›®æ–‡ä»¶å¤¹åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">â”œâ”€â”€ downloader.py  # ä¸»ç¨‹åºè„šæœ¬</span><br><span class="line">â”œâ”€â”€ config.yaml            # é…ç½®æ–‡ä»¶</span><br><span class="line">â”œâ”€â”€ requirements.txt       # Python ä¾èµ–åº“</span><br><span class="line">â”œâ”€â”€ feeds.opml             # ä½ çš„ RSS è®¢é˜…åˆ—è¡¨ (éœ€è‡ªè¡Œå‡†å¤‡)</span><br><span class="line">â”‚</span><br><span class="line">â”œâ”€â”€ history.db             # (ç¨‹åºé¦–æ¬¡è¿è¡Œåè‡ªåŠ¨ç”Ÿæˆ) ä¸‹è½½å†å²æ•°æ®åº“</span><br><span class="line">â””â”€â”€ downloader_errors.log  # (å‡ºç°é”™è¯¯åè‡ªåŠ¨ç”Ÿæˆ) é”™è¯¯æ—¥å¿—æ–‡ä»¶</span><br></pre></td></tr></table></figure><p><em>(å¯é€‰æ–‡ä»¶)</em></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">â””â”€â”€ cookies.txt            # (å¯é€‰) ç”¨äºæ¨¡æ‹Ÿç™»å½•çš„Cookieæ–‡ä»¶</span><br></pre></td></tr></table></figure><h2 id="ğŸ-ä¸»ç¨‹åº"><a href="#ğŸ-ä¸»ç¨‹åº" class="headerlink" title="ğŸ ä¸»ç¨‹åº"></a>ğŸ ä¸»ç¨‹åº</h2><p><code>downloader.py</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br></pre></td><td class="code"><pre><span class="line">import asyncio</span><br><span class="line">import os</span><br><span class="line">import re</span><br><span class="line">import time</span><br><span class="line">import feedparser</span><br><span class="line">import aiohttp</span><br><span class="line">import aiosqlite</span><br><span class="line">import yaml</span><br><span class="line">import html</span><br><span class="line">import argparse</span><br><span class="line">import logging</span><br><span class="line">import random</span><br><span class="line">from bs4 import BeautifulSoup</span><br><span class="line">from urllib.parse import urlparse, urljoin</span><br><span class="line">from tqdm.asyncio import tqdm as aio_tqdm</span><br><span class="line">from http.cookies import SimpleCookie</span><br><span class="line"></span><br><span class="line"># ==============================================================================</span><br><span class="line"># æ—¥å¿—è®¾ç½®</span><br><span class="line"># ==============================================================================</span><br><span class="line">logger = logging.getLogger(&quot;ä¸‹è½½å™¨&quot;)</span><br><span class="line"></span><br><span class="line">def setup_loggers(console_level=logging.INFO, error_file=&#x27;downloader_errors.log&#x27;):</span><br><span class="line">    &quot;&quot;&quot;é…ç½®æ§åˆ¶å°å’Œæ–‡ä»¶æ—¥å¿—è®°å½•å™¨ã€‚&quot;&quot;&quot;</span><br><span class="line">    if logger.hasHandlers():</span><br><span class="line">        logger.handlers.clear()</span><br><span class="line">        </span><br><span class="line">    logger.setLevel(logging.DEBUG)</span><br><span class="line"></span><br><span class="line">    # 1. æ§åˆ¶å°å¤„ç†å™¨</span><br><span class="line">    console_handler = logging.StreamHandler()</span><br><span class="line">    console_handler.setLevel(console_level)</span><br><span class="line">    console_formatter = logging.Formatter(</span><br><span class="line">        &#x27;%(asctime)s - %(levelname)s - [%(name)s] - %(message)s&#x27;,</span><br><span class="line">        datefmt=&#x27;%Y-%m-%d %H:%M:%S&#x27;</span><br><span class="line">    )</span><br><span class="line">    console_handler.setFormatter(console_formatter)</span><br><span class="line">    logger.addHandler(console_handler)</span><br><span class="line"></span><br><span class="line">    # 2. é”™è¯¯æ–‡ä»¶å¤„ç†å™¨</span><br><span class="line">    try:</span><br><span class="line">        file_handler = logging.FileHandler(error_file, &#x27;a&#x27;, encoding=&#x27;utf-8&#x27;)</span><br><span class="line">        file_handler.setLevel(logging.WARNING)</span><br><span class="line">        file_formatter = logging.Formatter(</span><br><span class="line">            &#x27;%(asctime)s - %(levelname)s - %(message)s&#x27;</span><br><span class="line">        )</span><br><span class="line">        file_handler.setFormatter(file_formatter)</span><br><span class="line">        logger.addHandler(file_handler)</span><br><span class="line">        logger.info(f&quot;é”™è¯¯æ—¥å¿—å°†è®°å½•åˆ°: &#123;os.path.abspath(error_file)&#125;&quot;)</span><br><span class="line">    except Exception as e:</span><br><span class="line">        logger.error(f&quot;æ— æ³•åˆ›å»ºé”™è¯¯æ—¥å¿—æ–‡ä»¶ &#123;error_file&#125;: &#123;e&#125;&quot;)</span><br><span class="line"></span><br><span class="line"># ==============================================================================</span><br><span class="line"># é…ç½®åŠ è½½ä¸æ­£åˆ™è¡¨è¾¾å¼é¢„ç¼–è¯‘</span><br><span class="line"># ==============================================================================</span><br><span class="line">CONFIG = &#123;&#125;</span><br><span class="line">REGEX = &#123;</span><br><span class="line">    &quot;image_file_ext&quot;: re.compile(r&#x27;\.(jpg|jpeg|png|webp|gif)$&#x27;, re.I),</span><br><span class="line">    &quot;blogspot_thumb&quot;: re.compile(r&#x27;/s\d+(-[a-z])?/&#x27;, re.I),</span><br><span class="line">    &quot;thumbnail_resize&quot;: re.compile(r&#x27;-\d+x\d+(\.\w+)$&#x27;),</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">def load_config(path=&#x27;config.yaml&#x27;):</span><br><span class="line">    &quot;&quot;&quot;ä» YAML æ–‡ä»¶åŠ è½½é…ç½®ã€‚&quot;&quot;&quot;</span><br><span class="line">    global CONFIG</span><br><span class="line">    try:</span><br><span class="line">        with open(path, &#x27;r&#x27;, encoding=&#x27;utf-8&#x27;) as f:</span><br><span class="line">            CONFIG = yaml.safe_load(f)</span><br><span class="line">        setup_loggers(error_file=CONFIG.get(&#x27;error_log_file&#x27;, &#x27;downloader_errors.log&#x27;))</span><br><span class="line">        logger.info(&quot;æˆåŠŸä» %s åŠ è½½é…ç½®ã€‚&quot;, path)</span><br><span class="line">    except FileNotFoundError:</span><br><span class="line">        print(f&quot;è‡´å‘½é”™è¯¯: æœªæ‰¾åˆ° &#123;path&#125; æ–‡ä»¶ï¼Œè¯·åˆ›å»ºå®ƒã€‚&quot;)</span><br><span class="line">        exit(1)</span><br><span class="line">    except Exception as e:</span><br><span class="line">        print(f&quot;è‡´å‘½é”™è¯¯: åŠ è½½ &#123;path&#125; å‡ºé”™: &#123;e&#125;&quot;)</span><br><span class="line">        exit(1)</span><br><span class="line"></span><br><span class="line"># ==============================================================================</span><br><span class="line"># æ•°æ®åº“ä¸Cookie (å¼‚æ­¥)</span><br><span class="line"># ==============================================================================</span><br><span class="line">class DatabaseManager:</span><br><span class="line">    &quot;&quot;&quot;å¼‚æ­¥ç®¡ç†ç”¨äºå­˜å‚¨ä¸‹è½½å†å²çš„ SQLite æ•°æ®åº“ (åŸºäºæ–‡ç« æ ‡é¢˜å…¨å±€å»é‡)ã€‚&quot;&quot;&quot;</span><br><span class="line">    def __init__(self, db_path):</span><br><span class="line">        self._db_path = db_path</span><br><span class="line">        self._conn = None</span><br><span class="line"></span><br><span class="line">    async def connect(self):</span><br><span class="line">        try:</span><br><span class="line">            self._conn = await aiosqlite.connect(self._db_path)</span><br><span class="line">            await self._conn.execute(&quot;PRAGMA journal_mode=WAL;&quot;)</span><br><span class="line">            await self._conn.execute(&quot;&quot;&quot;</span><br><span class="line">                CREATE TABLE IF NOT EXISTS download_history (</span><br><span class="line">                    post_title TEXT PRIMARY KEY,</span><br><span class="line">                    download_date TEXT NOT NULL,</span><br><span class="line">                    source_feed TEXT</span><br><span class="line">                )</span><br><span class="line">            &quot;&quot;&quot;)</span><br><span class="line">            await self._conn.commit()</span><br><span class="line">            logger.info(&quot;æ•°æ®åº“è¿æ¥æˆåŠŸ (å…¨å±€å»é‡æ¨¡å¼): %s&quot;, self._db_path)</span><br><span class="line">        except Exception as e:</span><br><span class="line">            logger.error(&quot;æ•°æ®åº“è¿æ¥å¤±è´¥: %s&quot;, e)</span><br><span class="line">            raise</span><br><span class="line"></span><br><span class="line">    async def is_downloaded(self, post_title):</span><br><span class="line">        &quot;&quot;&quot;æ£€æŸ¥ä¸€ä¸ªæ–‡ç« æ ‡é¢˜æ˜¯å¦å·²ç»è¢«ä¸‹è½½è¿‡ã€‚&quot;&quot;&quot;</span><br><span class="line">        async with self._conn.execute(</span><br><span class="line">            &quot;SELECT 1 FROM download_history WHERE post_title = ?&quot;,</span><br><span class="line">            (post_title,)</span><br><span class="line">        ) as cursor:</span><br><span class="line">            return await cursor.fetchone() is not None</span><br><span class="line"></span><br><span class="line">    async def add_entry(self, post_title, feed_title):</span><br><span class="line">        &quot;&quot;&quot;å°†ä¸€ä¸ªæ–‡ç« æ ‡é¢˜æ·»åŠ åˆ°ä¸‹è½½å†å²ä¸­ã€‚&quot;&quot;&quot;</span><br><span class="line">        now = time.strftime(&#x27;%Y-%m-%d %H:%M:%S&#x27;)</span><br><span class="line">        try:</span><br><span class="line">            await self._conn.execute(</span><br><span class="line">                &quot;INSERT OR IGNORE INTO download_history (post_title, download_date, source_feed) VALUES (?, ?, ?)&quot;,</span><br><span class="line">                (post_title, now, feed_title)</span><br><span class="line">            )</span><br><span class="line">            await self._conn.commit()</span><br><span class="line">        except Exception as e:</span><br><span class="line">            logger.error(&quot;æ·»åŠ è®°å½• &#x27;%s&#x27; åˆ°æ•°æ®åº“å¤±è´¥: %s&quot;, post_title, e)</span><br><span class="line"></span><br><span class="line">    async def close(self):</span><br><span class="line">        if self._conn:</span><br><span class="line">            await self._conn.close()</span><br><span class="line">            logger.info(&quot;æ•°æ®åº“è¿æ¥å·²å…³é—­ã€‚&quot;)</span><br><span class="line"></span><br><span class="line">class NetscapeCookieJar(aiohttp.CookieJar):</span><br><span class="line">    &quot;&quot;&quot;ä¸€ä¸ªå¯ä»¥ä» Netscape æ ¼å¼çš„ cookies.txt æ–‡ä»¶åŠ è½½ cookie çš„ CookieJarã€‚&quot;&quot;&quot;</span><br><span class="line">    def __init__(self, cookie_file=None):</span><br><span class="line">        super().__init__()</span><br><span class="line">        if cookie_file and os.path.exists(cookie_file):</span><br><span class="line">            self.load_from_file(cookie_file)</span><br><span class="line"></span><br><span class="line">    def load_from_file(self, cookie_file):</span><br><span class="line">        try:</span><br><span class="line">            with open(cookie_file, &#x27;r&#x27;) as f:</span><br><span class="line">                for line in f:</span><br><span class="line">                    if line.strip().startswith(&#x27;#&#x27;) or not line.strip():</span><br><span class="line">                        continue</span><br><span class="line">                    </span><br><span class="line">                    try:</span><br><span class="line">                        domain, _, path, secure, expires, name, value = line.strip().split(&#x27;\t&#x27;)</span><br><span class="line">                        cookie = SimpleCookie()</span><br><span class="line">                        cookie[name] = value</span><br><span class="line">                        cookie[name][&#x27;path&#x27;] = path</span><br><span class="line">                        cookie[name][&#x27;domain&#x27;] = domain</span><br><span class="line">                        cookie[name][&#x27;expires&#x27;] = int(float(expires))</span><br><span class="line">                        cookie[name][&#x27;secure&#x27;] = secure.upper() == &#x27;TRUE&#x27;</span><br><span class="line">                        self.update_cookies(cookie)</span><br><span class="line">                    except ValueError:</span><br><span class="line">                        logger.warning(f&quot;æ— æ³•è§£æCookieè¡Œ: &#123;line.strip()&#125;&quot;)</span><br><span class="line">                logger.info(f&quot;æˆåŠŸä» &#123;cookie_file&#125; åŠ è½½ Cookiesã€‚&quot;)</span><br><span class="line">        except Exception as e:</span><br><span class="line">            logger.error(f&quot;åŠ è½½Cookiesæ–‡ä»¶ &#123;cookie_file&#125; å¤±è´¥: &#123;e&#125;&quot;)</span><br><span class="line"></span><br><span class="line"># ==============================================================================</span><br><span class="line"># å·¥å…·å‡½æ•°</span><br><span class="line"># ==============================================================================</span><br><span class="line">def sanitize_folder_name(name):</span><br><span class="line">    sanitized = html.unescape(name).strip()</span><br><span class="line">    invalid_chars = r&#x27;[\\/:*?&quot;&lt;&gt;|]&#x27;</span><br><span class="line">    sanitized = re.sub(invalid_chars, &#x27;_&#x27;, sanitized)</span><br><span class="line">    return sanitized or &quot;æœªå‘½å&quot;</span><br><span class="line"></span><br><span class="line">def get_full_image_url(url):</span><br><span class="line">    if &quot;bp.blogspot.com&quot; in url or &quot;googleusercontent.com&quot; in url:</span><br><span class="line">        return REGEX[&quot;blogspot_thumb&quot;].sub(&#x27;/s0/&#x27;, url)</span><br><span class="line">    if REGEX[&quot;thumbnail_resize&quot;].search(url):</span><br><span class="line">        return REGEX[&quot;thumbnail_resize&quot;].sub(r&#x27;\1&#x27;, url)</span><br><span class="line">    return url</span><br><span class="line"></span><br><span class="line"># ==============================================================================</span><br><span class="line"># ç½‘ç»œä¸ä¸‹è½½æ ¸å¿ƒ (å¼‚æ­¥)</span><br><span class="line"># ==============================================================================</span><br><span class="line">async def fetch(session, url, log_prefix=&quot;&quot;):</span><br><span class="line">    for attempt in range(CONFIG.get(&#x27;max_retries&#x27;, 3) + 1):</span><br><span class="line">        try:</span><br><span class="line">            async with session.get(url, timeout=CONFIG.get(&#x27;request_timeout&#x27;, 45), headers=CONFIG.get(&#x27;request_headers&#x27;, &#123;&#125;)) as response:</span><br><span class="line">                response.raise_for_status()</span><br><span class="line">                return await response.text()</span><br><span class="line">        except (aiohttp.ClientError, asyncio.TimeoutError) as e:</span><br><span class="line">            if attempt &lt; CONFIG.get(&#x27;max_retries&#x27;, 3):</span><br><span class="line">                delay = CONFIG.get(&#x27;retry_delay&#x27;, 2) * (2 ** attempt)</span><br><span class="line">                logger.warning(&quot;%sç¬¬ %d/%d æ¬¡æŠ“å– %s å¤±è´¥ã€‚å°†åœ¨ %.1f ç§’åé‡è¯•...&quot;, log_prefix, attempt + 1, CONFIG.get(&#x27;max_retries&#x27;, 3) + 1, url, delay)</span><br><span class="line">                await asyncio.sleep(delay)</span><br><span class="line">            else:</span><br><span class="line">                logger.error(&quot;%sæŠ“å– %s åœ¨ %d æ¬¡é‡è¯•åä»ç„¶å¤±è´¥: %s&quot;, log_prefix, url, CONFIG.get(&#x27;max_retries&#x27;, 3) + 1, e)</span><br><span class="line">                return None</span><br><span class="line"></span><br><span class="line">async def download_image(session, img_url, filepath, referer_url, log_prefix=&quot;&quot;):</span><br><span class="line">    &quot;&quot;&quot;å¼‚æ­¥ä¸‹è½½å•å¼ å›¾ç‰‡ï¼Œå¹¶åœ¨å¤±è´¥æ—¶è®°å½•è¯¦ç»†é”™è¯¯ã€‚&quot;&quot;&quot;</span><br><span class="line">    full_img_url = get_full_image_url(img_url)</span><br><span class="line">    headers = CONFIG.get(&#x27;image_headers&#x27;, &#123;&#125;).copy()</span><br><span class="line">    headers[&#x27;Referer&#x27;] = referer_url</span><br><span class="line">    last_exception = None</span><br><span class="line"></span><br><span class="line">    for attempt in range(CONFIG.get(&#x27;max_retries&#x27;, 3) + 1):</span><br><span class="line">        try:</span><br><span class="line">            async with session.get(full_img_url, timeout=CONFIG.get(&#x27;request_timeout&#x27;, 45), headers=headers) as response:</span><br><span class="line">                if response.status == 404 and full_img_url != img_url:</span><br><span class="line">                    logger.warning(&quot;%sé«˜æ¸…å›¾URL %s è¿”å›404ï¼Œå°è¯•åŸå§‹URL: %s&quot;, log_prefix, full_img_url, img_url)</span><br><span class="line">                    return await download_image(session, img_url, filepath, referer_url, log_prefix)</span><br><span class="line">                </span><br><span class="line">                response.raise_for_status()</span><br><span class="line">                </span><br><span class="line">                content = await response.read()</span><br><span class="line">                os.makedirs(os.path.dirname(filepath), exist_ok=True)</span><br><span class="line">                with open(filepath, &#x27;wb&#x27;) as f:</span><br><span class="line">                    f.write(content)</span><br><span class="line">                return True, os.path.basename(filepath)</span><br><span class="line"></span><br><span class="line">        except (aiohttp.ClientError, asyncio.TimeoutError) as e:</span><br><span class="line">            last_exception = e</span><br><span class="line">            if attempt &lt; CONFIG.get(&#x27;max_retries&#x27;, 3):</span><br><span class="line">                delay = CONFIG.get(&#x27;retry_delay&#x27;, 5) * (2 ** attempt)</span><br><span class="line">                await asyncio.sleep(delay)</span><br><span class="line">            else:</span><br><span class="line">                # æœ€ç»ˆå¤±è´¥æ—¶è®°å½•è¯¦ç»†é”™è¯¯</span><br><span class="line">                error_message = f&quot;é‡è¯• &#123;CONFIG.get(&#x27;max_retries&#x27;, 3) + 1&#125; æ¬¡åå¤±è´¥ã€‚URL: &#123;img_url&#125;&quot;</span><br><span class="line">                logger.error(&quot;%s%s, åº•å±‚é”™è¯¯: %s&quot;, log_prefix, error_message, last_exception, exc_info=False)</span><br><span class="line">                return False, str(last_exception)</span><br><span class="line">    return False, &quot;å·²è¾¾æœ€å¤§é‡è¯•æ¬¡æ•°&quot;</span><br><span class="line"></span><br><span class="line">async def fetch_paginated_content(session, url, log_prefix=&quot;&quot;):</span><br><span class="line">    &quot;&quot;&quot;å¼‚æ­¥è·å–ä¸€ä¸ªåˆ†é¡µæ–‡ç« çš„æ‰€æœ‰é¡µé¢HTMLå†…å®¹ã€‚&quot;&quot;&quot;</span><br><span class="line">    full_html = &quot;&quot;</span><br><span class="line">    current_url = url</span><br><span class="line">    processed_urls = set()</span><br><span class="line">    while current_url and current_url not in processed_urls:</span><br><span class="line">        logger.debug(&quot;%sæ­£åœ¨æŠ“å–åˆ†é¡µå†…å®¹: %s&quot;, log_prefix, current_url)</span><br><span class="line">        processed_urls.add(current_url)</span><br><span class="line">        html_content = await fetch(session, current_url, log_prefix)</span><br><span class="line">        if not html_content:</span><br><span class="line">            break</span><br><span class="line">        soup = BeautifulSoup(html_content, &#x27;html.parser&#x27;)</span><br><span class="line">        content_area = soup.select_one(&#x27;div.entry-content, div.post-content, article.post, div#content&#x27;)</span><br><span class="line">        if content_area:</span><br><span class="line">            full_html += str(content_area)</span><br><span class="line">        else:</span><br><span class="line">            full_html += html_content</span><br><span class="line">        next_page_link = soup.select_one(&#x27;a.next.page-numbers, a[rel=next], .pagination-next a, a:-soup-contains(&quot;Next Page&quot;)&#x27;)</span><br><span class="line">        if next_page_link and next_page_link.get(&#x27;href&#x27;):</span><br><span class="line">            current_url = urljoin(current_url, next_page_link[&#x27;href&#x27;])</span><br><span class="line">            await asyncio.sleep(random.uniform(0.5, 2.0)) # æŠ“å–åˆ†é¡µæ—¶ä¹Ÿå¢åŠ éšæœºå»¶è¿Ÿ</span><br><span class="line">        else:</span><br><span class="line">            current_url = None</span><br><span class="line">    return full_html</span><br><span class="line">    </span><br><span class="line">async def extract_images_from_page(session, article_url, log_prefix=&quot;&quot;):</span><br><span class="line">    &quot;&quot;&quot;(æ›´ç²¾ç¡®ç‰ˆ) ä»ä¸€ä¸ªå¯èƒ½åˆ†é¡µçš„æ–‡ç« ä¸­æå–æ‰€æœ‰å›¾ç‰‡URLã€‚&quot;&quot;&quot;</span><br><span class="line">    full_html_content = await fetch_paginated_content(session, article_url, log_prefix)</span><br><span class="line">    if not full_html_content:</span><br><span class="line">        return []</span><br><span class="line">        </span><br><span class="line">    soup = BeautifulSoup(full_html_content, &#x27;html.parser&#x27;)</span><br><span class="line">    image_urls = set()</span><br><span class="line">    content_area = soup.select_one(&#x27;div.entry-content, div.post-content, article.post, div#content&#x27;)</span><br><span class="line">    search_area = content_area if content_area else soup</span><br><span class="line"></span><br><span class="line">    for img in search_area.find_all(&#x27;img&#x27;):</span><br><span class="line">        src = img.get(&#x27;data-src&#x27;) or img.get(&#x27;src&#x27;)</span><br><span class="line">        if src:</span><br><span class="line">            full_url = urljoin(article_url, src.strip())</span><br><span class="line">            if REGEX[&quot;image_file_ext&quot;].search(full_url.split(&#x27;?&#x27;)[0]):</span><br><span class="line">                image_urls.add(full_url)</span><br><span class="line">    </span><br><span class="line">    return list(image_urls)</span><br><span class="line"></span><br><span class="line"># ==============================================================================</span><br><span class="line"># ä¸»è¦å¤„ç†é€»è¾‘ (å¼‚æ­¥)</span><br><span class="line"># ==============================================================================</span><br><span class="line">async def process_entry(session, db, entry, feed_title):</span><br><span class="line">    &quot;&quot;&quot;å¤„ç†å•ä¸ª RSS æ¡ç›®ï¼Œå¹¶è®°å½•ä¸‹è½½å¤±è´¥ (åŸºäºæ–‡ç« æ ‡é¢˜å…¨å±€å»é‡)ã€‚&quot;&quot;&quot;</span><br><span class="line">    entry_id = getattr(entry, &#x27;id&#x27;, entry.link)</span><br><span class="line">    article_url = entry.link</span><br><span class="line">    log_prefix = f&quot;[&#123;feed_title[:15]&#125;] &quot;</span><br><span class="line"></span><br><span class="line">    # 1. é¦–å…ˆè·å–å¹¶æ¸…ç†æ ‡é¢˜</span><br><span class="line">    post_title = sanitize_folder_name(entry.title)</span><br><span class="line"></span><br><span class="line">    # 2. ä½¿ç”¨æ¸…ç†åçš„æ ‡é¢˜è¿›è¡Œå…¨å±€é‡å¤æ£€æŸ¥</span><br><span class="line">    if not article_url or await db.is_downloaded(post_title):</span><br><span class="line">        if not article_url:</span><br><span class="line">            return 0, 0</span><br><span class="line">        logger.info(&quot;%sæ–‡ç«  &#x27;%s&#x27; å·²åœ¨å…¨å±€å†å²ä¸­å­˜åœ¨ï¼Œè·³è¿‡ã€‚&quot;, log_prefix, post_title)</span><br><span class="line">        return 0, 0</span><br><span class="line">    </span><br><span class="line">    # å¦‚æœæ²¡è·³è¿‡ï¼Œè¯´æ˜æ˜¯æ–°æ–‡ç« ï¼Œç»§ç»­å¤„ç†</span><br><span class="line">    logger.info(&quot;%så¤„ç†æ–°æ–‡ç« : &#x27;%s&#x27;&quot;, log_prefix, post_title)</span><br><span class="line"></span><br><span class="line">    image_urls = []</span><br><span class="line">    html_description = getattr(entry, &#x27;description&#x27;, &#x27;&#x27;)</span><br><span class="line"></span><br><span class="line">    if html_description:</span><br><span class="line">        soup = BeautifulSoup(html_description, &#x27;html.parser&#x27;)</span><br><span class="line">        gallery_div = soup.select_one(&#x27;div.gallery, div#gallery&#x27;)</span><br><span class="line">        if gallery_div:</span><br><span class="line">            links = gallery_div.select(&#x27;a&#x27;)</span><br><span class="line">            for link in links:</span><br><span class="line">                href = link.get(&#x27;href&#x27;)</span><br><span class="line">                if href and REGEX[&quot;image_file_ext&quot;].search(href.split(&#x27;?&#x27;)[0]):</span><br><span class="line">                    image_urls.append(urljoin(article_url, href.strip()))</span><br><span class="line">        </span><br><span class="line">        if not image_urls:</span><br><span class="line">            for img in soup.find_all(&#x27;img&#x27;):</span><br><span class="line">                src = img.get(&#x27;src&#x27;) or img.get(&#x27;data-src&#x27;)</span><br><span class="line">                if src:</span><br><span class="line">                    image_urls.append(urljoin(article_url, src.strip()))</span><br><span class="line"></span><br><span class="line">    if not image_urls and CONFIG.get(&#x27;allow_fallback_to_source_site&#x27;, False):</span><br><span class="line">        logger.warning(&quot;%såœ¨RSSæºä¸­æœªæ‰¾åˆ°å›¾ç‰‡ï¼Œå°†è®¿é—®æºç½‘ç«™: %s&quot;, log_prefix, article_url)</span><br><span class="line">        image_urls = await extract_images_from_page(session, article_url, log_prefix)</span><br><span class="line">    elif image_urls:</span><br><span class="line">        unique_urls = list(dict.fromkeys(image_urls))</span><br><span class="line">        image_urls = unique_urls</span><br><span class="line">        logger.info(&quot;%så·²æˆåŠŸä»RSSæºæè¿°ä¸­æå– %d ä¸ªå›¾ç‰‡åœ°å€ã€‚&quot;, log_prefix, len(image_urls))</span><br><span class="line"></span><br><span class="line">    if not image_urls:</span><br><span class="line">        logger.warning(&quot;%sæ–‡ç«  &#x27;%s&#x27; æœªèƒ½æ‰¾åˆ°ä»»ä½•å›¾ç‰‡ã€‚&quot;, log_prefix, post_title)</span><br><span class="line">        # å°†æ ‡é¢˜æ·»åŠ åˆ°æ•°æ®åº“</span><br><span class="line">        await db.add_entry(post_title, feed_title)</span><br><span class="line">        return 1, 0</span><br><span class="line"></span><br><span class="line">    post_folder = os.path.join(CONFIG[&#x27;base_folder&#x27;], sanitize_folder_name(feed_title), post_title)</span><br><span class="line">    extended_log_prefix = f&quot;[&#123;feed_title&#125;][&#123;post_title&#125;] &quot;</span><br><span class="line"></span><br><span class="line">    tasks = []</span><br><span class="line">    for i, img_url in enumerate(image_urls):</span><br><span class="line">        ext = os.path.splitext(urlparse(img_url).path)[1]</span><br><span class="line">        if not REGEX[&quot;image_file_ext&quot;].search(ext):</span><br><span class="line">            ext = &quot;.jpg&quot;</span><br><span class="line">        filename = f&quot;&#123;i+1:03d&#125;&#123;ext&#125;&quot;</span><br><span class="line">        filepath = os.path.join(post_folder, filename)</span><br><span class="line"></span><br><span class="line">        if not os.path.exists(filepath):</span><br><span class="line">            task = asyncio.create_task(download_image(session, img_url, filepath, article_url, extended_log_prefix))</span><br><span class="line">            tasks.append(task)</span><br><span class="line">        else:</span><br><span class="line">            await asyncio.sleep(0.05)</span><br><span class="line"></span><br><span class="line">    if not tasks:</span><br><span class="line">        logger.info(&quot;%sæ‰€æœ‰ %d å¼ å›¾ç‰‡å‡å·²å­˜åœ¨ï¼Œè·³è¿‡ä¸‹è½½ã€‚&quot;, extended_log_prefix, len(image_urls))</span><br><span class="line">        # å°†æ ‡é¢˜æ·»åŠ åˆ°æ•°æ®åº“</span><br><span class="line">        await db.add_entry(post_title, feed_title)</span><br><span class="line">        return 1, 0</span><br><span class="line"></span><br><span class="line">    # ä½¿ç”¨ asyncio.as_completed æ¥é€ä¸ªå¤„ç†ä¸‹è½½ä»»åŠ¡ï¼Œå¹¶åŠ å…¥éšæœºå»¶æ—¶</span><br><span class="line">    success_count = 0</span><br><span class="line">    pbar = aio_tqdm(total=len(tasks), desc=f&quot;&#123;log_prefix&#125;ä¸‹è½½ &#x27;&#123;post_title[:20]&#125;â€¦&#x27;&quot;, unit=&quot;å¼ &quot;, leave=False)</span><br><span class="line">    for task in asyncio.as_completed(tasks):</span><br><span class="line">        result, _ = await task</span><br><span class="line">        if result:</span><br><span class="line">            success_count += 1</span><br><span class="line">        pbar.update(1)</span><br><span class="line">        # å…³é”®ä¼˜åŒ–ï¼šåœ¨æ¯æ¬¡ä¸‹è½½åéƒ½åŠ å…¥ä¸€ä¸ªéšæœºçš„çŸ­æš‚å»¶æ—¶</span><br><span class="line">        await asyncio.sleep(random.uniform(0.5, 1.5))</span><br><span class="line">    pbar.close()</span><br><span class="line">    </span><br><span class="line">    failed_count = len(tasks) - success_count</span><br><span class="line"></span><br><span class="line">    if failed_count == 0:</span><br><span class="line">        logger.info(&quot;%sæˆåŠŸä¸º &#x27;%s&#x27; ä¸‹è½½ %d å¼ æ–°å›¾ç‰‡ã€‚&quot;, log_prefix, post_title, success_count)</span><br><span class="line">    else:</span><br><span class="line">        logger.error(&quot;%s&#x27;%s&#x27; ä¸‹è½½å®Œæˆï¼Œ%d å¼ æˆåŠŸ, %d å¼ å¤±è´¥ã€‚è¯¦æƒ…è¯·æŸ¥çœ‹é”™è¯¯æ—¥å¿—æ–‡ä»¶ã€‚&quot;, log_prefix, post_title, success_count, failed_count)</span><br><span class="line">        </span><br><span class="line">    # å°†æ ‡é¢˜æ·»åŠ åˆ°æ•°æ®åº“</span><br><span class="line">    await db.add_entry(post_title, feed_title)</span><br><span class="line">    return 1, success_count</span><br><span class="line"></span><br><span class="line">async def process_feed(session, db, feed_info):</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    å¤„ç†å•ä¸ª RSS è®¢é˜…æºã€‚</span><br><span class="line">    ä¼˜å…ˆå°è¯•æ­£å¸¸è§£æï¼Œå¦‚æœå› å†…å®¹éXMLè€Œå¤±è´¥ï¼Œåˆ™è‡ªåŠ¨ä½¿ç”¨æµè§ˆå™¨User-Agenté‡è¯•ã€‚</span><br><span class="line">    &quot;&quot;&quot;</span><br><span class="line">    feed_title, feed_url = feed_info</span><br><span class="line">    log_prefix = f&quot;[&#123;feed_title&#125;] &quot;</span><br><span class="line">    logger.info(&quot;%så¼€å§‹å¤„ç†...&quot;, log_prefix)</span><br><span class="line"></span><br><span class="line">    try:</span><br><span class="line">        # --- æ­¥éª¤ 1: é¦–æ¬¡å°è¯•ï¼Œä¸å¸¦ä»»ä½•ä¼ªè£… ---</span><br><span class="line">        feed_data = await asyncio.to_thread(feedparser.parse, feed_url)</span><br><span class="line"></span><br><span class="line">        # --- æ­¥éª¤ 2: æ£€æŸ¥é¦–æ¬¡å°è¯•æ˜¯å¦å› â€œåçˆ¬è™«â€å¤±è´¥ ---</span><br><span class="line">        if feed_data.bozo and isinstance(feed_data.bozo_exception, feedparser.NonXMLContentType):</span><br><span class="line">            logger.warning(&quot;%sé¦–æ¬¡å°è¯•å¤±è´¥ï¼ŒæœåŠ¡å™¨è¿”å›äº†HTMLé¡µé¢ã€‚æ­£åœ¨åˆ‡æ¢ä¼ªè£…æ¨¡å¼é‡è¯•...&quot;, log_prefix)</span><br><span class="line">            </span><br><span class="line">            # --- æ­¥éª¤ 3: åˆ‡æ¢ä¸ºä¼ªè£…æ¨¡å¼è¿›è¡Œé‡è¯• ---</span><br><span class="line">            agent = CONFIG.get(&#x27;request_headers&#x27;, &#123;&#125;).get(&#x27;User-Agent&#x27;, &#x27;Mozilla/5.0&#x27;)</span><br><span class="line">            feed_data = await asyncio.to_thread(feedparser.parse, feed_url, agent=agent)</span><br><span class="line"></span><br><span class="line">        # --- æ­¥éª¤ 4: æ£€æŸ¥æœ€ç»ˆç»“æœ ---</span><br><span class="line">        if feed_data.bozo:</span><br><span class="line">            logger.warning(&quot;%sè®¢é˜…æºå¯èƒ½æ ¼å¼é”™è¯¯æˆ–æ— æ³•è®¿é—®: %s. é”™è¯¯: %s&quot;, log_prefix, feed_url, feed_data.bozo_exception)</span><br><span class="line">        </span><br><span class="line">        # åç»­é€»è¾‘ä¿æŒä¸å˜</span><br><span class="line">        entry_tasks = [process_entry(session, db, entry, feed_title) for entry in feed_data.entries]</span><br><span class="line">        results = await asyncio.gather(*entry_tasks)</span><br><span class="line">        </span><br><span class="line">        total_new_entries = sum(r[0] for r in results)</span><br><span class="line">        total_new_images = sum(r[1] for r in results)</span><br><span class="line"></span><br><span class="line">        logger.info(&quot;%så¤„ç†å®Œæ¯•ã€‚å‘ç° %d ç¯‡æ–°æ–‡ç« ï¼Œä¸‹è½½äº† %d å¼ æ–°å›¾ç‰‡ã€‚&quot;, log_prefix, total_new_entries, total_new_images)</span><br><span class="line">        return total_new_entries, total_new_images</span><br><span class="line">        </span><br><span class="line">    except Exception as e:</span><br><span class="line">        logger.error(&quot;%så¤„ç†æ—¶å‘ç”Ÿæ„å¤–é”™è¯¯: %s&quot;, log_prefix, e, exc_info=True)</span><br><span class="line">        return 0, 0</span><br><span class="line"></span><br><span class="line">async def main():</span><br><span class="line">    &quot;&quot;&quot;å¼‚æ­¥ä¸»å‡½æ•°ï¼Œè¿è¡Œä¸‹è½½å™¨ã€‚&quot;&quot;&quot;</span><br><span class="line">    load_config()</span><br><span class="line"></span><br><span class="line">    os.makedirs(CONFIG[&#x27;base_folder&#x27;], exist_ok=True)</span><br><span class="line">    db_path = os.path.join(CONFIG[&#x27;base_folder&#x27;], CONFIG[&#x27;db_file&#x27;])</span><br><span class="line">    db = DatabaseManager(db_path)</span><br><span class="line">    await db.connect()</span><br><span class="line"></span><br><span class="line">    try:</span><br><span class="line">        # å¦‚æœé…ç½®äº†cookieæ–‡ä»¶åˆ™åŠ è½½ï¼Œå¦åˆ™å¿½ç•¥</span><br><span class="line">        cookie_file = CONFIG.get(&#x27;cookie_file&#x27;)</span><br><span class="line">        if cookie_file and not os.path.exists(cookie_file):</span><br><span class="line">            logger.warning(f&quot;é…ç½®äº†cookieæ–‡ä»¶ &#x27;&#123;cookie_file&#125;&#x27; ä½†æ–‡ä»¶ä¸å­˜åœ¨ï¼Œå°†ä¸åŠ è½½Cookieã€‚&quot;)</span><br><span class="line">            cookie_jar = aiohttp.CookieJar()</span><br><span class="line">        else:</span><br><span class="line">            cookie_jar = NetscapeCookieJar(cookie_file)</span><br><span class="line"></span><br><span class="line">        connector = aiohttp.TCPConnector(limit_per_host=CONFIG.get(&#x27;max_concurrent_downloads&#x27;, 8))</span><br><span class="line">        </span><br><span class="line">        async with aiohttp.ClientSession(connector=connector, cookie_jar=cookie_jar) as session:</span><br><span class="line">            with open(CONFIG[&#x27;opml_file&#x27;], &#x27;r&#x27;, encoding=&#x27;utf-8&#x27;) as f:</span><br><span class="line">                opml_data = f.read()</span><br><span class="line">            </span><br><span class="line">            opml_soup = BeautifulSoup(opml_data, &#x27;xml&#x27;)</span><br><span class="line">            all_feeds = [</span><br><span class="line">                (outline.get(&#x27;text&#x27;, &#x27;æœªå‘½åæº&#x27;), outline.get(&#x27;xmlUrl&#x27;))</span><br><span class="line">                for outline in opml_soup.find_all(&#x27;outline&#x27;) if outline.get(&#x27;xmlUrl&#x27;)</span><br><span class="line">            ]</span><br><span class="line">            feeds_to_process = [f for f in all_feeds if f[0] not in CONFIG.get(&#x27;skip_feeds&#x27;, [])]</span><br><span class="line">            logger.info(&quot;åœ¨ %s ä¸­å‘ç° %d ä¸ªè®¢é˜…æºã€‚å°†å¤„ç† %d ä¸ªã€‚&quot;, CONFIG[&#x27;opml_file&#x27;], len(all_feeds), len(feeds_to_process))</span><br><span class="line"></span><br><span class="line">            stats = &#123;&#x27;new_entries&#x27;: 0, &#x27;new_images&#x27;: 0&#125;</span><br><span class="line">            </span><br><span class="line">            semaphore = asyncio.Semaphore(CONFIG.get(&#x27;max_concurrent_feeds&#x27;, 4))</span><br><span class="line">            </span><br><span class="line">            async def run_with_semaphore(feed_info):</span><br><span class="line">                async with semaphore:</span><br><span class="line">                    return await process_feed(session, db, feed_info)</span><br><span class="line"></span><br><span class="line">            feed_tasks = [run_with_semaphore(feed) for feed in feeds_to_process]</span><br><span class="line">            </span><br><span class="line">            for future in aio_tqdm.as_completed(feed_tasks, total=len(feed_tasks), desc=&quot;å¤„ç†è®¢é˜…æº&quot;, unit=&quot;ä¸ª&quot;):</span><br><span class="line">                new_entries, new_images = await future</span><br><span class="line">                stats[&#x27;new_entries&#x27;] += new_entries</span><br><span class="line">                stats[&#x27;new_images&#x27;] += new_images</span><br><span class="line"></span><br><span class="line">            logger.info(&quot;=&quot; * 60)</span><br><span class="line">            logger.info(&quot;æ‰€æœ‰è®¢é˜…æºå¤„ç†å®Œæ¯•ã€‚&quot;)</span><br><span class="line">            logger.info(&quot;æ€»è®¡å¤„ç†æ–°æ–‡ç« : %d ç¯‡&quot;, stats[&#x27;new_entries&#x27;])</span><br><span class="line">            logger.info(&quot;æ€»è®¡ä¸‹è½½æ–°å›¾ç‰‡: %d å¼ &quot;, stats[&#x27;new_images&#x27;])</span><br><span class="line">            logger.info(&quot;æ•°æ®åº“ä½äº: %s&quot;, os.path.abspath(db_path))</span><br><span class="line">            logger.info(&quot;=&quot; * 60)</span><br><span class="line"></span><br><span class="line">    except FileNotFoundError as e:</span><br><span class="line">        logger.error(&quot;æœªæ‰¾åˆ°å…³é”®æ–‡ä»¶: %s&quot;, e)</span><br><span class="line">    except Exception as e:</span><br><span class="line">        logger.critical(&quot;ä¸»ç¨‹åºå‘ç”Ÿä¸¥é‡é”™è¯¯: %s&quot;, e, exc_info=True)</span><br><span class="line">    finally:</span><br><span class="line">        await db.close()</span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    parser = argparse.ArgumentParser(</span><br><span class="line">        description=&#x27;å¼‚æ­¥ RSS å›¾ç‰‡ä¸‹è½½å™¨ (æœ€ç»ˆä¼˜åŒ–ç‰ˆ - æ¨¡æ‹Ÿäººç±»è¡Œä¸º)&#x27;,</span><br><span class="line">        formatter_class=argparse.RawTextHelpFormatter</span><br><span class="line">    )</span><br><span class="line">    parser.add_argument(&#x27;--daemon&#x27;, action=&#x27;store_true&#x27;, help=&#x27;ä»¥å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼è¿è¡Œï¼ŒæŒ‰å›ºå®šé—´éš”é‡å¤æ‰§è¡Œã€‚&#x27;)</span><br><span class="line">    parser.add_argument(</span><br><span class="line">        &#x27;--interval&#x27;, </span><br><span class="line">        type=int, </span><br><span class="line">        default=7200, </span><br><span class="line">        help=&#x27;å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼ä¸‹çš„æ£€æŸ¥é—´éš”ï¼ˆç§’ï¼‰ã€‚\né»˜è®¤å€¼: 7200 (2å°æ—¶)ã€‚&#x27;</span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    args = parser.parse_args()</span><br><span class="line"></span><br><span class="line">    if not args.daemon:</span><br><span class="line">        try:</span><br><span class="line">            asyncio.run(main())</span><br><span class="line">        except KeyboardInterrupt:</span><br><span class="line">            logger.info(&quot;ç”¨æˆ·ä¸­æ–­äº†ç¨‹åºã€‚æ­£åœ¨å…³é—­...&quot;)</span><br><span class="line">    else:</span><br><span class="line">        logger.info(f&quot;å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼å·²å¯åŠ¨ï¼Œè¿è¡Œé—´éš”ä¸º &#123;args.interval&#125; ç§’ (&#123;args.interval / 3600:.1f&#125; å°æ—¶)ã€‚&quot;)</span><br><span class="line">        while True:</span><br><span class="line">            start_time = time.time()</span><br><span class="line">            try:</span><br><span class="line">                logger.info(&quot;å¼€å§‹æ–°ä¸€è½®çš„æ£€æŸ¥ä¸ä¸‹è½½...&quot;)</span><br><span class="line">                asyncio.run(main())</span><br><span class="line">            except KeyboardInterrupt:</span><br><span class="line">                logger.info(&quot;å®ˆæŠ¤è¿›ç¨‹è¢«ç”¨æˆ·ä¸­æ–­ã€‚æ­£åœ¨é€€å‡º...&quot;)</span><br><span class="line">                break</span><br><span class="line">            except Exception as e:</span><br><span class="line">                logger.critical(f&quot;å®ˆæŠ¤è¿›ç¨‹åœ¨æ‰§è¡Œä»»åŠ¡æ—¶å‘ç”Ÿä¸¥é‡é”™è¯¯: &#123;e&#125;&quot;, exc_info=True)</span><br><span class="line">            </span><br><span class="line">            end_time = time.time()</span><br><span class="line">            elapsed = end_time - start_time</span><br><span class="line">            sleep_time = max(60, args.interval - elapsed)</span><br><span class="line">            </span><br><span class="line">            next_run_time_str = time.strftime(&#x27;%Y-%m-%d %H:%M:%S&#x27;, time.localtime(time.time() + sleep_time))</span><br><span class="line">            logger.info(f&quot;æœ¬è½®ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œè€—æ—¶ &#123;elapsed:.1f&#125; ç§’ã€‚å°†åœ¨ &#123;sleep_time:.1f&#125; ç§’åå¼€å§‹ä¸‹ä¸€è½®ï¼ˆé¢„è®¡æ—¶é—´: &#123;next_run_time_str&#125;ï¼‰ã€‚&quot;)</span><br><span class="line">            time.sleep(sleep_time)</span><br></pre></td></tr></table></figure><h2 id="âš™ï¸-é…ç½®æ–‡ä»¶"><a href="#âš™ï¸-é…ç½®æ–‡ä»¶" class="headerlink" title="âš™ï¸ é…ç½®æ–‡ä»¶"></a>âš™ï¸ é…ç½®æ–‡ä»¶</h2><p><code>config.yaml</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"># ==============================================================================</span><br><span class="line"># é€šç”¨è®¾ç½®</span><br><span class="line"># ==============================================================================</span><br><span class="line"># æ‰€æœ‰ä¸‹è½½å†…å®¹çš„æ ¹ç›®å½•</span><br><span class="line">base_folder: &quot;photos&quot;</span><br><span class="line"># æ•°æ®åº“æ–‡ä»¶å (å°†åœ¨æ ¹ç›®å½•å†…åˆ›å»º)</span><br><span class="line">db_file: &quot;history.db&quot;</span><br><span class="line"># åŒ…å« RSS è®¢é˜…æºçš„ OPML æ–‡ä»¶</span><br><span class="line">opml_file: &quot;feeds.opml&quot;</span><br><span class="line"># ç”¨äºå­˜å‚¨é”™è¯¯å’Œå¤±è´¥è®°å½•çš„æ—¥å¿—æ–‡ä»¶</span><br><span class="line">error_log_file: &quot;downloader_errors.log&quot;</span><br><span class="line"># éœ€è¦è·³è¿‡å¤„ç†çš„è®¢é˜…æºæ ‡é¢˜åˆ—è¡¨</span><br><span class="line">skip_feeds:</span><br><span class="line">  - &quot;ç¤ºä¾‹ï¼šéœ€è¦è·³è¿‡çš„è®¢é˜…æº&quot;</span><br><span class="line"></span><br><span class="line"># æ˜¯å¦å…è®¸åœ¨RSSå†…å®¹ä¸ºç©ºæ—¶ï¼Œå›é€€åˆ°è®¿é—®åŸå§‹ç½‘ç«™é“¾æ¥ã€‚</span><br><span class="line"># å¯¹äºå†…å®¹å®Œæ•´çš„RSSæºï¼Œå¼ºçƒˆå»ºè®®è®¾ä¸º falseï¼Œå¯ä»¥æ ¹é™¤æŠ“å–åˆ°ç½‘ç«™æ¨èå›¾çš„é—®é¢˜ã€‚</span><br><span class="line"># å¦‚æœæœ‰ä¸€äº›åªæä¾›æ‘˜è¦çš„RSSæºï¼Œåˆ™éœ€è¦è®¾ä¸º trueã€‚</span><br><span class="line">allow_fallback_to_source_site: false</span><br><span class="line"></span><br><span class="line"># ==============================================================================</span><br><span class="line"># å¹¶å‘ä¸å»¶è¿Ÿè®¾ç½®</span><br><span class="line"># ==============================================================================</span><br><span class="line"># åŒæ—¶å¤„ç†çš„è®¢é˜…æºæœ€å¤§æ•°é‡</span><br><span class="line">max_concurrent_feeds: 1</span><br><span class="line"># æ¯ä¸ªæ¡ç›®åŒæ—¶ä¸‹è½½å›¾ç‰‡çš„æœ€å¤§æ•°é‡</span><br><span class="line">max_concurrent_downloads: 8</span><br><span class="line"># é€šç”¨ç½‘ç»œè¯·æ±‚è¶…æ—¶æ—¶é—´ (ç§’)</span><br><span class="line">request_timeout: 45</span><br><span class="line"># å¤±è´¥åé‡è¯•çš„åŸºç¡€å»¶è¿Ÿæ—¶é—´ (ç§’)</span><br><span class="line">retry_delay: 10</span><br><span class="line"># å•ä¸ªè¯·æ±‚å¤±è´¥åçš„æœ€å¤§é‡è¯•æ¬¡æ•°</span><br><span class="line">max_retries: 10</span><br><span class="line"></span><br><span class="line"># ==============================================================================</span><br><span class="line"># ç½‘ç»œè¯·æ±‚å¤´</span><br><span class="line"># ==============================================================================</span><br><span class="line"># ç”¨äºæŠ“å– RSS å’Œ HTML é¡µé¢çš„è¯·æ±‚å¤´</span><br><span class="line">request_headers:</span><br><span class="line">  User-Agent: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/125.0.0.0 Safari/537.36&quot;</span><br><span class="line">  Accept: &quot;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8&quot;</span><br><span class="line">  Accept-Language: &quot;en-US,en;q=0.9,zh-CN;q=0.8&quot;</span><br><span class="line"></span><br><span class="line"># ç”¨äºä¸‹è½½å›¾ç‰‡çš„è¯·æ±‚å¤´</span><br><span class="line">image_headers:</span><br><span class="line">  User-Agent: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/125.0.0.0 Safari/537.36&quot;</span><br><span class="line">  Accept: &quot;image/webp,image/apng,image/*,*/*;q=0.8&quot;</span><br><span class="line"></span><br><span class="line"># ==============================================================================</span><br><span class="line"># æ–‡ä»¶å¤¹ä¸æ–‡ä»¶åè§„åˆ™</span><br><span class="line"># ==============================================================================</span><br><span class="line">folder_name_rules:</span><br><span class="line">  max_length: 150</span><br><span class="line">  # éœ€è¦è¢«æ›¿æ¢çš„ç‰¹æ®Šå­—ç¬¦</span><br><span class="line">  replace_chars:</span><br><span class="line">    &#x27;[&#x27;: &#x27;ã€&#x27;</span><br><span class="line">    &#x27;]&#x27;: &#x27;ã€‘&#x27;</span><br><span class="line">    &#x27;:&#x27;: &#x27;ï¼š&#x27;</span><br><span class="line">    &#x27;*&#x27;: &#x27;ï¼Š&#x27;</span><br><span class="line">    &#x27;?&#x27;: &#x27;ï¼Ÿ&#x27;</span><br><span class="line">    &#x27;&quot;&#x27;: &#x27;â€œ&#x27;</span><br><span class="line">    &#x27;&lt;&#x27;: &#x27;ï¼œ&#x27;</span><br><span class="line">    &#x27;&gt;&#x27;: &#x27;ï¼&#x27;</span><br><span class="line">    &#x27;|&#x27;: &#x27;ï½œ&#x27;</span><br></pre></td></tr></table></figure><h2 id="ğŸ“¡-æ¼”ç¤ºRSSæº"><a href="#ğŸ“¡-æ¼”ç¤ºRSSæº" class="headerlink" title="ğŸ“¡ æ¼”ç¤ºRSSæº"></a>ğŸ“¡ æ¼”ç¤ºRSSæº</h2><p><code>feeds.opml</code> </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;opml version=&quot;2.0&quot;&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;title&gt;My RSS Feeds&lt;/title&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;outline text=&quot;ğŸ–¼ï¸å›¾ç‰‡ç”»å»Š&quot;&gt;</span><br><span class="line">      &lt;outline text=&quot;80K - å†™çœŸç½‘&quot; type=&quot;rss&quot; xmlUrl=&quot;https://127.0.0.1&quot; htmlUrl=&quot;https://127.0.0.1&quot;/&gt;</span><br><span class="line">    &lt;/outline&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/opml&gt;</span><br></pre></td></tr></table></figure><h2 id="ğŸ”—-è„šæœ¬ä¾èµ–"><a href="#ğŸ”—-è„šæœ¬ä¾èµ–" class="headerlink" title="ğŸ”— è„šæœ¬ä¾èµ–"></a>ğŸ”— è„šæœ¬ä¾èµ–</h2><p><code>requirements.txt</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">aiohttp[cchardet,aiodns]</span><br><span class="line">aiosqlite</span><br><span class="line">beautifulsoup4</span><br><span class="line">feedparser</span><br><span class="line">PyYAML</span><br><span class="line">tqdm</span><br><span class="line">lxm</span><br></pre></td></tr></table></figure><h2 id="ğŸš€-å®‰è£…ä¸è®¾ç½®"><a href="#ğŸš€-å®‰è£…ä¸è®¾ç½®" class="headerlink" title="ğŸš€ å®‰è£…ä¸è®¾ç½®"></a>ğŸš€ å®‰è£…ä¸è®¾ç½®</h2><h4 id="1-ç¯å¢ƒå‡†å¤‡"><a href="#1-ç¯å¢ƒå‡†å¤‡" class="headerlink" title="1. ç¯å¢ƒå‡†å¤‡"></a>1. ç¯å¢ƒå‡†å¤‡</h4><p>å®‰è£… <strong>Python</strong> </p><h4 id="2-è·å–æ–‡ä»¶"><a href="#2-è·å–æ–‡ä»¶" class="headerlink" title="2. è·å–æ–‡ä»¶"></a>2. è·å–æ–‡ä»¶</h4><p>æŠŠåˆ›å»ºçš„æ‰€æœ‰æ–‡ä»¶ (<code>.py</code>, <code>.yaml</code>, <code>feeds.opml</code>,<code>.txt</code>) å¹¶å°†å®ƒä»¬æ”¾åœ¨åŒä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­ã€‚</p><h4 id="3-å®‰è£…ä¾èµ–"><a href="#3-å®‰è£…ä¾èµ–" class="headerlink" title="3. å®‰è£…ä¾èµ–"></a>3. å®‰è£…ä¾èµ–</h4><p>è¿›å…¥é¡¹ç›®æ‰€åœ¨çš„æ–‡ä»¶å¤¹ï¼Œæ‰“å¼€ç»ˆç«¯ ï¼Œç„¶åè¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å®‰è£…æ‰€æœ‰å¿…éœ€çš„ Python åº“ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install -r requirements.txt</span><br></pre></td></tr></table></figure><p><strong>ä¸»è¦ä¾èµ–åº“åŒ…æ‹¬</strong>: <code>aiohttp</code>, <code>aiosqlite</code>, <code>beautifulsoup4</code>, <code>feedparser</code>, <code>pyyaml</code>, <code>tqdm</code>, <code>lxm</code>ã€‚</p><h2 id="âš™ï¸-é…ç½®è¯´æ˜"><a href="#âš™ï¸-é…ç½®è¯´æ˜" class="headerlink" title="âš™ï¸ é…ç½®è¯´æ˜"></a>âš™ï¸ é…ç½®è¯´æ˜</h2><h4 id="1-é…ç½®è®¢é˜…æº-feeds-opml"><a href="#1-é…ç½®è®¢é˜…æº-feeds-opml" class="headerlink" title="1. é…ç½®è®¢é˜…æº (feeds.opml)"></a>1. é…ç½®è®¢é˜…æº (<code>feeds.opml</code>)</h4><p>æœ€å…³é”®çš„ä¸€æ­¥ã€‚ä»RSS é˜…è¯»å™¨ï¼ˆå¦‚ Feedly, Inoreader, Freshrss ç­‰ï¼‰ä¸­ï¼Œå°†æ‚¨çš„è®¢é˜…æºå¯¼å‡ºä¸º OPML æ–‡ä»¶æ ¼å¼ã€‚å°†å¯¼å‡ºçš„æ–‡ä»¶å‘½åä¸º <code>feeds.opml</code> å¹¶æ”¾å…¥é¡¹ç›®æ–‡ä»¶å¤¹ã€‚</p><blockquote><p><strong>æç¤º</strong>: è¯·ç¡®ä¿å¯¼å‡ºçš„ OPML æ–‡ä»¶æ˜¯ UTF-8 ç¼–ç ï¼Œä»¥é¿å…è§£æé”™è¯¯ã€‚</p></blockquote><h4 id="2-è°ƒæ•´ä¸»é…ç½®-config-yaml"><a href="#2-è°ƒæ•´ä¸»é…ç½®-config-yaml" class="headerlink" title="2. è°ƒæ•´ä¸»é…ç½® (config.yaml)"></a>2. è°ƒæ•´ä¸»é…ç½® (<code>config.yaml</code>)</h4><p>æ‰“å¼€ <code>config.yaml</code> æ–‡ä»¶ï¼Œæ ¹æ®é‡Œé¢çš„ä¸­æ–‡æ³¨é‡Šä¿®æ”¹é…ç½®é¡¹ã€‚æœ€é‡è¦çš„å‡ é¡¹æ˜¯ï¼š</p><ul><li><code>base_folder</code>: å›¾ç‰‡ä¿å­˜çš„ç›®å½•ã€‚</li><li><strong>åçˆ¬è™«ç­–ç•¥ç›¸å…³</strong>:<ul><li><code>max_concurrent_feeds</code>: åŒæ—¶å¤„ç†çš„ç½‘ç«™ï¼ˆè®¢é˜…æºï¼‰æ•°é‡ã€‚<strong>å»ºè®®é¦–æ¬¡è¿è¡Œæˆ–é‡åˆ°é¢‘ç¹å¤±è´¥æ—¶è®¾ä¸º <code>1</code></strong>ã€‚</li><li><code>max_concurrent_downloads</code>: åŒæ—¶ä¸‹è½½çš„å›¾ç‰‡æ•°é‡ã€‚<strong>å»ºè®®è®¾ä¸º <code>1</code> åˆ° <code>8</code> ä¹‹é—´ï¼Œæ•°å€¼è¶Šå°è¶Šä¸å®¹æ˜“è¢«å°é”</strong>ã€‚</li><li><code>retry_delay</code>: æ¯æ¬¡é‡è¯•çš„åŸºç¡€ç­‰å¾…æ—¶é—´ï¼ˆç§’ï¼‰ã€‚<strong>å¦‚æœé¢‘ç¹å¤±è´¥ï¼Œå¯ä»¥é€‚å½“å¢åŠ æ­¤å€¼ï¼Œä¾‹å¦‚ <code>10</code></strong>ã€‚</li></ul></li><li><code>(å¯é€‰) Cookie é…ç½®</code>:<ul><li><code>cookie_file</code>: å¦‚æœè¦ä¸‹è½½ç™»å½•åæ‰èƒ½è®¿é—®çš„å†…å®¹ï¼Œå¯ä»¥åœ¨æ­¤æŒ‡å®š <code>cookies.txt</code> æ–‡ä»¶çš„è·¯å¾„ã€‚</li></ul></li></ul><h2 id="â–¶ï¸-å¦‚ä½•ä½¿ç”¨"><a href="#â–¶ï¸-å¦‚ä½•ä½¿ç”¨" class="headerlink" title="â–¶ï¸ å¦‚ä½•ä½¿ç”¨"></a>â–¶ï¸ å¦‚ä½•ä½¿ç”¨</h2><h4 id="é¦–æ¬¡è¿è¡Œå»ºè®®"><a href="#é¦–æ¬¡è¿è¡Œå»ºè®®" class="headerlink" title="é¦–æ¬¡è¿è¡Œå»ºè®®"></a>é¦–æ¬¡è¿è¡Œå»ºè®®</h4><ol><li>å°† <code>config.yaml</code> ä¸­çš„ <code>max_concurrent_feeds</code> å’Œ <code>max_concurrent_downloads</code> éƒ½è®¾ç½®ä¸º <code>1</code>ã€‚</li><li>è¿è¡Œè„šæœ¬è¿›è¡Œæµ‹è¯•ã€‚</li><li>å¦‚æœä¸‹è½½ç¨³å®šï¼Œå†é€æ­¥è°ƒé«˜å¹¶å‘æ•°ï¼Œæ‰¾åˆ°é€Ÿåº¦å’Œç¨³å®šæ€§çš„å¹³è¡¡ç‚¹ã€‚</li></ol><h4 id="å¯åŠ¨å‘½ä»¤"><a href="#å¯åŠ¨å‘½ä»¤" class="headerlink" title="å¯åŠ¨å‘½ä»¤"></a>å¯åŠ¨å‘½ä»¤</h4><p>å®Œæˆæ‰€æœ‰é…ç½®åï¼Œåœ¨ç»ˆç«¯ä¸­è¿›å…¥é¡¹ç›®æ–‡ä»¶å¤¹ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤å³å¯å¯åŠ¨è„šæœ¬ï¼š</p><p><strong>1. æ ‡å‡†æ¨¡å¼ï¼š</strong> (è¿è¡Œä¸€æ¬¡åè‡ªåŠ¨é€€å‡º)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python downloader.py</span><br></pre></td></tr></table></figure><p><strong>2. å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼ï¼š</strong> (ä½¿ç”¨é»˜è®¤çš„2å°æ—¶é—´éš”ï¼Œåœ¨åå°æŒç»­è¿è¡Œ)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python downloader.py --daemon</span><br></pre></td></tr></table></figure><p><strong>3. å®ˆæŠ¤è¿›ç¨‹æ¨¡å¼ + è‡ªå®šä¹‰é—´éš”ï¼š</strong> (æ¯30åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python downloader.py --daemon --interval 1800</span><br></pre></td></tr></table></figure><p>è„šæœ¬å°†å¼€å§‹è¯»å– <code>feeds.opml</code>ï¼Œæ£€æŸ¥æ•°æ®åº“å†å²è®°å½•ï¼Œå¹¶ä¸‹è½½æ‰€æœ‰æ–°çš„å›¾é›†ã€‚æ‚¨å¯ä»¥åœ¨æ§åˆ¶å°çœ‹åˆ°è¯¦ç»†çš„è¿›åº¦å’Œæ—¥å¿—ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Python </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æˆ‘ä¸ºä»€ä¹ˆä¸æ³¨å†Œäº’è”ç½‘è´¦å·</title>
      <link href="/posts/e50f2787/"/>
      <url>/posts/e50f2787/</url>
      
        <content type="html"><![CDATA[<p><img src="https://cloudflare.free-img.ososo.org/file/blog/1744864564395_Image2025.4.17.12_16_44.png" alt="å›¾ç‰‡"></p>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>è®°å½•ä¸€ä¸‹åœ¨å°ç±³ä¸‡å…†è·¯ç”±å™¨ä¸Šå®‰è£… Entware</title>
      <link href="/posts/88614452/"/>
      <url>/posts/88614452/</url>
      
        <content type="html"><![CDATA[<p><strong>å‰è¨€ï¼š</strong></p><p>Entware æ˜¯ä¸€ä¸ªé€‚ç”¨äºåµŒå…¥å¼è®¾å¤‡çš„è½¯ä»¶åŒ…ç®¡ç†å™¨ï¼Œå¯ä»¥è®©ä½ æ–¹ä¾¿åœ°å®‰è£…å„ç§è½¯ä»¶ï¼Œä¾‹å¦‚ <code>nano</code>ã€<code>htop</code>ã€<code>aria2</code> ç­‰ï¼Œæ‰©å±•è·¯ç”±å™¨çš„åŠŸèƒ½ã€‚</p><p><strong>é‡è¦æç¤ºï¼š</strong></p><ul><li><strong>åˆ·æœºæœ‰é£é™©ï¼Œè¯·åŠ¡å¿…å¤‡ä»½è·¯ç”±å™¨å›ºä»¶ï¼</strong> å¦‚æœæ“ä½œä¸å½“ï¼Œå¯èƒ½ä¼šå¯¼è‡´è·¯ç”±å™¨å˜ç –ã€‚ å¼ºçƒˆå»ºè®®åœ¨è¿›è¡Œä»»ä½•æ“ä½œä¹‹å‰å¤‡ä»½å½“å‰çš„è·¯ç”±å™¨å›ºä»¶ã€‚</li><li><strong>å°ç±³å®˜æ–¹å›ºä»¶é»˜è®¤ä¸æ”¯æŒ Entwareï¼Œåˆ·å…¥éœ€è¦è§£é”SSH</strong> æœ¬æ•™ç¨‹ä»¥å‡è®¾ä½ å·²ç»è§£é”äº† SSH ã€‚</li><li><strong>ä¸åŒå›ºä»¶ç‰ˆæœ¬å¯èƒ½ä¼šæœ‰å·®å¼‚ï¼Œè¯·æ ¹æ®ä½ çš„å®é™…æƒ…å†µè¿›è¡Œè°ƒæ•´ã€‚</strong> ä»”ç»†é˜…è¯»ä½ çš„å›ºä»¶æ–‡æ¡£ï¼Œå¹¶æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œä¿®æ”¹ã€‚</li><li><strong>æœ¬æ•™ç¨‹ä½¿ç”¨å¤–æ¥å­˜å‚¨è®¾å¤‡ï¼ˆU ç›˜æˆ–ç§»åŠ¨ç¡¬ç›˜ï¼‰æ¥å­˜å‚¨ Entware è½¯ä»¶åŒ…ã€‚</strong> å»ºè®®ä½¿ç”¨ USB 3.0 çš„å­˜å‚¨è®¾å¤‡ä»¥è·å¾—æ›´å¥½çš„æ€§èƒ½ã€‚</li></ul><p><strong>å‡†å¤‡å·¥ä½œï¼š</strong></p><ol><li><strong>å°ç±³ä¸‡å…†è·¯ç”±å™¨ï¼š</strong> å·²ç»è§£é” SSH ã€‚</li><li><strong>å¤–æ¥å­˜å‚¨è®¾å¤‡ï¼š</strong> U ç›˜æˆ–ç§»åŠ¨ç¡¬ç›˜ï¼Œå»ºè®® 100GB å·¦å³ï¼Œæ ¼å¼åŒ–ä¸º ext4 æ ¼å¼ã€‚ ç¡®ä¿ä½ çš„å­˜å‚¨è®¾å¤‡æœ‰è¶³å¤Ÿçš„ç©ºé—´ã€‚</li><li><strong>SSH å®¢æˆ·ç«¯ï¼š</strong> ä¾‹å¦‚ PuTTY (Windows) æˆ– Terminal (macOS&#x2F;Linux)ã€‚</li><li><strong>ç¨³å®šçš„ç½‘ç»œè¿æ¥ï¼š</strong> å®‰è£…è¿‡ç¨‹éœ€è¦ä¸‹è½½è½¯ä»¶åŒ…ï¼Œéœ€è¦ç¨³å®šçš„ç½‘ç»œè¿æ¥ã€‚</li></ol><p><strong>æ­¥éª¤ï¼š</strong></p><ol><li><p><strong>å¯ç”¨ SSHï¼š</strong></p><ul><li>è§£é”æ–¹æ³•è‡ªè¡Œæœç´¢ã€‚</li></ul></li><li><p><strong>è¿æ¥åˆ°è·¯ç”±å™¨ SSHï¼š</strong></p><ul><li>ä½¿ç”¨ SSH å®¢æˆ·ç«¯è½¯ä»¶ã€‚</li><li>è¾“å…¥è·¯ç”±å™¨çš„ IP åœ°å€ã€ç«¯å£ (é»˜è®¤æ˜¯ 22)ï¼Œç”¨æˆ·å (é€šå¸¸æ˜¯ <code>root</code>) å’Œå¯†ç  (ä½ åœ¨ç¬¬ä¸€æ­¥è®¾ç½®çš„å¯†ç )ã€‚</li><li>è¿æ¥æˆåŠŸåï¼Œä½ ä¼šçœ‹åˆ°ä¸€ä¸ªå‘½ä»¤è¡Œç•Œé¢ã€‚</li></ul></li><li><p><strong>ç¡®å®šæ¶æ„ï¼š</strong></p><ul><li><p>åœ¨ SSH å‘½ä»¤è¡Œä¸­è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼ŒæŸ¥çœ‹è·¯ç”±å™¨çš„ CPU æ¶æ„ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">uname</span> -m</span><br></pre></td></tr></table></figure></li><li><p>å¸¸è§çš„æ¶æ„æœ‰ <code>armv7l</code>, <code>aarch64</code> (arm64) ç­‰ã€‚ <strong>è¯·è®°ä½è¿™ä¸ªæ¶æ„ï¼Œç¨åä¼šç”¨åˆ°ã€‚</strong> ä¸åŒçš„æ¶æ„éœ€è¦ä½¿ç”¨ä¸åŒçš„ Entware å®‰è£…åŒ…ã€‚</p></li></ul></li><li><p><strong>æŒ‚è½½å­˜å‚¨è®¾å¤‡ï¼š</strong></p><ul><li><p>å°†å­˜å‚¨è®¾å¤‡æ’å…¥è·¯ç”±å™¨çš„ USB æ¥å£ã€‚</p></li><li><p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹å­˜å‚¨è®¾å¤‡æ˜¯å¦è¢«è¯†åˆ«ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">df</span> -h</span><br></pre></td></tr></table></figure></li><li><p>æ‰¾åˆ°ä½ çš„å­˜å‚¨è®¾å¤‡ï¼Œä¾‹å¦‚ <code>/dev/sda1</code> æˆ– <code>/dev/sdb1</code>ã€‚ <strong>è¯·æ³¨æ„ï¼Œè®¾å¤‡çš„åç§°å¯èƒ½ä¼šä¸åŒï¼Œè¯·æ ¹æ®ä½ çš„å®é™…æƒ…å†µé€‰æ‹©ã€‚</strong> ä»”ç»†æ£€æŸ¥è®¾å¤‡åç§°ï¼Œé¿å…é”™è¯¯æ“ä½œã€‚</p></li><li><p>åˆ›å»ºä¸€ä¸ª <code>myentware</code> æ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨å…¶ä¸‹åˆ›å»º <code>opt</code> ç›®å½•ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /mnt/ä½ çš„å­˜å‚¨è®¾å¤‡è·¯å¾„/myentware/opt</span><br></pre></td></tr></table></figure><p><strong>è¯·å°† <code>ä½ çš„å­˜å‚¨è®¾å¤‡è·¯å¾„</code> æ›¿æ¢ä¸ºä½ çš„å®é™…è·¯å¾„ã€‚</strong> ä¾‹å¦‚ <code>/mnt/usb-25a3499d</code>ã€‚</p></li><li><p>å°†è·¯ç”±å™¨åŸæœ‰çš„ <code>/opt</code> ç›®å½•çš„å†…å®¹å¤åˆ¶åˆ°å¤–æ¥å­˜å‚¨è®¾å¤‡ä¸Šçš„ <code>/opt</code> ç›®å½•ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> -r /opt/* /mnt/ä½ çš„å­˜å‚¨è®¾å¤‡è·¯å¾„/myentware/opt</span><br></pre></td></tr></table></figure><p><strong>è¯·å°† <code>ä½ çš„å­˜å‚¨è®¾å¤‡è·¯å¾„</code> æ›¿æ¢ä¸ºä½ çš„å®é™…è·¯å¾„ã€‚</strong> ä¾‹å¦‚ <code>/mnt/usb-25a3499d</code>ã€‚ è¿™ä¸€æ­¥æ˜¯ä¸ºäº†ä¿ç•™è·¯ç”±å™¨åŸæœ‰çš„ <code>/opt</code> ç›®å½•ï¼Œé¿å…å‡ºç°é—®é¢˜ã€‚</p></li></ul></li><li><p><strong>æŒ‚è½½å­˜å‚¨è®¾å¤‡ (ç»­)ï¼š</strong></p><ul><li><p>ä½¿ç”¨ <code>mount -o bind</code> å‘½ä»¤å°†å¤–æ¥å­˜å‚¨è®¾å¤‡ä¸Šçš„ <code>/opt</code> ç›®å½•æŒ‚è½½åˆ°è·¯ç”±å™¨åŸæœ‰çš„ <code>/opt</code> ç›®å½•ä¸Šï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount -o <span class="built_in">bind</span> /mnt/ä½ çš„å­˜å‚¨è®¾å¤‡è·¯å¾„/myentware/opt /opt</span><br></pre></td></tr></table></figure><p><strong>è¯·å°† <code>ä½ çš„å­˜å‚¨è®¾å¤‡è·¯å¾„</code> æ›¿æ¢ä¸ºä½ çš„å®é™…è·¯å¾„ã€‚</strong> ä¾‹å¦‚ <code>/mnt/usb-25a3499d</code>ã€‚ è¿™ä¸€æ­¥æ˜¯å°† Entware çš„å®‰è£…ç›®å½•æŒ‡å‘ä½ çš„å¤–æ¥å­˜å‚¨è®¾å¤‡ã€‚</p></li></ul></li><li><p><strong>å®‰è£… Entwareï¼š</strong></p><ul><li><p>è¿è¡Œä»¥ä¸‹å‘½ä»¤ä¸‹è½½å¹¶æ‰§è¡Œ Entware å®‰è£…è„šæœ¬ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://bin.entware.net/aarch64-k3.10/installer/alternative.sh | sh</span><br></pre></td></tr></table></figure><p><strong>è¯·æ ¹æ®ä½ çš„ CPU æ¶æ„é€‰æ‹©æ­£ç¡®çš„å®‰è£…è„šæœ¬ã€‚</strong> å¦‚æœä½ çš„æ¶æ„ä¸æ˜¯ <code>aarch64-k3.10</code>ï¼Œè¯·å°† URL æ›¿æ¢ä¸ºæ­£ç¡®çš„ URLã€‚ ä½ å¯ä»¥åœ¨ <a href="https://entware.net/">Entware å®˜æ–¹ç½‘ç«™</a> æ‰¾åˆ°ä¸åŒæ¶æ„çš„å®‰è£…è„šæœ¬ã€‚ ä»”ç»†é˜…è¯»å®‰è£…è„šæœ¬çš„è¾“å‡ºä¿¡æ¯ï¼Œç¡®ä¿æ²¡æœ‰é”™è¯¯å‘ç”Ÿã€‚</p></li></ul></li><li><p><strong>é…ç½® Entware ç¯å¢ƒï¼š</strong></p><ul><li><p>ç¼–è¾‘ <code>/etc/profile</code> æ–‡ä»¶ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> PATH=<span class="string">&quot;/opt/bin:/opt/sbin:<span class="variable">$PATH</span>&quot;</span></span><br><span class="line"><span class="built_in">alias</span> opkg=<span class="string">&quot;/opt/bin/opkg&quot;</span></span><br></pre></td></tr></table></figure></li><li><p>ä¿å­˜æ–‡ä»¶å¹¶é€€å‡ºã€‚ å¯ä»¥ä½¿ç”¨ <code>nano</code> æˆ– <code>vi</code> ç¼–è¾‘å™¨ã€‚</p></li><li><p>ä½¿ç¯å¢ƒå˜é‡å’Œåˆ«åç”Ÿæ•ˆï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> /etc/profile</span><br></pre></td></tr></table></figure><p>è¿™ä¸€æ­¥æ˜¯ä¸ºäº†è®©å½“å‰çš„ SSH ä¼šè¯ä½¿ç”¨æ–°çš„ç¯å¢ƒå˜é‡å’Œåˆ«åã€‚</p></li></ul></li><li><p><strong>åˆ›å»ºå¼€æœºè‡ªå¯è„šæœ¬ï¼š</strong></p><ul><li><p>åˆ›å»º <code>/data/myscripts/auto_start.sh</code> æ–‡ä»¶ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŒ‚è½½ /opt ç›®å½•</span></span><br><span class="line">mount -o <span class="built_in">bind</span> /mnt/ä½ çš„å­˜å‚¨è®¾å¤‡è·¯å¾„/myentware/opt /opt</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®ç¯å¢ƒå˜é‡å’Œåˆ«å</span></span><br><span class="line"><span class="built_in">export</span> PATH=<span class="string">&quot;/opt/bin:/opt/sbin:<span class="variable">$PATH</span>&quot;</span></span><br><span class="line"><span class="built_in">alias</span> opkg=<span class="string">&quot;/opt/bin/opkg&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯åŠ¨ Entware æœåŠ¡</span></span><br><span class="line"><span class="built_in">sleep</span> 10</span><br><span class="line">/opt/etc/init.d/rc.unslung start</span><br><span class="line"></span><br><span class="line"><span class="built_in">exit</span> 0</span><br></pre></td></tr></table></figure><p><strong>è¯·å°† <code>ä½ çš„å­˜å‚¨è®¾å¤‡è·¯å¾„</code> æ›¿æ¢ä¸ºä½ çš„å®é™…è·¯å¾„ã€‚</strong> ä¾‹å¦‚ <code>/mnt/usb-25a3499d</code>ã€‚ <code>sleep 10</code> å‘½ä»¤æ˜¯ä¸ºäº†ç­‰å¾…å­˜å‚¨è®¾å¤‡æŒ‚è½½å®Œæˆï¼Œé¿å…å¯åŠ¨ Entware æœåŠ¡æ—¶å‡ºé”™ã€‚</p></li><li><p>è®¾ç½® <code>/data/myscripts/auto_start.sh</code> æ–‡ä»¶çš„æ‰§è¡Œæƒé™ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x /data/myscripts/auto_start.sh</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>é…ç½®é˜²ç«å¢™è‡ªå¯è„šæœ¬ï¼š</strong></p><ul><li><p>ç¼–è¾‘ <code>/data/etc/config/firewall</code> æ–‡ä»¶ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">config include &#x27;myscripts_auto_start&#x27;</span><br><span class="line">    option type &#x27;script&#x27;</span><br><span class="line">    option path &#x27;/data/myscripts/auto_start.sh&#x27;</span><br><span class="line">    option enabled &#x27;1&#x27;</span><br></pre></td></tr></table></figure><p>è¿™ä¸€æ­¥æ˜¯ä¸ºäº†è®©è·¯ç”±å™¨åœ¨å¯åŠ¨æ—¶è‡ªåŠ¨æ‰§è¡Œ <code>/data/myscripts/auto_start.sh</code> è„šæœ¬ã€‚</p></li></ul></li><li><p><strong>é‡å¯é˜²ç«å¢™æœåŠ¡ï¼š</strong></p><pre><code><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service firewall restart</span><br></pre></td></tr></table></figure></code></pre><p>è¿™ä¸€æ­¥æ˜¯ä¸ºäº†è®©é˜²ç«å¢™åŠ è½½æ–°çš„é…ç½®ã€‚</p></li><li><p><strong>é‡å¯è·¯ç”±å™¨ï¼š</strong></p><pre><code><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reboot</span><br></pre></td></tr></table></figure></code></pre><p>é‡å¯è·¯ç”±å™¨ï¼Œä½¿æ‰€æœ‰é…ç½®ç”Ÿæ•ˆã€‚</p></li><li><p><strong>éªŒè¯ Entware æ˜¯å¦å®‰è£…æˆåŠŸï¼š</strong></p><ul><li><p>é‡å¯è·¯ç”±å™¨åï¼Œé‡æ–°è¿æ¥ SSHã€‚</p></li><li><p>è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼ŒæŸ¥çœ‹ Entware çš„æœåŠ¡æ˜¯å¦æ­£åœ¨è¿è¡Œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/opt/etc/init.d/rc.unslung status</span><br></pre></td></tr></table></figure><p>å¦‚æœ Entware æ­£åœ¨è¿è¡Œï¼Œä½ åº”è¯¥ä¼šçœ‹åˆ°ä¸€äº›æœåŠ¡çš„çŠ¶æ€ä¿¡æ¯ã€‚</p></li><li><p>è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œæ£€æŸ¥ç¯å¢ƒå˜é‡æ˜¯å¦æ­£ç¡®è®¾ç½®ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="variable">$PATH</span></span><br></pre></td></tr></table></figure><p>è¾“å‡ºåº”è¯¥åŒ…å« <code>/opt/bin</code> å’Œ <code>/opt/sbin</code>ã€‚</p></li><li><p>è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œæ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨å¹¶å®‰è£… <code>nano</code> ç¼–è¾‘å™¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">opkg update</span><br><span class="line">opkg install nano</span><br></pre></td></tr></table></figure><p>å¦‚æœæ›´æ–°å’Œå®‰è£…æˆåŠŸï¼Œæ²¡æœ‰æŠ¥é”™ä¿¡æ¯ï¼Œåˆ™è¯´æ˜ Entware å·²ç»å¯ä»¥æ­£å¸¸å·¥ä½œã€‚</p></li><li><p>è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œæµ‹è¯• <code>nano</code> ç¼–è¾‘å™¨æ˜¯å¦èƒ½å¤Ÿæ­£å¸¸å¯åŠ¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano /tmp/test.txt</span><br></pre></td></tr></table></figure><p>å¦‚æœ <code>nano</code> ç¼–è¾‘å™¨èƒ½å¤Ÿæ­£å¸¸å¯åŠ¨ï¼Œåˆ™è¯´æ˜ Entware å·²ç»æˆåŠŸå®‰è£…ã€‚</p></li></ul></li></ol><p><strong>å¦‚æœä»¥ä¸Šæ­¥éª¤éƒ½èƒ½å¤Ÿæ­£å¸¸å®Œæˆï¼Œé‚£ä¹ˆæ­å–œä½ ï¼Œä½ å·²ç»æˆåŠŸåœ¨å°ç±³ä¸‡å…†è·¯ç”±å™¨ä¸Šå®‰è£…äº† Entwareï¼</strong></p><p><strong>å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ³•ï¼š</strong></p><ul><li><strong>æ— æ³•è¿æ¥åˆ°è·¯ç”±å™¨ SSHï¼š</strong> æ£€æŸ¥ SSH æœåŠ¡æ˜¯å¦å·²å¯ç”¨ï¼Œä»¥åŠ IP åœ°å€ã€ç«¯å£ã€ç”¨æˆ·åå’Œå¯†ç æ˜¯å¦æ­£ç¡®ã€‚</li><li><strong>å­˜å‚¨è®¾å¤‡æ— æ³•æŒ‚è½½ï¼š</strong> æ£€æŸ¥å­˜å‚¨è®¾å¤‡æ˜¯å¦è¢«è·¯ç”±å™¨è¯†åˆ«ï¼Œä»¥åŠæŒ‚è½½ç‚¹æ˜¯å¦æ­£ç¡®ã€‚ ä½¿ç”¨ <code>dmesg</code> å‘½ä»¤æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—ï¼Œå¯èƒ½ä¼šæœ‰å…³äºå­˜å‚¨è®¾å¤‡æŒ‚è½½å¤±è´¥çš„ä¿¡æ¯ã€‚</li><li><strong>å®‰è£…è„šæœ¬ä¸‹è½½å¤±è´¥ï¼š</strong> æ£€æŸ¥ç½‘ç»œè¿æ¥æ˜¯å¦æ­£å¸¸ï¼Œä»¥åŠå®‰è£…è„šæœ¬çš„ URL æ˜¯å¦æ­£ç¡®ã€‚ å°è¯•ä½¿ç”¨ <code>ping</code> å‘½ä»¤æµ‹è¯•ç½‘ç»œè¿æ¥ã€‚</li><li><strong><code>opkg</code> å‘½ä»¤æ— æ³•ä½¿ç”¨ï¼š</strong> æ£€æŸ¥ç¯å¢ƒå˜é‡æ˜¯å¦å·²æ­£ç¡®è®¾ç½®ã€‚ ç¡®ä¿ <code>/opt/bin</code> å’Œ <code>/opt/sbin</code> å·²ç»æ·»åŠ åˆ°äº† <code>PATH</code> ç¯å¢ƒå˜é‡ä¸­ã€‚</li><li><strong>è·¯ç”±å™¨é‡å¯å Entware æ— æ³•å·¥ä½œï¼š</strong> æ£€æŸ¥å¼€æœºè‡ªå¯è„šæœ¬æ˜¯å¦å·²æ­£ç¡®é…ç½®ï¼Œä»¥ç¡®ä¿å­˜å‚¨è®¾å¤‡åœ¨å¯åŠ¨æ—¶è‡ªåŠ¨æŒ‚è½½ï¼Œå¹¶ä¸” Entware æœåŠ¡èƒ½å¤Ÿæ­£å¸¸å¯åŠ¨ã€‚ æŸ¥çœ‹ç³»ç»Ÿæ—¥å¿—ï¼Œå¯èƒ½ä¼šæœ‰å…³äºå¯åŠ¨å¤±è´¥çš„ä¿¡æ¯ã€‚</li><li><strong><code>opkg update</code> å¤±è´¥ï¼š</strong> æ£€æŸ¥ç³»ç»Ÿæ—¶é—´æ˜¯å¦æ­£ç¡®ã€‚ é”™è¯¯çš„ç³»ç»Ÿæ—¶é—´ä¼šå¯¼è‡´ SSL è¯ä¹¦éªŒè¯å¤±è´¥ã€‚ å°è¯•æ‰‹åŠ¨è®¾ç½®æ—¶é—´ï¼Œæˆ–è€…å®‰è£… <code>ntpd</code> è½¯ä»¶åŒ…æ¥è‡ªåŠ¨åŒæ­¥æ—¶é—´ã€‚</li></ul><p><strong>æ€»ç»“ï¼š</strong></p><p>æœ¬æ•™ç¨‹æä¾›äº†åœ¨å°ç±³ä¸‡å…†è·¯ç”±å™¨ä¸Šå®‰è£… Entware çš„è¯¦ç»†æ­¥éª¤ã€‚ è¯·åŠ¡å¿…ä»”ç»†é˜…è¯»ä»¥ä¸Šæ­¥éª¤ï¼Œå¹¶æ ¹æ®ä½ çš„å®é™…æƒ…å†µè¿›è¡Œè°ƒæ•´ã€‚ å¦‚æœä½ é‡åˆ°é—®é¢˜ï¼Œå¯ä»¥æŸ¥é˜… Entware å®˜æ–¹æ–‡æ¡£æˆ–åœ¨ç½‘ä¸Šæœç´¢ç›¸å…³çš„è§£å†³æ–¹æ¡ˆã€‚</p><p><strong>å†æ¬¡æé†’ï¼šåˆ·æœºæœ‰é£é™©ï¼Œè¯·åŠ¡å¿…å¤‡ä»½è·¯ç”±å™¨å›ºä»¶ï¼</strong></p>]]></content>
      
      
      <categories>
          
          <category> Openwrt </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Openwrt </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®°å½•ä¸€ä¸‹ä½¿ç”¨FRPå†…ç½‘ç©¿é€Jellyfinæ—¶ä¸æ˜¾ç¤ºçœŸå®IPçš„è§£å†³åŠæ³•</title>
      <link href="/posts/a8031044/"/>
      <url>/posts/a8031044/</url>
      
        <content type="html"><![CDATA[<h3 id="ä¸€-frpcæœåŠ¡å™¨ä¸Šå®‰è£…Ngnix"><a href="#ä¸€-frpcæœåŠ¡å™¨ä¸Šå®‰è£…Ngnix" class="headerlink" title="ä¸€. frpcæœåŠ¡å™¨ä¸Šå®‰è£…Ngnix"></a>ä¸€. frpcæœåŠ¡å™¨ä¸Šå®‰è£…Ngnix</h3><ol><li>æˆ‘çš„æ˜¯Debianå…¶ä»–è‡ªè¡Œæœç´¢</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">apt install nginx -y</span><br><span class="line">#å¯åŠ¨å¹¶è®¾ç½®nginxå¼€æœºå¯åŠ¨</span><br><span class="line">systemctl start nginx</span><br><span class="line">systemctl enable nginx</span><br></pre></td></tr></table></figure><h3 id="äºŒ-é…ç½®Nginxæ”¯æŒproxy-protocol"><a href="#äºŒ-é…ç½®Nginxæ”¯æŒproxy-protocol" class="headerlink" title="äºŒ. é…ç½®Nginxæ”¯æŒproxy_protocol"></a>äºŒ. é…ç½®Nginxæ”¯æŒ<code>proxy_protocol</code></h3><ol><li>ç¼–è¾‘nginxé…ç½®æ–‡ä»¶</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano /etc/nginx/nginx.conf</span><br></pre></td></tr></table></figure><ol start="2"><li>åœ¨httpå—ä¸­æ·»åŠ ä¸‹é¢å†…å®¹</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">http &#123;</span><br><span class="line">       ...#ä½ç½®éšæ„</span><br><span class="line">       real_ip_header proxy_protocol;</span><br><span class="line">       set_real_ip_from 0.0.0.0/0;  # å…è®¸æ‰€æœ‰IP</span><br><span class="line">       ...</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><ol><li>ç»™jellyfinåˆ›å»ºä¸€ä¸ªnginxä»£ç†</li></ol> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano /etc/nginx/conf.d/jellyfin.conf</span><br></pre></td></tr></table></figure><ol start="2"><li>æ·»åŠ ä¸‹é¢å†…å®¹</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">       listen 8096 proxy_protocol;  # ç›‘å¬8096ç«¯å£å¹¶å¯ç”¨proxy_protocol</span><br><span class="line">       server_name _;</span><br><span class="line"></span><br><span class="line">       location / &#123;</span><br><span class="line">           proxy_pass http://192.168.88.11:8096;  # è½¬å‘åˆ°JellyfinæœåŠ¡å™¨</span><br><span class="line">           proxy_set_header Host $host;</span><br><span class="line">           proxy_set_header X-Real-IP $proxy_protocol_addr;  # è·å–çœŸå®IP</span><br><span class="line">           proxy_set_header X-Forwarded-For $proxy_protocol_addr;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>ä¿å­˜å¹¶æµ‹è¯•</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nginx -t</span><br><span class="line">#è¾“å‡º</span><br><span class="line">...................................ok</span><br><span class="line">...................................successful</span><br></pre></td></tr></table></figure><ol start="6"><li>æµ‹è¯•æˆåŠŸï¼Œé‡æ–°åŠ è½½nginx</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl reload nginx</span><br></pre></td></tr></table></figure><h3 id="ä¸‰-é…ç½®frpc-toml"><a href="#ä¸‰-é…ç½®frpc-toml" class="headerlink" title="ä¸‰ .é…ç½®frpc.toml"></a>ä¸‰ .é…ç½®frpc.toml</h3><ol><li>nano frpc.toml</li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[Jellyfin]</span><br><span class="line">type=tcp</span><br><span class="line">remote_port=29080</span><br><span class="line">local_ip=192.168.88.110</span><br><span class="line">local_port=8096</span><br><span class="line">proxy_protocol_version=v2</span><br><span class="line">use_encryption=true</span><br><span class="line">use_compression=true</span><br></pre></td></tr></table></figure><h3 id="å››-é‡å¯frpc-frps-Jellyfin"><a href="#å››-é‡å¯frpc-frps-Jellyfin" class="headerlink" title="å›› .é‡å¯frpc&amp;&amp;frps&amp;&amp;Jellyfin"></a>å›› .é‡å¯frpc&amp;&amp;frps&amp;&amp;Jellyfin</h3><p>ï¼ï¼ï¼ï¼æ³¨æ„æ‹¼å†™é”™è¯¯ï¼Œçº¯æ‰‹æ‰“</p>]]></content>
      
      
      <categories>
          
          <category> frp </category>
          
      </categories>
      
      
        <tags>
            
            <tag> frp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>äººç”Ÿå—åŒ—å¤šæ­§è·¯ï¼Œå›å‘æ½‡æ¹˜æˆ‘å‘ç§¦</title>
      <link href="/posts/fff6f0b6/"/>
      <url>/posts/fff6f0b6/</url>
      
        <content type="html"><![CDATA[<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">äººç”Ÿå—åŒ—å¤šæ­§è·¯ï¼Œå›å‘æ½‡æ¹˜æˆ‘å‘ç§¦</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>è§ç‘Ÿç§‹é£ä»Šåˆæ˜¯ï¼Œæ¢äº†äººé—´</title>
      <link href="/posts/f2cd64e/"/>
      <url>/posts/f2cd64e/</url>
      
        <content type="html"><![CDATA[<h5 id=""><a href="#" class="headerlink" title=""></a></h5><blockquote><p>[æ¯›æ³½ä¸œ] - ã€Š<a href="https://baike.baidu.com/item/%E6%B5%AA%E6%B7%98%E6%B2%99%C2%B7%E5%8C%97%E6%88%B4%E6%B2%B3/5958852">æµªæ·˜æ²™Â·åŒ—æˆ´æ²³</a>ã€‹</p></blockquote><p> <strong>åŸæ–‡</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">å¤§é›¨è½å¹½ç‡•ï¼Œç™½æµªæ»”å¤©ï¼Œç§¦çš‡å²›å¤–æ‰“é±¼èˆ¹ã€‚ä¸€ç‰‡æ±ªæ´‹éƒ½ä¸è§ï¼ŒçŸ¥å‘è°è¾¹ï¼Ÿ</span><br><span class="line">å¾€äº‹è¶Šåƒå¹´ï¼Œé­æ­¦æŒ¥é­ï¼Œä¸œä¸´ç¢£çŸ³æœ‰é—ç¯‡ã€‚è§ç‘Ÿç§‹é£ä»Šåˆæ˜¯ï¼Œæ¢äº†äººé—´ã€‚</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç¬”è®° </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ç®€å•çš„æœåŠ¡å™¨å®‰å…¨é…ç½®è„šæœ¬</title>
      <link href="/posts/7ee12d6a/"/>
      <url>/posts/7ee12d6a/</url>
      
        <content type="html"><![CDATA[<blockquote><p>æœ€è¿‘è€æ˜¯æƒ³ä¹°äº›ä¾¿å®œVPSã€‚æ¯æ¬¡é…ç½®æœåŠ¡å™¨å®‰å…¨éƒ½è¦æ‰‹æŒ«åŠå¤©ï¼Œæœ€åè®©Claudeæ“äº†ä¸ªè„šæœ¬ï¼Œå…å¾—å†¬å¤©æ‰‹ç”Ÿç–®<br>#é€‚ç”¨äºDebianæœåŠ¡å™¨</p></blockquote><p><img src="https://github.com/user-attachments/assets/6077d526-4756-4ffb-a8c3-f06f29b1d75e" alt="image"></p><hr><h3 id="å¿«é€Ÿå¼€å§‹"><a href="#å¿«é€Ÿå¼€å§‹" class="headerlink" title="å¿«é€Ÿå¼€å§‹"></a>å¿«é€Ÿå¼€å§‹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -P /root -N --no-check-certificate https://raw.githubusercontent.com/li88iioo/init_server/refs/heads/main/init_server.sh &amp;&amp; <span class="built_in">chmod</span> 700 /root/init_server.sh &amp;&amp; /root/init_server.sh</span><br></pre></td></tr></table></figure><h2 id="åŠŸèƒ½ç‰¹ç‚¹"><a href="#åŠŸèƒ½ç‰¹ç‚¹" class="headerlink" title="åŠŸèƒ½ç‰¹ç‚¹"></a>åŠŸèƒ½ç‰¹ç‚¹</h2><h3 id="ç³»ç»Ÿç®¡ç†"><a href="#ç³»ç»Ÿç®¡ç†" class="headerlink" title="ç³»ç»Ÿç®¡ç†"></a>ç³»ç»Ÿç®¡ç†</h3><ul><li>ç³»ç»Ÿæ›´æ–°ä¸è½¯ä»¶å®‰è£…</li><li>SSH ç«¯å£é…ç½®ä¸å®‰å…¨åŠ å›º</li><li>UFW é˜²ç«å¢™é…ç½®</li><li>Fail2ban é˜²æš´åŠ›ç ´è§£</li><li>ZeroTier è™šæ‹Ÿç½‘ç»œé…ç½®</li><li>Docker ç¯å¢ƒé…ç½®</li><li>Swap äº¤æ¢ç©ºé—´ç®¡ç†</li></ul><h3 id="åº”ç”¨å®‰è£…"><a href="#åº”ç”¨å®‰è£…" class="headerlink" title="åº”ç”¨å®‰è£…"></a>åº”ç”¨å®‰è£…</h3><ul><li>1Panel é¢æ¿</li><li>v2ray-agent</li></ul><h3 id="ç³»ç»Ÿå·¥å…·"><a href="#ç³»ç»Ÿå·¥å…·" class="headerlink" title="ç³»ç»Ÿå·¥å…·"></a>ç³»ç»Ÿå·¥å…·</h3><ul><li>ç³»ç»Ÿå®‰å…¨æ£€æŸ¥</li><li>ç³»ç»Ÿå®‰å…¨åŠ å›º</li><li>ç³»ç»Ÿèµ„æºç›‘æ§</li><li>ç½‘ç»œè¯Šæ–­</li></ul><h2 id="åŠŸèƒ½è¯¦è§£"><a href="#åŠŸèƒ½è¯¦è§£" class="headerlink" title="åŠŸèƒ½è¯¦è§£"></a>åŠŸèƒ½è¯¦è§£</h2><h3 id="SSH-é…ç½®"><a href="#SSH-é…ç½®" class="headerlink" title="SSH é…ç½®"></a>SSH é…ç½®</h3><ul><li>ä¿®æ”¹ SSH ç«¯å£</li><li>é…ç½® SSH å¯†é’¥è®¤è¯</li><li>SSH å®‰å…¨åŠ å›º</li></ul><h3 id="é˜²ç«å¢™é…ç½®"><a href="#é˜²ç«å¢™é…ç½®" class="headerlink" title="é˜²ç«å¢™é…ç½®"></a>é˜²ç«å¢™é…ç½®</h3><ul><li>UFW è§„åˆ™ç®¡ç†</li><li>ç«¯å£å¼€æ”¾&#x2F;å…³é—­</li><li>PING å“åº”æ§åˆ¶</li><li>Docker ç½‘ç»œè§„åˆ™é…ç½®</li></ul><h3 id="Fail2ban-é…ç½®"><a href="#Fail2ban-é…ç½®" class="headerlink" title="Fail2ban é…ç½®"></a>Fail2ban é…ç½®</h3><ul><li>SSH é˜²æš´åŠ›ç ´è§£</li><li>è‡ªå®šä¹‰å°ç¦è§„åˆ™</li><li>çŠ¶æ€ç›‘æ§</li></ul><h3 id="Docker-ç®¡ç†"><a href="#Docker-ç®¡ç†" class="headerlink" title="Docker ç®¡ç†"></a>Docker ç®¡ç†</h3><ul><li>Docker ç¯å¢ƒå®‰è£…</li><li>Docker Compose å®‰è£…</li><li>å®¹å™¨èµ„æºç›‘æ§</li><li>ç½‘ç»œé…ç½®</li><li>èµ„æºæ¸…ç†</li></ul><h3 id="Swap-ç®¡ç†"><a href="#Swap-ç®¡ç†" class="headerlink" title="Swap ç®¡ç†"></a>Swap ç®¡ç†</h3><ul><li>åˆ›å»º&#x2F;è°ƒæ•´ Swap å¤§å°</li><li>Swappiness å‚æ•°è°ƒæ•´</li><li>Swap åˆ é™¤</li></ul><h3 id="ç³»ç»Ÿç›‘æ§"><a href="#ç³»ç»Ÿç›‘æ§" class="headerlink" title="ç³»ç»Ÿç›‘æ§"></a>ç³»ç»Ÿç›‘æ§</h3><ul><li>CPU ä½¿ç”¨ç‡</li><li>å†…å­˜ä½¿ç”¨æƒ…å†µ</li><li>ç£ç›˜ä½¿ç”¨çŠ¶æ€</li><li>ç½‘ç»œè¿æ¥çŠ¶æ€</li></ul><h3 id="å®‰å…¨æ£€æŸ¥"><a href="#å®‰å…¨æ£€æŸ¥" class="headerlink" title="å®‰å…¨æ£€æŸ¥"></a>å®‰å…¨æ£€æŸ¥</h3><ul><li>ç³»ç»ŸåŸºæœ¬ä¿¡æ¯æ£€æŸ¥</li><li>å¼€æ”¾ç«¯å£æ£€æŸ¥</li><li>ç™»å½•è®°å½•å®¡è®¡</li><li>SSH é…ç½®æ£€æŸ¥</li><li>é˜²ç«å¢™çŠ¶æ€æ£€æŸ¥</li></ul><h2 id="ä½¿ç”¨å»ºè®®"><a href="#ä½¿ç”¨å»ºè®®" class="headerlink" title="ä½¿ç”¨å»ºè®®"></a>ä½¿ç”¨å»ºè®®</h2><ol><li>é¦–æ¬¡ä½¿ç”¨å»ºè®®å…ˆè¿è¡Œç³»ç»Ÿå®‰å…¨æ£€æŸ¥</li><li>åŠæ—¶æ›´æ–°ç³»ç»Ÿå¹¶é…ç½®é˜²ç«å¢™</li><li>é…ç½® SSH å¯†é’¥è®¤è¯å¹¶ç¦ç”¨å¯†ç ç™»å½•</li><li>æ ¹æ®éœ€è¦è°ƒæ•´ Swap å’Œç³»ç»Ÿå‚æ•°</li><li>å®šæœŸæ£€æŸ¥ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ</li></ol><h2 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h2><ul><li>è„šæœ¬éœ€è¦ root æƒé™è¿è¡Œ</li><li>ä¿®æ”¹ SSH é…ç½®å‰è¯·ç¡®ä¿æœ‰å…¶ä»–å¯ç”¨çš„ç™»å½•æ–¹å¼</li><li>é˜²ç«å¢™é…ç½®å‰è¯·ç¡®ä¿å·²å¼€æ”¾å¿…è¦ç«¯å£</li><li>å»ºè®®åœ¨é…ç½®å‰å¤‡ä»½é‡è¦æ•°æ®</li><li>éƒ¨åˆ†åŠŸèƒ½å¯èƒ½éœ€è¦è”ç½‘ä¸‹è½½ç›¸å…³ç»„ä»¶</li></ul><h2 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a>å¸¸è§é—®é¢˜</h2><p><strong>Q: å¦‚ä½•å¤‡ä»½é…ç½®ï¼Ÿ</strong><br>A: è„šæœ¬ä¼šè‡ªåŠ¨å¤‡ä»½é‡è¦çš„é…ç½®æ–‡ä»¶ï¼Œå¤‡ä»½æ–‡ä»¶é€šå¸¸å¸¦æœ‰æ—¶é—´æˆ³åç¼€ã€‚</p><p><strong>Q: å¿˜è®°ä¿®æ”¹åçš„ SSH ç«¯å£ï¼Ÿ</strong><br>A: å¯ä»¥åœ¨ <code>/etc/ssh/sshd_config</code> æ–‡ä»¶ä¸­æŸ¥çœ‹ã€‚</p><p><strong>Q: å¦‚ä½•æ¢å¤è¢« Fail2ban å°ç¦çš„ IPï¼Ÿ</strong><br>A: ä½¿ç”¨ <code>fail2ban-client set sshd unbanip &lt;IP&gt;</code> å‘½ä»¤ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> VPS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> VPS </tag>
            
            <tag> Debian </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®°å½•ä¸€ä¸‹FRP XTCPçš„é…ç½®æ–¹æ³•</title>
      <link href="/posts/1306909b/"/>
      <url>/posts/1306909b/</url>
      
        <content type="html"><![CDATA[<h2 id="è®°å½•ä¸€ä¸‹FRP-XTCPçš„é…ç½®æ–¹æ³•"><a href="#è®°å½•ä¸€ä¸‹FRP-XTCPçš„é…ç½®æ–¹æ³•" class="headerlink" title="è®°å½•ä¸€ä¸‹FRP XTCPçš„é…ç½®æ–¹æ³•"></a>è®°å½•ä¸€ä¸‹FRP XTCPçš„é…ç½®æ–¹æ³•</h2><blockquote><p><strong>ä»€ä¹ˆæ˜¯xtcp</strong><br>åœ¨ FRPï¼ˆFast Reverse Proxyï¼‰çš„ XTCP åŠŸèƒ½ä¸­ï¼Œ<code>frps</code>ï¼ˆFRP<br>æœåŠ¡ç«¯ï¼‰æ‰®æ¼”ç€è‡³å…³é‡è¦çš„è§’è‰²ï¼Œå°½ç®¡å®ƒä¸ç›´æ¥å‚ä¸æ•°æ®çš„æœ€ç»ˆä¼ è¾“ã€‚XTCP æ˜¯ä¸€ç§ç©¿é€æŠ€æœ¯ï¼Œä½¿å¾—å¤„äºä¸åŒ NAT<br>æˆ–é˜²ç«å¢™åçš„ä¸¤ä¸ªç½‘ç»œè®¾å¤‡èƒ½å¤Ÿå»ºç«‹ç›´æ¥çš„è¿æ¥ã€‚åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œ<code>frps</code> çš„ä½œç”¨ä¸»è¦åŒ…æ‹¬ï¼š</p><ol><li><p><strong>ä¸­ç»§æ¡æ‰‹ä¿¡æ¯</strong>ï¼šå½“ä¸¤ä¸ªå®¢æˆ·ç«¯ï¼ˆé€šè¿‡ <code>frpc</code> è¿è¡Œï¼‰å°è¯•å»ºç«‹ XTCP è¿æ¥æ—¶ï¼Œ<code>frps</code> ä½œä¸ºä¸­ä»‹ï¼Œè´Ÿè´£è½¬å‘è¿™ä¸¤ä¸ªå®¢æˆ·ç«¯ä¹‹é—´çš„æ¡æ‰‹ä¿¡æ¯ã€‚è¿™æ˜¯å»ºç«‹ P2Pï¼ˆç‚¹å¯¹ç‚¹ï¼‰è¿æ¥çš„å…ˆå†³æ¡ä»¶ï¼Œå› ä¸ºå¤§å¤šæ•°å®¢æˆ·ç«¯éƒ½å¤„åœ¨ NAT<br>æˆ–é˜²ç«å¢™åé¢ï¼Œæ— æ³•ç›´æ¥å‘ç°å¯¹æ–¹æˆ–å»ºç«‹è¿æ¥ã€‚</p></li><li><p><strong>ååŠ©ç©¿é€ NAT</strong>ï¼šåœ¨ XTCP çš„æ¡æ‰‹è¿‡ç¨‹ä¸­ï¼Œ<code>frps</code> ä¼šå¸®åŠ©ä¸¤ç«¯çš„ <code>frpc</code> å®¢æˆ·ç«¯äº¤æ¢å¿…è¦çš„ä¿¡æ¯ï¼ˆå¦‚å…¬ç½‘ IP åœ°å€å’Œç«¯å£ï¼‰ï¼Œè¿™äº›ä¿¡æ¯æ˜¯å®ç° NAT ç©¿é€çš„å…³é”®ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå³ä¾¿å®¢æˆ·ç«¯ä½äºå¤æ‚çš„ç½‘ç»œç¯å¢ƒä¸­ï¼Œä¹Ÿèƒ½å¤Ÿå°è¯•ç›´æ¥ç›¸äº’è¿æ¥ã€‚</p></li><li><p><strong>å›é€€åˆ°ä¸­ç»§ä¼ è¾“ï¼ˆå¯é€‰ï¼‰</strong>ï¼šåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ¯”å¦‚å½“ NAT ç±»å‹ç‰¹åˆ«ä¸¥æ ¼æˆ–ç¯å¢ƒå¤æ‚åˆ°é˜»ç¢äº†ç›´æ¥çš„ P2P è¿æ¥æ—¶ï¼Œ<code>frps</code> å¯ä»¥æä¾›å›é€€æ–¹æ¡ˆï¼Œå³é€šè¿‡æœåŠ¡å™¨ä¸­ç»§æ¥ä¼ è¾“æ•°æ®ã€‚è™½ç„¶è¿™å¢åŠ äº†å»¶è¿Ÿå¹¶éœ€è¦æ›´å¤šçš„æœåŠ¡å™¨å¸¦å®½ï¼Œä½†å®ƒç¡®ä¿äº†è¿æ¥çš„å¯é æ€§ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒFRP çš„<br>XTCP åŠŸèƒ½ä¸»è¦ç›®æ ‡æ˜¯å°½é‡å®ç°ç›´æ¥çš„ P2P è¿æ¥ï¼Œè€Œä¸ä¾èµ–æœåŠ¡å™¨ä¸­ç»§ä¼ è¾“æ•°æ®ã€‚</p></li><li><p><strong>å®‰å…¨æ€§å’Œè®¿é—®æ§åˆ¶</strong>ï¼š<code>frps</code> è¿˜ç®¡ç†ç€å®¢æˆ·ç«¯çš„è®¤è¯è¿‡ç¨‹ï¼Œç¡®ä¿åªæœ‰æˆæƒçš„å®¢æˆ·ç«¯å¯ä»¥å»ºç«‹è¿æ¥ã€‚æ­¤å¤–ï¼Œå®ƒå¯ä»¥å¯¹è¿æ¥è¿›è¡ŒåŠ å¯†å’Œå‹ç¼©è®¾ç½®ï¼Œæé«˜æ•°æ®ä¼ è¾“çš„å®‰å…¨æ€§å’Œæ•ˆç‡ã€‚</p></li></ol><p>æ€»ä¹‹ï¼Œè™½ç„¶ <code>frps</code> åœ¨ XTCP<br>æ¨¡å¼ä¸‹çš„æ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­ä¸ç›´æ¥å‚ä¸æ•°æ®çš„æœ€ç»ˆä¼ é€’ï¼Œä½†å®ƒåœ¨å»ºç«‹è¿æ¥çš„åˆæœŸé˜¶æ®µå‘æŒ¥ç€è‡³å…³é‡è¦çš„ä½œç”¨ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºæ¡æ‰‹ä¿¡æ¯çš„ä¸­ç»§ã€å¸®åŠ©å®ç° NAT<br>ç©¿é€ã€æä¾›å›é€€çš„ä¸­ç»§ä¼ è¾“æ–¹æ¡ˆä»¥åŠæ‰§è¡Œå®‰å…¨æ€§å’Œè®¿é—®æ§åˆ¶ã€‚for ChatGPT</p></blockquote><h3 id="1-ç¡®è®¤ç¯å¢ƒè¦æ±‚"><a href="#1-ç¡®è®¤ç¯å¢ƒè¦æ±‚" class="headerlink" title="1. ç¡®è®¤ç¯å¢ƒè¦æ±‚"></a>1. ç¡®è®¤ç¯å¢ƒè¦æ±‚</h3><ul><li><p><strong>ä¸¤ä¸ªå®¢æˆ·ç«¯</strong>ï¼šç¡®ä¿ä½ æœ‰ä¸¤ä¸ªå¤„äºä¸åŒ NAT æˆ–é˜²ç«å¢™åçš„å®¢æˆ·ç«¯è®¾å¤‡ï¼Œè¿™ä¸¤ä¸ªå®¢æˆ·ç«¯éƒ½éœ€è¦èƒ½å¤Ÿè®¿é—®åˆ° FRP æœåŠ¡å™¨ã€‚</p></li><li><p><strong>ä¸€ä¸ªæœåŠ¡å™¨</strong>ï¼šä¸€ä¸ªå¯ä»¥è¢«ä¸Šè¿°å®¢æˆ·ç«¯è®¿é—®çš„æœåŠ¡å™¨ï¼Œç”¨æ¥éƒ¨ç½² FRP æœåŠ¡ç«¯ã€‚è¿™ä¸ªæœåŠ¡å™¨éœ€è¦æœ‰å›ºå®šçš„å…¬ç½‘ IP æˆ–åŸŸåã€‚</p></li></ul><blockquote><p>è¿™é‡Œæˆ‘å‡†å¤‡äº†ä¸€å°å†…ç½‘æœåŠ¡å™¨ <code>&#39; A &#39;</code>ï¼Œä¸¤å°å…¬ç½‘æœåŠ¡å™¨ï¼Œå«ä¸€å°ä¼˜è´¨çº¿è·¯ï¼Œä½å®½å¸¦ä½æµé‡ <code>&#39; S &#39; </code>ï¼Œä¸€å°é«˜å®½å¸¦é«˜æµé‡çº¿è·¯ä¸€èˆ¬çš„æœåŠ¡å™¨<code>&#39; D &#39;</code>ï¼‰ã€‚å®æµ‹åŸºæœ¬èƒ½è·‘æ»¡åŠ å®½ä¸Šè¡Œã€‚ï¼‰</p></blockquote><h3 id="2-å®‰è£…-FRP"><a href="#2-å®‰è£…-FRP" class="headerlink" title="2. å®‰è£… FRP"></a>2. å®‰è£… FRP</h3><blockquote><p>frpsä¸ºæœåŠ¡ç«¯ï¼Œfrpcä¸ºå®¢æˆ·ç«¯ï¼Œå®‰è£…æ–¹æ³•è¯·å‚è€ƒ<a href="https://gofrp.org/zh-cn/docs/setup/">å®‰è£… | frp (gofrp.org)</a></p></blockquote><p>Docker composeå®‰è£…ç¤ºåˆ—,åŒ…å«<code>frps</code>ï¼Œ<code>frpc</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">version: &#x27;3&#x27;</span><br><span class="line">services:</span><br><span class="line">  frps:</span><br><span class="line">    image: snowdreamtech/frps</span><br><span class="line">    container_name: frps</span><br><span class="line">    network_mode: host</span><br><span class="line">    volumes:</span><br><span class="line">      - ./data/frps.toml:/etc/frp/frps.toml</span><br><span class="line">    restart: always</span><br><span class="line"></span><br><span class="line">  frpc:</span><br><span class="line">    image: snowdreamtech/frpc</span><br><span class="line">    container_name: frpc</span><br><span class="line">    network_mode: host</span><br><span class="line">    volumes:</span><br><span class="line">      - ./data/frpc.toml:/etc/frp/frpc.toml</span><br><span class="line">    restart: always</span><br></pre></td></tr></table></figure><ul><li><strong>å†…ç½‘æœåŠ¡å™¨</strong> <code>A</code><strong>å®‰è£…frpc</strong></li><li><strong>å…¬ç½‘æœåŠ¡å™¨</strong><code>D</code><strong>å®‰è£…frpc</strong></li><li><strong>å…¬ç½‘æœåŠ¡å™¨</strong><code>S</code><strong>å®‰è£…frps</strong></li></ul><h3 id="3-é…ç½®"><a href="#3-é…ç½®" class="headerlink" title="3. é…ç½®"></a>3. é…ç½®</h3><p><strong>è¿™é‡Œä»¥ç©¿é€å†…ç½‘ç¾¤æ™–ä¸ºä¾‹</strong><br>ä¸‹æ–‡çœ‹ä¸æ‡‚å¯ä»¥å‚è€ƒ<a href="https://gofrp.org/zh-cn/docs/examples/xtcp/">ç‚¹å¯¹ç‚¹å†…ç½‘ç©¿é€ | frp (gofrp.org)</a></p><h4 id="1-ç¾¤æ™–æˆ–ä»»æ„å†…ç½‘è®¾å¤‡å®‰è£…å¥½frpcåï¼Œè¿™é‡Œç§°ä¸º-è¢«è®¿é—®è€…-A"><a href="#1-ç¾¤æ™–æˆ–ä»»æ„å†…ç½‘è®¾å¤‡å®‰è£…å¥½frpcåï¼Œè¿™é‡Œç§°ä¸º-è¢«è®¿é—®è€…-A" class="headerlink" title="1.ç¾¤æ™–æˆ–ä»»æ„å†…ç½‘è®¾å¤‡å®‰è£…å¥½frpcåï¼Œè¿™é‡Œç§°ä¸º è¢«è®¿é—®è€… A"></a>1.ç¾¤æ™–æˆ–ä»»æ„å†…ç½‘è®¾å¤‡å®‰è£…å¥½<code>frpc</code>åï¼Œè¿™é‡Œç§°ä¸º <em><strong>è¢«è®¿é—®è€…</strong></em> A</h4><p>è¿›å…¥ä½ çš„å®‰è£…ç›®å½•é…ç½®<code>.toml</code>æ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd opt/frpc/data</span><br><span class="line">nano frpc.toml</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">serverAddr = &quot;1.1.1.1&quot;#æœåŠ¡å™¨ S çš„IPåœ°å€</span><br><span class="line">serverPort = 7000#æœåŠ¡å™¨ S çš„frpsç«¯å£å·ï¼Œä¸€èˆ¬ä¸º7000</span><br><span class="line">auth.token = &quot;123&quot;#å¯†é’¥ï¼Œå¯é€‰</span><br><span class="line"></span><br><span class="line">[[proxies]]</span><br><span class="line">name = &quot;nas-xtcp#åç§°éšæ„&quot;</span><br><span class="line">type = &quot;xtcp&quot;</span><br><span class="line">secretKey = &quot;123441&quot;#å¯†é’¥éšæ„</span><br><span class="line">localIP = &quot;192.168.88.2&quot;#ç¾¤æ™–å†…ç½‘åœ°å€</span><br><span class="line">localPort = 5001#ç¾¤æ™–å†…ç½‘ç«¯å£</span><br></pre></td></tr></table></figure><p><code>ctrl+x</code> <code>y</code>ä¿å­˜.</p><h4 id="2-é…ç½®frpsæœåŠ¡ç«¯-S"><a href="#2-é…ç½®frpsæœåŠ¡ç«¯-S" class="headerlink" title="2.é…ç½®frpsæœåŠ¡ç«¯ S"></a>2.é…ç½®<code>frps</code><em><strong>æœåŠ¡ç«¯</strong></em> S</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd opt/frps/data#è¿™é‡Œæ˜¯ä½ çš„å®‰è£…è·¯å¾„</span><br><span class="line">nano frps.toml</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">bindPort = 7000</span><br><span class="line">auth.token = &quot;123&quot;å¯†é’¥</span><br><span class="line"></span><br><span class="line">webServer.addr = &quot;0.0.0.0&quot;</span><br><span class="line">webServer.port = 7500#webé¢æ¿ç«¯å£</span><br><span class="line">webServer.user = &quot;admin&quot;webé¢æ¿è´¦å·</span><br><span class="line">webServer.password = &quot;adMin&quot;webé¢æ¿å¯†ç </span><br></pre></td></tr></table></figure><h4 id="3-é…ç½®frpc-è®¿é—®è€…-D"><a href="#3-é…ç½®frpc-è®¿é—®è€…-D" class="headerlink" title="3.é…ç½®frpc è®¿é—®è€… D"></a>3.é…ç½®<code>frpc</code> <em><strong>è®¿é—®è€…</strong></em> D</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd opt/frpc/data</span><br><span class="line">nano frpc.toml</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">serverAddr = &quot;1.1.1.1&quot;#æœåŠ¡å™¨ S çš„IPåœ°å€</span><br><span class="line">serverPort = 7000#æœåŠ¡å™¨ S çš„frpsç«¯å£å·</span><br><span class="line">auth.token = &quot;123&quot;#å¯†é’¥</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[[visitors]]</span><br><span class="line">name = &quot;p2p_nas_visitor&quot;#è¿™é‡Œåå­—éšæ„</span><br><span class="line">type = &quot;xtcp&quot;</span><br><span class="line"># è¦è®¿é—®çš„ P2P ä»£ç†çš„åç§°</span><br><span class="line">serverName = &quot;nas-xtcp&quot;#è¿™é‡Œè¦ä¸***è¢«è®¿é—®è€…åå­—***ä¸€è‡´</span><br><span class="line">secretKey = &quot;123441&quot;#è¿™é‡Œè¦ä¸***è¢«è®¿é—®è€…å¯†ç ***ä¸€è‡´</span><br><span class="line"># ç»‘å®šæœ¬åœ°ç«¯å£ä»¥è®¿é—® SSH æœåŠ¡</span><br><span class="line">bindAddr = &quot;127.0.0.1&quot;#ä½ æœåŠ¡å™¨çš„å†…ç½‘åœ°å€ï¼Œå¯ä»¥ä¸ç”¨ä¿®æ”¹</span><br><span class="line">bindPort = 15001#ä½ æœåŠ¡å™¨æœªä½¿ç”¨çš„ç«¯å£</span><br><span class="line"># å¦‚æœéœ€è¦è‡ªåŠ¨ä¿æŒéš§é“æ‰“å¼€ï¼Œå°†å…¶è®¾ç½®ä¸º true</span><br><span class="line">keepTunnelOpen = true</span><br></pre></td></tr></table></figure><p>é…ç½®å®Œæˆåé‡å¯ä¸‹ä¸€æœåŠ¡å™¨ <em><strong>s</strong></em> <em><strong>a</strong></em> <em><strong>d</strong></em></p><p>æ¥ä¸‹æ¥ä½¿ç”¨<code>D</code>æœåŠ¡å™¨çš„<strong>IP+15001</strong>å°±èƒ½è®¿é—®å†…ç½‘ç¾¤æ™–äº†ã€‚</p><p>åå‘ä»£ç†ç®€å•ç¤ºåˆ—</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">location ^~ / &#123;</span><br><span class="line">    proxy_pass https://127.0.0.1:15001; </span><br><span class="line">    proxy_set_header Host $host; </span><br><span class="line">    proxy_set_header X-Real-IP $remote_addr; </span><br><span class="line">    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; </span><br><span class="line">    proxy_set_header REMOTE-HOST $remote_addr; </span><br><span class="line">    proxy_set_header Upgrade $http_upgrade; </span><br><span class="line">    proxy_set_header Connection &quot;upgrade&quot;; </span><br><span class="line">    proxy_set_header X-Forwarded-Proto $scheme; </span><br><span class="line">    proxy_http_version 1.1; </span><br><span class="line">    add_header X-Cache $upstream_cache_status; </span><br><span class="line">    add_header Strict-Transport-Security &quot;max-age=31536000&quot;; </span><br><span class="line">    add_header Cache-Control no-cache; </span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ‚è°ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
            <tag> frp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®°å½•ä¸€ä¸‹éƒ¨ç½²Hexoåšå®¢åœ¨Debian æœåŠ¡å™¨ä¸Šçš„è¿‡ç¨‹</title>
      <link href="/posts/be499e2d/"/>
      <url>/posts/be499e2d/</url>
      
        <content type="html"><![CDATA[<h3 id="1-æ›´æ–°ç³»ç»ŸåŒ…"><a href="#1-æ›´æ–°ç³»ç»ŸåŒ…" class="headerlink" title="1. æ›´æ–°ç³»ç»ŸåŒ…"></a>1. æ›´æ–°ç³»ç»ŸåŒ…</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update sudo apt upgrade -y</span><br></pre></td></tr></table></figure><h3 id="2-å®‰è£…Node-js"><a href="#2-å®‰è£…Node-js" class="headerlink" title="2. å®‰è£…Node.js"></a>2. å®‰è£…Node.js</h3><p>è¿™é‡Œå¯ä»¥é€‰æ‹©éšæ„çš„ç‰ˆæœ¬å¦‚21.x</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash - sudo apt-get install -y nodejs</span><br></pre></td></tr></table></figure><h3 id="3-å®‰è£…Git"><a href="#3-å®‰è£…Git" class="headerlink" title="3. å®‰è£…Git"></a>3. å®‰è£…Git</h3><p>Gitæ˜¯ç®¡ç†Hexoåšå®¢æºç çš„å¿…éœ€å·¥å…·ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install git -y</span><br></pre></td></tr></table></figure><h3 id="4-å®‰è£…Hexo"><a href="#4-å®‰è£…Hexo" class="headerlink" title="4. å®‰è£…Hexo"></a>4. å®‰è£…Hexo</h3><p>å®‰è£…Hexoå‰ï¼Œè¯·ç¡®ä¿å·²ç»å®‰è£…äº†Node.jså’Œnpmã€‚æ¥ä¸‹æ¥ï¼Œä½¿ç”¨npmå…¨å±€å®‰è£…Hexoã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo npm install -g hexo-cli</span><br></pre></td></tr></table></figure><h3 id="5-è®¾ç½®Hexoé¡¹ç›®"><a href="#5-è®¾ç½®Hexoé¡¹ç›®" class="headerlink" title="5. è®¾ç½®Hexoé¡¹ç›®"></a>5. è®¾ç½®Hexoé¡¹ç›®</h3><p>é¦–å…ˆï¼Œé€‰æ‹©ä¸€ä¸ªä½ç½®åˆ›å»ºä½ çš„Hexoé¡¹ç›®ã€‚ç„¶åï¼Œä½¿ç”¨Hexoå‘½ä»¤åˆå§‹åŒ–åšå®¢ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir ~/myblog</span><br><span class="line">cd ~/myblog</span><br><span class="line">hexo init</span><br><span class="line">npm install</span><br></pre></td></tr></table></figure><h3 id="6-é…ç½®Hexo"><a href="#6-é…ç½®Hexo" class="headerlink" title="6. é…ç½®Hexo"></a>6. é…ç½®Hexo</h3><h4 id="1-ç¼–è¾‘é¡¹ç›®è·Ÿç›®å½•ä¸‹çš„-config-ymlæ–‡ä»¶æ¥é…ç½®Hexoï¼Œä¾‹å¦‚æ›´æ”¹ä¸»é¢˜ã€ä¿®æ”¹åšå®¢æ ‡é¢˜ã€æè¿°ç­‰ã€‚"><a href="#1-ç¼–è¾‘é¡¹ç›®è·Ÿç›®å½•ä¸‹çš„-config-ymlæ–‡ä»¶æ¥é…ç½®Hexoï¼Œä¾‹å¦‚æ›´æ”¹ä¸»é¢˜ã€ä¿®æ”¹åšå®¢æ ‡é¢˜ã€æè¿°ç­‰ã€‚" class="headerlink" title="1 ç¼–è¾‘é¡¹ç›®è·Ÿç›®å½•ä¸‹çš„_config.ymlæ–‡ä»¶æ¥é…ç½®Hexoï¼Œä¾‹å¦‚æ›´æ”¹ä¸»é¢˜ã€ä¿®æ”¹åšå®¢æ ‡é¢˜ã€æè¿°ç­‰ã€‚"></a>1 ç¼–è¾‘é¡¹ç›®è·Ÿç›®å½•ä¸‹çš„<code>_config.yml</code>æ–‡ä»¶æ¥é…ç½®Hexoï¼Œä¾‹å¦‚æ›´æ”¹ä¸»é¢˜ã€ä¿®æ”¹åšå®¢æ ‡é¢˜ã€æè¿°ç­‰ã€‚</h4><ul><li><code>title</code>: ç½‘ç«™çš„æ ‡é¢˜ï¼Œå°†æ˜¾ç¤ºåœ¨ç½‘ç«™çš„æ ‡é¢˜æ å’Œå…¶ä»–ä½ç½®ã€‚</li><li><code>subtitle</code>: ç½‘ç«™çš„å‰¯æ ‡é¢˜ï¼Œé€šå¸¸ç”¨äºè¿›ä¸€æ­¥æè¿°ç½‘ç«™çš„å†…å®¹æˆ–ä¸»é¢˜ã€‚</li><li><code>description</code>: å¯¹ç½‘ç«™çš„ç®€çŸ­æè¿°ï¼Œç”¨äºSEOå’Œæœç´¢å¼•æ“ç»“æœä¸­æ˜¾ç¤ºã€‚</li><li><code>keywords</code>: ç½‘ç«™çš„å…³é”®è¯ï¼Œç”¨äºSEOå’Œæœç´¢å¼•æ“ä¼˜åŒ–ã€‚</li><li><code>author</code>: ç½‘ç«™çš„ä½œè€…æˆ–æ‰€æœ‰è€…çš„åç§°ã€‚</li><li><code>language</code>: ç½‘ç«™ä½¿ç”¨çš„è¯­è¨€ï¼Œé€šå¸¸é‡‡ç”¨ISO 639-1æ ‡å‡†çš„è¯­è¨€ä»£ç ã€‚</li><li><code>timezone</code>: ç½‘ç«™æ‰€åœ¨åœ°åŒºçš„æ—¶åŒºï¼Œé€šå¸¸é‡‡ç”¨IANAæ—¶åŒºæ•°æ®åº“ä¸­çš„æ—¶åŒºåç§°ã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">timezone: Asia/Shanghai #è®¾ç½®æ—¶åŒº</span><br><span class="line">language: zh-CN  #è®¾ç½®è¯­è¨€</span><br></pre></td></tr></table></figure><h4 id="2-åˆ›å»ºå›¾ç‰‡ä»¥åŠæ–‡ä»¶ç›®å½•"><a href="#2-åˆ›å»ºå›¾ç‰‡ä»¥åŠæ–‡ä»¶ç›®å½•" class="headerlink" title="2 åˆ›å»ºå›¾ç‰‡ä»¥åŠæ–‡ä»¶ç›®å½•"></a>2 åˆ›å»ºå›¾ç‰‡ä»¥åŠæ–‡ä»¶ç›®å½•</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~/myblog</span><br><span class="line">mkdir images &amp;&amp; mkdir images</span><br></pre></td></tr></table></figure><p>é€šå¸¸ï¼ŒHexoä¸­çš„å›¾ç‰‡å¯ä»¥æ”¾åœ¨<code>source</code>ç›®å½•ä¸‹çš„ä»»ä½•åœ°æ–¹ã€‚ä½ å¯ä»¥åœ¨<code>source</code>ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª<code>images</code>æ–‡ä»¶å¤¹ï¼Œç„¶åå°†ä½ çš„å›¾ç‰‡æ”¾åœ¨å…¶ä¸­ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">source/</span><br><span class="line">â””â”€â”€ images/</span><br><span class="line">    â”œâ”€â”€ image1.jpg</span><br><span class="line">    â”œâ”€â”€ image2.png</span><br><span class="line">    â””â”€â”€ ...</span><br></pre></td></tr></table></figure><p>ä¸€æ—¦ä½ å°†å›¾ç‰‡æ”¾åœ¨äº†<code>source/images</code>ç›®å½•ä¸‹ï¼ŒHexoä¼šè‡ªåŠ¨å°†å…¶å¤åˆ¶åˆ°ç”Ÿæˆçš„é™æ€ç½‘ç«™ä¸­çš„ç›¸åº”ä½ç½®ã€‚ä½ å¯ä»¥åœ¨æ–‡ç« æˆ–é¡µé¢ä¸­ä½¿ç”¨ç›¸å¯¹è·¯å¾„å¼•ç”¨è¿™äº›å›¾ç‰‡ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æœ‰ä¸€ç¯‡æ–‡ç« ä½äº<code>source/_posts</code>ç›®å½•ä¸‹ï¼Œä½ å¯ä»¥åœ¨æ–‡ç« ä¸­è¿™æ ·å¼•ç”¨å›¾ç‰‡ï¼š</p><p><code>![å›¾ç‰‡æè¿°](../images/image1.jpg)</code></p><p>è¿™å°†åœ¨æ–‡ç« ä¸­æ’å…¥åä¸º<code>image1.jpg</code>çš„å›¾ç‰‡ï¼Œå¹¶å°†å…¶è·¯å¾„è®¾ç½®ä¸ºç›¸å¯¹äºæ–‡ç« æ‰€åœ¨ä½ç½®çš„è·¯å¾„ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">source/</span><br><span class="line">â””â”€â”€ files/</span><br><span class="line">    â”œâ”€â”€ file1.pdf</span><br><span class="line">    â”œâ”€â”€ file2.zip</span><br><span class="line">    â””â”€â”€ ...</span><br></pre></td></tr></table></figure><p><code>[æ–‡ä»¶é“¾æ¥æè¿°](../files/file1.pdf)</code></p><h4 id="3-å®‰è£…æ’ä»¶"><a href="#3-å®‰è£…æ’ä»¶" class="headerlink" title="3 .å®‰è£…æ’ä»¶"></a>3 .å®‰è£…æ’ä»¶</h4><p><a href="https://github.com/wzpan/hexo-generator-search">å…¨å±€æœç´¢</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-generator-search --save</span><br></pre></td></tr></table></figure><p>æ ¹ç›®å½•é…ç½®æ–‡ä»¶<code>_config.yml</code>ï¼ˆéä¸»é¢˜é…ç½®æ–‡ä»¶ï¼‰ä¸‹æ·»åŠ ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">search:</span><br><span class="line">path: search.xml</span><br><span class="line">field: post</span><br><span class="line">content: true</span><br></pre></td></tr></table></figure><p>ç«™ç‚¹åœ°å›¾</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-generator-sitemap --save</span><br></pre></td></tr></table></figure><p>æ ¹ç›®å½•é…ç½®æ–‡ä»¶<code>_config.yml</code>ï¼ˆéä¸»é¢˜é…ç½®æ–‡ä»¶ï¼‰ä¸‹æ·»åŠ ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sitemap:</span><br><span class="line">  path: sitemap.xml</span><br></pre></td></tr></table></figure><p><code>http://localhost:4000/sitemap.xml</code></p><h3 id="7-ç”Ÿæˆç«™ç‚¹å¹¶é¢„è§ˆ"><a href="#7-ç”Ÿæˆç«™ç‚¹å¹¶é¢„è§ˆ" class="headerlink" title="7. ç”Ÿæˆç«™ç‚¹å¹¶é¢„è§ˆ"></a>7. ç”Ÿæˆç«™ç‚¹å¹¶é¢„è§ˆ</h3><p>åœ¨ä½ çš„Hexoé¡¹ç›®ç›®å½•ä¸­ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥ç”Ÿæˆé™æ€æ–‡ä»¶ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo generate</span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œå¯åŠ¨HexoæœåŠ¡å™¨ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo server</span><br></pre></td></tr></table></figure><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™å°†åœ¨<code>http://localhost:4000</code>å¯åŠ¨ä¸€ä¸ªæœ¬åœ°æœåŠ¡å™¨ã€‚ç”±äºè¿™æ˜¯åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šï¼Œä½ å¯èƒ½éœ€è¦é€šè¿‡ä¸€ä¸ªå…·ä½“çš„IPåœ°å€æˆ–åŸŸåè®¿é—®å®ƒï¼Œç¡®ä¿ä½ çš„é˜²ç«å¢™å’Œç½‘ç»œè®¾ç½®å…è®¸ä»å¤–éƒ¨è®¿é—®4000ç«¯å£ã€‚</p><h3 id="8-å®‰è£…ä¸»é¢˜"><a href="#8-å®‰è£…ä¸»é¢˜" class="headerlink" title="8.å®‰è£…ä¸»é¢˜"></a>8.å®‰è£…ä¸»é¢˜</h3><blockquote><p>è¿™é‡Œä»¥<a href="https://github.com/zchengsite/hexo-theme-oranges/blob/master/README-zh.md">orange</a>ä¸ºåˆ—</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git init</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git submodule add https://github.com/zchengsite/hexo-theme-oranges.git themes/oranges</span><br></pre></td></tr></table></figure><p>åœ¨ hexo åšå®¢é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰¾åˆ°<code>_config.yml</code>æ–‡ä»¶ï¼Œä¿®æ”¹å…¶ä¸­<code>theme</code>å­—æ®µä¸ºä¸»é¢˜å<code>oranges</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">theme: oranges</span><br></pre></td></tr></table></figure><p>ç»Ÿè®¡JSç›®å½•<code>~/myblog/themes/oranges/layout/_partial/footer.ejs</code><br><strong>æ›´å¤šè®¾ç½®</strong>è¯·å‚è€ƒ <a href="https://github.com/zchengsite/hexo-theme-oranges/blob/master/README-zh.md">OrangeREADME.md</a> </p><h3 id="9-å‘å¸ƒæ–‡ç« "><a href="#9-å‘å¸ƒæ–‡ç« " class="headerlink" title="9.å‘å¸ƒæ–‡ç« "></a>9.å‘å¸ƒæ–‡ç« </h3><p><strong>åˆ›å»ºæ–°æ–‡ç« </strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo new &quot;æ–‡ç« æ ‡é¢˜&quot;</span><br></pre></td></tr></table></figure><p>æˆ–è€…ç›´æ¥å‡†å¤‡å¥½çš„mdæ–‡ä»¶æ”¾å…¥<code>cd ~/myblog/source/_posts</code>ä¸­</p><p><strong>æ·»åŠ å…ƒæ•°æ®</strong>ï¼ˆFront-matterï¼‰ï¼šæ–‡ç« é¡¶éƒ¨çš„å…ƒæ•°æ®åŒºåŸŸå…è®¸ä½ æŒ‡å®šå…³äºæ–‡ç« çš„ä¿¡æ¯ï¼Œä¾‹å¦‚æ ‡é¢˜ã€æ—¥æœŸã€åˆ†ç±»å’Œæ ‡ç­¾ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: æ–‡ç« æ ‡é¢˜</span><br><span class="line">date: 2024-03-07 20:00:00</span><br><span class="line">categories: åˆ†ç±»</span><br><span class="line">tags:</span><br><span class="line">  - æ ‡ç­¾1</span><br><span class="line">  - æ ‡ç­¾2</span><br><span class="line">---</span><br><span class="line">....æ–‡ç« æ­£æ–‡</span><br></pre></td></tr></table></figure><p>ä¸Šçº¿æ–‡ç« </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo clean &amp;&amp; hexo generate &amp;&amp; hexo server</span><br></pre></td></tr></table></figure><h3 id="10-ä½¿ç”¨PM2æ¥ç®¡ç†HexoæœåŠ¡å™¨çš„åå°è¿è¡Œ"><a href="#10-ä½¿ç”¨PM2æ¥ç®¡ç†HexoæœåŠ¡å™¨çš„åå°è¿è¡Œ" class="headerlink" title="10 ä½¿ç”¨PM2æ¥ç®¡ç†HexoæœåŠ¡å™¨çš„åå°è¿è¡Œ"></a>10 ä½¿ç”¨PM2æ¥ç®¡ç†HexoæœåŠ¡å™¨çš„åå°è¿è¡Œ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install pm2 -g</span><br></pre></td></tr></table></figure><p><strong>åˆ›å»ºä¸€ä¸ª<code>js</code>è„šæœ¬</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">const &#123; exec &#125; = require(&#x27;child_process&#x27;);</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">// è®¾ç½®Hexoçš„æ ¹ç›®å½•</span><br><span class="line"></span><br><span class="line">const hexoRoot = &#x27;~/myblog&#x27;;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">// æ‰§è¡Œ Hexo ç›¸å…³å‘½ä»¤</span><br><span class="line"></span><br><span class="line">const executeHexoCommands = () =&gt; &#123;</span><br><span class="line"></span><br><span class="line">return new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line"></span><br><span class="line">exec(`cd $&#123;hexoRoot&#125; &amp;&amp; hexo clean &amp;&amp; hexo generate &amp;&amp; hexo server`, (error, stdout, stderr) =&gt; &#123;</span><br><span class="line"></span><br><span class="line">if (error) &#123;</span><br><span class="line"></span><br><span class="line">reject(`æ‰§è¡Œå‡ºé”™: $&#123;error&#125;`);</span><br><span class="line"></span><br><span class="line">return;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">console.log(`stdout: $&#123;stdout&#125;`);</span><br><span class="line"></span><br><span class="line">console.error(`stderr: $&#123;stderr&#125;`);</span><br><span class="line"></span><br><span class="line">resolve();</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">// å¯åŠ¨HexoæœåŠ¡å™¨</span><br><span class="line"></span><br><span class="line">const startHexoServer = async () =&gt; &#123;</span><br><span class="line"></span><br><span class="line">try &#123;</span><br><span class="line"></span><br><span class="line">await executeHexoCommands();</span><br><span class="line"></span><br><span class="line">console.log(&#x27;HexoæœåŠ¡å™¨å·²å¯åŠ¨ï¼&#x27;);</span><br><span class="line"></span><br><span class="line">&#125; catch (err) &#123;</span><br><span class="line"></span><br><span class="line">console.error(err);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">// æ‰§è¡Œè„šæœ¬</span><br><span class="line"></span><br><span class="line">startHexoServer();</span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œåœ¨Hexoåšå®¢çš„æ ¹ç›®å½•ä¸‹ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯åŠ¨ä½ çš„<code>.js</code>è„šæœ¬ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pm2 start run.js --name &quot;hexo-script&quot;</span><br></pre></td></tr></table></figure><p>è¿™å°†ä½¿ç”¨PM2å¯åŠ¨ä½ çš„è„šæœ¬ï¼Œå¹¶å°†å…¶å‘½åä¸ºâ€hexo-scriptâ€ï¼ˆå¯ä»¥é€‰æ‹©å…¶ä»–åç§°ï¼‰</p><p>ä¹‹åå¯åŠ¨å¯ä»¥ä½¿ç”¨è¯¥å‘½ä»¤å¯åŠ¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pm2 start hexo-script#å¯åŠ¨</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pm2 stop hexo-script#åœæ­¢</span><br></pre></td></tr></table></figure><p>åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨å¯åŠ¨è¿™ä¸ªè„šæœ¬ï¼Œå¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pm2 startup</span><br></pre></td></tr></table></figure><p>æŒ‰ç…§å‘½ä»¤è¡Œä¸­ç»™å‡ºçš„æŒ‡ç¤ºï¼Œæ‰§è¡Œç›¸åº”çš„å‘½ä»¤ï¼Œä»¥ä¾¿PM2èƒ½å¤Ÿåœ¨ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨å¯åŠ¨ã€‚</p><p>é€šè¿‡è¿™æ ·è®¾ç½®ï¼Œä½ çš„Hexoåšå®¢å°†ç”±PM2ç®¡ç†ï¼Œä½ å¯ä»¥è½»æ¾åœ°è¿è¡Œä½ çš„è„šæœ¬å¹¶ç¡®ä¿å®ƒåœ¨ç³»ç»Ÿé‡å¯åè‡ªåŠ¨å¯åŠ¨</p>]]></content>
      
      
      <categories>
          
          <category> æ‚è°ˆ </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>ç®€å•ç²—æš´çš„ç»™ä½ FPRæœåŠ¡é™åˆ¶åœ°åŒºè®¿é—®ï¼Œå…¶ä»–åŒç†</title>
      <link href="/posts/5e2f897e/"/>
      <url>/posts/5e2f897e/</url>
      
        <content type="html"><![CDATA[<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">!/bin/bash</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">FRP å®¹å™¨åç§°</span></span><br><span class="line">CONTAINER_NAME=&quot;frps&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ipinfo.io çš„ API ä»¤ç‰Œ</span></span><br><span class="line">IPINFO_TOKEN=&quot;ä½ çš„ä»¤ç‰Œã€‚æ¯ä¸ªæœˆèƒ½å…è´¹ä½¿ç”¨50Ké¢åº¦ï¼ŒåŸºæœ¬å¤Ÿäº†&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç›®æ ‡åœ°åŒº</span></span><br><span class="line">TARGET_REGION=&quot;Sichuan&quot;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç¼“å­˜æ–‡ä»¶è·¯å¾„</span></span><br><span class="line">CACHE_FILE=&quot;/opt/banIP/ip_region_cache.txt&quot;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å‡½æ•°ï¼šæ£€æŸ¥ IP æ˜¯å¦ä¸ºç‰¹æ®Šæˆ–ä¿ç•™åœ°å€</span></span><br><span class="line">is_special_ip() &#123;</span><br><span class="line">    local ip=$1</span><br><span class="line">    if [[ $ip =~ ^(0\.|127\.|10\.|192\.168\.|172\.(1[6-9]|2[0-9]|3[0-1])\.|169\.254\.|::1|fc00::|fe80::) ]]; then</span><br><span class="line">        return 0</span><br><span class="line">    else</span><br><span class="line">        return 1</span><br><span class="line">    fi</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å‡½æ•°ï¼šä»ç¼“å­˜è·å– IP åœ°åŒº</span></span><br><span class="line">get_region_from_cache() &#123;</span><br><span class="line">    local ip=$1</span><br><span class="line">    grep &quot;^$ip,&quot; $CACHE_FILE | cut -d &#x27;,&#x27; -f2</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">å‡½æ•°ï¼šå°† IP åœ°åŒºä¿å­˜åˆ°ç¼“å­˜</span></span><br><span class="line">save_region_to_cache() &#123;</span><br><span class="line">    local ip=$1</span><br><span class="line">    local region=$2</span><br><span class="line">    echo &quot;$ip,$region&quot; &gt;&gt; $CACHE_FILE</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">docker logs &quot;$CONTAINER_NAME&quot; 2&gt;&amp;1 | grep -oE &quot;\b([0-9]&#123;1,3&#125;\.)&#123;3&#125;[0-9]&#123;1,3&#125;\b&quot; | sort -u | while read -r ip; do</span><br><span class="line">    if is_special_ip &quot;$ip&quot;; then</span><br><span class="line">        echo &quot;Skipping special or reserved IP: $ip&quot;</span><br><span class="line">        continue</span><br><span class="line">    fi</span><br><span class="line"></span><br><span class="line">    # å°è¯•ä»ç¼“å­˜è·å–åœ°åŒº</span><br><span class="line">    region=$(get_region_from_cache &quot;$ip&quot;)</span><br><span class="line">    if [ -z &quot;$region&quot; ]; then</span><br><span class="line">        # ç¼“å­˜ä¸­æ²¡æœ‰æ‰¾åˆ°ï¼Œä½¿ç”¨APIæŸ¥è¯¢</span><br><span class="line">        region=$(curl -s &quot;https://ipinfo.io/$&#123;ip&#125;/region?token=$IPINFO_TOKEN&quot;)</span><br><span class="line">        save_region_to_cache &quot;$ip&quot; &quot;$region&quot;</span><br><span class="line">    fi</span><br><span class="line"></span><br><span class="line">    echo &quot;IP: $ip, Region: $region&quot;</span><br><span class="line"></span><br><span class="line">    if [[ &quot;$region&quot; != *&quot;$TARGET_REGION&quot;* ]]; then</span><br><span class="line">        echo &quot;Blocking IP: $ip, as it is not in $TARGET_REGION&quot;</span><br><span class="line">        # ä½¿ç”¨ ufw å±è”½è¯¥ IP</span><br><span class="line">        ufw deny from &quot;$ip&quot; to any</span><br><span class="line">    fi</span><br><span class="line">done</span><br></pre></td></tr></table></figure><h2 id="æ­¥éª¤-1-åˆ›å»ºè„šæœ¬æ–‡ä»¶"><a href="#æ­¥éª¤-1-åˆ›å»ºè„šæœ¬æ–‡ä»¶" class="headerlink" title="æ­¥éª¤ 1: åˆ›å»ºè„šæœ¬æ–‡ä»¶"></a><strong>æ­¥éª¤ 1: åˆ›å»ºè„šæœ¬æ–‡ä»¶</strong></h2><p>é¦–å…ˆï¼Œé¦–å…ˆåˆ›å»ºä¸€ä¸ª <code>/opt/banIP</code> ç›®å½•ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /opt/banIP</span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œåˆ›å»ºè„šæœ¬æ–‡ä»¶ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano /opt/banIP/block_non_sichuan_ips.sh</span><br></pre></td></tr></table></figure><p>å°†ä¹‹å‰æä¾›çš„è„šæœ¬å†…å®¹ç²˜è´´è¿›å»ï¼Œç¡®ä¿æ›¿æ¢äº† ä¸ºä½ çš„å®é™… ipinfo.io API ä»¤ç‰Œã€‚ä¿å­˜å¹¶é€€å‡ºç¼–è¾‘å™¨ã€‚</p><p>å†åˆ›å»ºä¸€ä¸ªç¼“å­˜ç›®å½•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">touch /opt/banIP/ip_region_cache.txt</span><br></pre></td></tr></table></figure><p>å¦‚æœä½ è‡ªå®šä¹‰äº†ç›®å½•è¯·æ³¨æ„è„šæœ¬çš„ä¸­ç›®å½•æ˜¯å¦ä¸€è‡´</p><h2 id="æ­¥éª¤2è®¾ç½®ä¸€ä¸ªå®šæ—¶è¿è¡Œ"><a href="#æ­¥éª¤2è®¾ç½®ä¸€ä¸ªå®šæ—¶è¿è¡Œ" class="headerlink" title="æ­¥éª¤2è®¾ç½®ä¸€ä¸ªå®šæ—¶è¿è¡Œ"></a>æ­¥éª¤2è®¾ç½®ä¸€ä¸ªå®šæ—¶è¿è¡Œ</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x /opt/banIP/block_non_sichuan_ips.sh</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">crontab -e</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 * * * * /opt/banIP/block_non_sichuan_ips.sh &gt;&gt; /opt/banIP/block_ips.log 2&gt;&amp;1</span><br></pre></td></tr></table></figure><ol><li><p>è¿™æ¡ <code>crontab</code> é…ç½®çš„æ„æ€æ˜¯ï¼š</p><ul><li><p><code>0</code> åˆ†é’Ÿæ—¶æ‰§è¡Œï¼Œå³æ¯ä¸ªå°æ—¶çš„å¼€å§‹ã€‚</p></li><li><p><code>* * * *</code> è¡¨ç¤ºæ¯å°æ—¶ã€æ¯å¤©ã€æ¯æœˆã€æ¯å‘¨çš„ä»»ä½•æ—¶é—´ã€‚</p></li><li><p><code>/opt/banIP/block_non_sichuan_ips.sh</code> æŒ‡å®šè„šæœ¬çš„è·¯å¾„ã€‚</p></li><li><p><code>&gt;&gt; /opt/banIP/block_ips.log 2&gt;&amp;1</code> æ„å‘³ç€å°†æ ‡å‡†è¾“å‡ºå’Œé”™è¯¯è¾“å‡ºéƒ½é‡å®šå‘åˆ°æ—¥å¿—æ–‡ä»¶ã€‚</p></li></ul></li><li><p><strong>ä¿å­˜å¹¶é€€å‡ºç¼–è¾‘å™¨</strong>ï¼š ä¿å­˜æ›´æ”¹å¹¶é€€å‡ºç¼–è¾‘å™¨ã€‚<code>crontab</code> æœåŠ¡ä¼šè‡ªåŠ¨åŠ è½½è¿™ä¸ªæ–°çš„å®šæ—¶ä»»åŠ¡ã€‚</p></li></ol><p>æ³¨æ„è„šæœ¬åˆ›å»ºæˆåŠŸåè‡ªå·±æ‰§è¡Œä¸€æ¬¡ï¼Œçœ‹æ˜¯å¦æˆåŠŸ</p>]]></content>
      
      
      <categories>
          
          <category> æ‚è°ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¦‚ä½•åœ¨Windowsä¸Šè§£é”è¢«é”å®šçš„Jellyfinç”¨æˆ·è´¦æˆ·åŠæ¢å¤ç®¡ç†å‘˜æƒé™</title>
      <link href="/posts/32e62b4e/"/>
      <url>/posts/32e62b4e/</url>
      
        <content type="html"><![CDATA[<h3 id="åœ¨Windowsä¸Šè§£é”è¢«Jellyfiné”å®šçš„è´¦æˆ·åŠæ¢å¤ç®¡ç†å‘˜æƒé™"><a href="#åœ¨Windowsä¸Šè§£é”è¢«Jellyfiné”å®šçš„è´¦æˆ·åŠæ¢å¤ç®¡ç†å‘˜æƒé™" class="headerlink" title="åœ¨Windowsä¸Šè§£é”è¢«Jellyfiné”å®šçš„è´¦æˆ·åŠæ¢å¤ç®¡ç†å‘˜æƒé™"></a>åœ¨Windowsä¸Šè§£é”è¢«Jellyfiné”å®šçš„è´¦æˆ·åŠæ¢å¤ç®¡ç†å‘˜æƒé™</h3><p>å¦‚æœä½ ä¹Ÿæ˜¯é±¼çš„è®°å¿†ï¼Œè¾“é”™Jellyfinå¯†ç å¯¼è‡´è¢«é”è¿™ä¸ªæ–¹æ¡ˆèƒ½å¸®åˆ°ä½ </p><hr><h2 id="å‡†å¤‡æ¡ä»¶"><a href="#å‡†å¤‡æ¡ä»¶" class="headerlink" title="å‡†å¤‡æ¡ä»¶"></a>å‡†å¤‡æ¡ä»¶</h2><ul><li>ç¡®ä¿æ‚¨çš„Windowsç³»ç»Ÿå·²ç»å®‰è£…äº†<code>sqlite3</code>ã€‚å¦‚æœæ²¡æœ‰ï¼Œè¯·ä¸‹è½½SQLiteäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¹¶å°†å…¶æ”¾åœ¨å¦‚<code>C:\\sqlite3\\</code>çš„ç›®å½•ä¸‹ã€‚</li></ul><h2 id="è§£é”è´¦æˆ·çš„æ­¥éª¤"><a href="#è§£é”è´¦æˆ·çš„æ­¥éª¤" class="headerlink" title="è§£é”è´¦æˆ·çš„æ­¥éª¤"></a>è§£é”è´¦æˆ·çš„æ­¥éª¤</h2><p>å¦‚æœè§£é”ç”¨æˆ·åä¸º<code>123</code>ï¼š</p><ol><li><p>æ‰“å¼€å‘½ä»¤æç¤ºç¬¦ï¼ˆCMDï¼‰ã€‚</p></li><li><p>å¯¼èˆªè‡³åŒ…å«Jellyfinæ•°æ®åº“çš„ç›®å½•ï¼š</p></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> C:\\ProgramData\\Jellyfin\\Server\\data</span><br></pre></td></tr></table></figure><ol start="3"><li>ä½¿ç”¨ä½äº<code>C:\\sqlite3</code>çš„SQLite3å·¥å…·æ‰“å¼€æ•°æ®åº“ï¼š</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\\sqlite3\\sqlite3.exe jellyfin.db</span><br></pre></td></tr></table></figure><ol start="4"><li>åœ¨SQLiteå‘½ä»¤è¡Œä¸­ï¼Œæ‰§è¡Œä»¥ä¸‹SQLæŸ¥è¯¢è§£é”<code>123</code>è´¦æˆ·ï¼š</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> Users <span class="keyword">SET</span> InvalidLoginAttemptCount <span class="operator">=</span> <span class="number">0</span> <span class="keyword">WHERE</span> Username <span class="operator">=</span> <span class="string">&#x27;123&#x27;</span>;</span><br><span class="line"><span class="keyword">UPDATE</span> Permissions <span class="keyword">SET</span> <span class="keyword">Value</span> <span class="operator">=</span> <span class="number">0</span> <span class="keyword">WHERE</span> Kind <span class="operator">=</span> <span class="number">2</span> <span class="keyword">AND</span> UserId <span class="keyword">IN</span> (<span class="keyword">SELECT</span> Id <span class="keyword">FROM</span> Users <span class="keyword">WHERE</span> Username <span class="operator">=</span> <span class="string">&#x27;123&#x27;</span>);</span><br><span class="line">.exit</span><br></pre></td></tr></table></figure><p>è¾“å…¥åé‡ç½®<code>123</code>çš„æ— æ•ˆç™»å½•å°è¯•è®¡æ•°ï¼Œå¹¶è§£é”è´¦æˆ·ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ‚è°ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> jellyfin </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®°å½•ä¸€ä¸‹Nginx Proxy Managerè®¾ç½®è´Ÿè½½å‡è¡¡çš„æ–¹æ³•</title>
      <link href="/posts/b9fdd6a/"/>
      <url>/posts/b9fdd6a/</url>
      
        <content type="html"><![CDATA[<p>dockerå®‰è£…å¥½NPMåï¼Œ<br>è¿›å…¥å®‰è£…ç›®å½•&#x2F;npm&#x2F;date&#x2F;nginx<br>åˆ›å»º<code>custom/http.conf</code><br>å¦‚<code>/opt/docker/npm/data/nginx/custom/http.conf</code></p><p><code>http.conf</code>é…ç½®èŒƒæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">upstream 2fa &#123;</span><br><span class="line">    server ä½ çš„æœåŠ¡å™¨IP:åº”ç”¨ç«¯å£;</span><br><span class="line">    server 1.1.1.1:120;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">upstream jellyfin &#123;</span><br><span class="line">    server 2.2.2.2:18096;</span><br><span class="line">    server 3.3.3.3:18096;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">upstream pcisur &#123;</span><br><span class="line">    server 4.4.4.4:28003;</span><br><span class="line">    server 5.5.5.5:28003;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">upstream song &#123;</span><br><span class="line">    server 6.6.6.6:14533;</span><br><span class="line">    server 7.7.7.7:14533;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Š2fa,jellyfinâ€¦.ä¸ºåº”ç”¨åç§°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">upstream 2fa &#123;</span><br><span class="line">    server 149.104.22.155:18120 weight=3;</span><br><span class="line">    server 103.30.77.177:18120 weight=1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ç§æ–¹å¼æ˜¯ç»™æœåŠ¡å™¨é…ç½®æƒé‡ï¼Œè¿™ç§é…ç½®åœ¨æŸç§ç¨‹åº¦ä¸Šå¯ä»¥ä½œä¸ºä¼˜å…ˆçº§çš„ä»£ç†ï¼šå…·æœ‰æ›´é«˜æƒé‡çš„æœåŠ¡å™¨ä¼šå¤„ç†æ›´å¤šçš„è¯·æ±‚ã€‚ä½†è¯·æ³¨æ„ï¼Œè¿™å¹¶ä¸ä¿è¯ç¬¬ä¸€ä¸ªæœåŠ¡å™¨æ€»æ˜¯è¢«ä¼˜å…ˆé€‰æ‹©ã€‚å½“ç¬¬ä¸€ä¸ªæœåŠ¡å™¨å¿™ç¢Œæˆ–è¾¾åˆ°å…¶è´Ÿè½½å®¹é‡æ—¶ï¼Œæ–°çš„è¯·æ±‚ä»ç„¶å¯èƒ½è¢«è·¯ç”±åˆ°æƒé‡è¾ƒä½çš„æœåŠ¡å™¨</p><p>æ¥ä¸‹æ¥è¿›å…¥NPMåå°</p><p><img src="https://cloudflare.free-img.ososo.org/file/1732423594241_%E6%88%AA%E5%9B%BE%202024-01-26%2016-22-08.png" alt="æˆªå›¾ 2024-01-26 16-22-08.png"></p><p>å¦‚å›¾æ‰€ç¤ºå¡«å†™ä½ çš„åŸŸåï¼ŒæœåŠ¡å™¨IPï¼Œ<strong>ç«¯å£å·HTTPéƒ½å¡«å†™80,HTTPSéƒ½å¡«å†™443</strong></p><p>ç‚¹å‡»é«˜çº§è®¾ç½®</p><p><img src="https://cloudflare.free-img.ososo.org/file/1732423690347_%E6%88%AA%E5%9B%BE%202024-01-26%2016-25-37.png" alt="æˆªå›¾ 2024-01-26 16-25-37.png"></p><p>è¾“å…¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">    proxy_pass http://2fa;#2faä¸ºä½ åˆšæ‰ç¼–è¾‘çš„http.confé‡Œé¢çš„åº”ç”¨æ°‘ç§°</span><br><span class="line">    # 80ç«¯å£ç”¨http://2fa;443ç«¯å£ç”¨https://2fa;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®Œæ•´é…ç½®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">    proxy_pass http://2fa;</span><br><span class="line">    proxy_set_header Host $host;</span><br><span class="line">    proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">    proxy_set_header X-Forwarded-Proto $scheme;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¿å­˜åå°±è®¾ç½®æˆåŠŸäº†</p>]]></content>
      
      
      <categories>
          
          <category> Nginx </category>
          
          <category> è´Ÿè½½å‡è¡¡ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
            <tag> Nginx Proxy Manager </tag>
            
            <tag> è´Ÿè½½å‡è¡¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä»é›¶å¼€å§‹ï¼ŒALL-IN-ONE ï¼ŒGPTä½¿ç”¨ä»æœªå¦‚æ­¤ç®€å•</title>
      <link href="/posts/832634fa/"/>
      <url>/posts/832634fa/</url>
      
        <content type="html"><![CDATA[<table><thead><tr><th>å¤ªè¿‡è¿œå¤ï¼Œæœ¬æ•™ç¨‹è€ƒå¤æŠŠ</th></tr></thead></table><blockquote><p>éƒ¨ç½²ç¯å¢ƒï¼š<br>ç³»ç»Ÿï¼šdebian11<br> ä¸€ä¸ªåŠå¹´ä»¥ä¸Šçš„GitHubè´¦å· </p></blockquote><p>æœ¬æ–‡æ¶‰åŠ4ä¸ªå¼€æºé¡¹ç›®ï¼š</p><blockquote><p>NPM:<a href="https://github.com/NginxProxyManager/nginx-proxy-manager">NginxProxyManager&#x2F;nginx-proxy-manager</a><br>pandora-next:<a href="https://github.com/pandora-next/deploy">pandora-next&#x2F;deploy</a><br>PandoraNext-TokensTool:<a href="https://github.com/Yanyutin753/PandoraNext-TokensTool">Yanyutin753&#x2F;PandoraNext-TokensTool</a><br>ChatGPT-Next-Web:<a href="https://github.com/Yidadaa/ChatGPT-Next-Web">Yidadaa&#x2F;ChatGPT-Next-Web</a></p></blockquote><p>å¦‚æœè§‰å¾—å¥½ç”¨çš„è¯ï¼Œè¯·å…³æ³¨ï¼Œstarä¸€ä¸‹è¿™äº›çˆ±å‘ç”µçš„ä½œè€…ï¼ï¼ï¼</p><h3 id="1ï¼šå…ˆæ›´æ–°ä¸€ä¸‹ç³»ç»Ÿ"><a href="#1ï¼šå…ˆæ›´æ–°ä¸€ä¸‹ç³»ç»Ÿ" class="headerlink" title="1ï¼šå…ˆæ›´æ–°ä¸€ä¸‹ç³»ç»Ÿ"></a>1ï¼šå…ˆæ›´æ–°ä¸€ä¸‹ç³»ç»Ÿ</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">apt update &amp;&amp; apt upgrade -y</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="2ï¼šå®‰è£…docker"><a href="#2ï¼šå®‰è£…docker" class="headerlink" title="2ï¼šå®‰è£…docker"></a>2ï¼šå®‰è£…docker</h3><h4 id="â‘ ï¼šæä¾›å››ä¸ªå®‰è£…è„šæœ¬"><a href="#â‘ ï¼šæä¾›å››ä¸ªå®‰è£…è„šæœ¬" class="headerlink" title="â‘ ï¼šæä¾›å››ä¸ªå®‰è£…è„šæœ¬"></a>â‘ ï¼šæä¾›å››ä¸ªå®‰è£…è„šæœ¬</h4><ul><li>å®˜æ–¹ï¼š</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -sSL https://get.docker.com/ | sh</span><br></pre></td></tr></table></figure><ul><li>DaoCloud çš„å®‰è£…è„šæœ¬ï¼ˆæ¨èï¼‰:</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -sSL https://get.daocloud.io/docker | sh</span><br></pre></td></tr></table></figure><ul><li>é˜¿é‡Œäº‘çš„å®‰è£…è„šæœ¬:</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -sSL http://acs-public-mirror.oss-cn-hangzhou.aliyuncs.com/docker-engine/internet | sh -</span><br></pre></td></tr></table></figure><ul><li>æ¨èä½¿ç”¨:</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash &lt;(curl -sSL https://gitee.com/SuperManito/LinuxMirrors/raw/main/DockerInstallation.sh)</span><br></pre></td></tr></table></figure><p>éªŒè¯ä¸€ä¸‹dockerå®‰è£…æ˜¯å¦æˆåŠŸ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker -v</span><br></pre></td></tr></table></figure><h4 id="â‘¡ï¼šå®‰è£…-Docker-Compose"><a href="#â‘¡ï¼šå®‰è£…-Docker-Compose" class="headerlink" title="â‘¡ï¼šå®‰è£… Docker Compose"></a>â‘¡ï¼šå®‰è£… Docker Compose</h4><p>è¯·ç¡®ä¿ä½ çš„ç«¯å£æ²¡æœ‰è¢«å ç”¨<br>åœ¨ GitHub ä¸Šè·å–æœ€æ–°ç‰ˆæœ¬çš„ Docker Composeï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo curl -L &quot;https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure><p>èµ‹äºˆæ‰§è¡Œæƒé™ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod +x /usr/local/bin/docker-compose</span><br></pre></td></tr></table></figure><p>å¦‚æœéœ€è¦ä½¿ç”¨é sudo ç”¨æˆ·æ‰§è¡Œ Docker Compose å‘½ä»¤ï¼Œå¯ä»¥å°†è¯¥ç”¨æˆ·æ·»åŠ åˆ° docker ç»„ä¸­ã€‚</p><p>éªŒè¯å®‰è£…ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose --version</span><br></pre></td></tr></table></figure><h3 id="3ï¼šåˆ›å»ºå®‰è£…ç›®å½•"><a href="#3ï¼šåˆ›å»ºå®‰è£…ç›®å½•" class="headerlink" title="3ï¼šåˆ›å»ºå®‰è£…ç›®å½•"></a>3ï¼šåˆ›å»ºå®‰è£…ç›®å½•</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /opt/docker/chat</span><br></pre></td></tr></table></figure><p>æ‹‰å–configæ–‡ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -O /opt/docker/chat/data/config.json https://raw.githubusercontent.com/pandora-next/deploy/master/data/config.json</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;bind&quot;: &quot;0.0.0.0:8181&quot;,</span><br><span class="line">  &quot;tls&quot;: &#123;</span><br><span class="line">    &quot;enabled&quot;: false,</span><br><span class="line">    &quot;cert_file&quot;: &quot;&quot;,</span><br><span class="line">    &quot;key_file&quot;: &quot;&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;timeout&quot;: 600,</span><br><span class="line">  &quot;proxy_url&quot;: &quot;&quot;,</span><br><span class="line">  &quot;license_id&quot;: &quot;&quot;,  # ä¸€å®šè¦å¡«å†™ï¼Œè·å–åœ°å€ï¼šhttps://dash.pandoranext.com/</span><br><span class="line">  &quot;public_share&quot;: false,</span><br><span class="line">  &quot;site_password&quot;: &quot;&quot;,</span><br><span class="line">  &quot;setup_password&quot;: &quot;&quot;,</span><br><span class="line">  &quot;server_tokens&quot;: true,</span><br><span class="line">  &quot;proxy_api_prefix&quot;: &quot;&quot;,</span><br><span class="line">  &quot;isolated_conv_title&quot;: &quot;*&quot;,</span><br><span class="line">  &quot;whitelist&quot;: null</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>license_idè·å–åœ°å€<a href="https://dash.pandoranext.com/">https://dash.pandoranext.com/</a></p><p>å¦‚æœæç¤ºé”™è¯¯,å®‰è£…ä¸€ä¸‹ wget å’Œ curl</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install wget &amp;&amp; sudo apt install curl</span><br></pre></td></tr></table></figure><h3 id="4ï¼š-åˆ›å»ºdocker-compose-ymlæ–‡ä»¶"><a href="#4ï¼š-åˆ›å»ºdocker-compose-ymlæ–‡ä»¶" class="headerlink" title="4ï¼š åˆ›å»ºdocker-compose.ymlæ–‡ä»¶"></a>4ï¼š åˆ›å»ºdocker-compose.ymlæ–‡ä»¶</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano docker-compose.yml</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">version: &#x27;3&#x27;</span><br><span class="line">services:</span><br><span class="line">  pandora-next:</span><br><span class="line">    image: pengzhile/pandora-next</span><br><span class="line">    container_name: PandoraNext</span><br><span class="line">    network_mode: bridge</span><br><span class="line">    restart: always</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;8181:8181&quot;</span><br><span class="line">    volumes:</span><br><span class="line">      - ./data:/data</span><br><span class="line">      - ./sessions:/root/.cache/PandoraNext</span><br><span class="line"></span><br><span class="line">  tokensTool:</span><br><span class="line">    image: yangclivia/tokenstool:latest</span><br><span class="line">    container_name: tokensTool</span><br><span class="line">    restart: always</span><br><span class="line">    user: root</span><br><span class="line">    network_mode: host</span><br><span class="line">    pid: host</span><br><span class="line">    privileged: true</span><br><span class="line">    volumes:</span><br><span class="line">      - ./data:/data</span><br><span class="line">      - /var/run/docker.sock:/var/run/docker.sock</span><br><span class="line">    command:</span><br><span class="line">      - --deployWay=(éƒ¨ç½²æ–¹å¼çœ‹ç¯å¢ƒå˜é‡)</span><br><span class="line">      - --deployPosition=/data</span><br><span class="line">      - --hotReload=true</span><br><span class="line">      - --server.port=8081</span><br><span class="line">      - --pandoara_Ip=127.0.0.1</span><br><span class="line"></span><br><span class="line">  chatgpt-next-web:</span><br><span class="line">    image: yidadaa/chatgpt-next-web</span><br><span class="line">    container_name: ChatGPTNextWeb</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;8090:3000&quot;</span><br><span class="line">    environment:</span><br><span class="line">      - OPENAI_API_KEY=sk-xxxx  # å¡«å†™ä½ çš„ API KEY</span><br><span class="line">      - CODE=your-password      # è®¾ç½®è®¿é—®å¯†ç ï¼Œé˜²æ­¢ API Key è¢«æ»¥ç”¨</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsof -i:8081#å¯ä»¥å…ˆæ£€æµ‹ä¸€ä¸‹ç«¯å£æ˜¯å¦è¢«å ç”¨ lsof -i:ç«¯å£å·</span><br></pre></td></tr></table></figure><p>æŒ‰ä½é”®ç›˜<code>Ctrl+x</code> ï¼Œè¾“å…¥Yä¿å­˜</p><h4 id="docker-compose-up-då¯åŠ¨å®¹å™¨ï¼Œ"><a href="#docker-compose-up-då¯åŠ¨å®¹å™¨ï¼Œ" class="headerlink" title="docker compose up -då¯åŠ¨å®¹å™¨ï¼Œ"></a><code>docker compose up -d</code>å¯åŠ¨å®¹å™¨ï¼Œ</h4><h3 id="å¦‚æœä½ ä¸ä½¿ç”¨-Chat2APIï¼Œè¯·è·³è¿‡è¿™ä¸€æ­¥ã€‚"><a href="#å¦‚æœä½ ä¸ä½¿ç”¨-Chat2APIï¼Œè¯·è·³è¿‡è¿™ä¸€æ­¥ã€‚" class="headerlink" title="å¦‚æœä½ ä¸ä½¿ç”¨ Chat2APIï¼Œè¯·è·³è¿‡è¿™ä¸€æ­¥ã€‚"></a>å¦‚æœä½ ä¸ä½¿ç”¨ Chat2APIï¼Œè¯·è·³è¿‡è¿™ä¸€æ­¥ã€‚</h3><p>é¦–å…ˆè®¿é—®tokensToolï¼šè¾“å…¥ä½ çš„æœåŠ¡å™¨<code>IP:8081</code>è¿›å…¥åå°</p><p>é»˜è®¤è´¦å·ä¸ºï¼š<code>root</code>ï¼Œå¯†ç ä¸º<code>123456</code>ï¼Œ</p><p>å¦‚æœæç¤ºé”™è¯¯è¯·æ£€æŸ¥<code>cat /opt/docker/chat/data/config.json</code>æ–‡ä»¶å†…æ˜¯å¦æœ‰å†…å®¹ï¼Œå¦‚æœæ²¡æœ‰è¯·åˆ›å»º <code>nano /opt/docker/chat/data/config.json</code> ,å¤åˆ¶ä¸Šé¢çš„configé…ç½®</p><p>è¿›å…¥tokensToolè¯·ä¿®æ”¹é»˜è®¤è´¦å·å¯†ç ï¼Œå›¾ä¸Šé¢å¾ˆè¯¦ç»†äº†ï¼Œä¸æ‡‚è¯·åå¤è§‚çœ‹<br><img src="https://cloudflare.free-img.ososo.org/file/1732426247269_%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-12-12%20040347.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜"><br>ç‚¹å‡»+å·æ·»åŠ ä½ çš„openaiè´¦å·,ç¤ºåˆ—å¦‚å›¾<br><img src="https://cloudflare.free-img.ososo.org/file/1732426237386_%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-12-12%20040752.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜"></p><p>è¿™é‡Œè·å–ä¸€æ¬¡tokenå ç”¨100 license_id é¢åº¦</p><blockquote><p>è¿™ä¸ªå®¹å™¨èƒ½å®ç°openaiè´¦å·å¯†ç è·å–pool_tokenã€share_tokenå’Œaccess_token</p></blockquote><h3 id="5ï¼š-æ¥ä¸‹æ¥æˆ‘ä»¬è¾“å…¥ip-8181è®¿é—®Pandoraï¼Œå¦‚æœé…ç½®äº†è®¿é—®å¯†ç ã€‚è¯·è¾“å…¥ä½ çš„å¯†ç ï¼ï¼ï¼"><a href="#5ï¼š-æ¥ä¸‹æ¥æˆ‘ä»¬è¾“å…¥ip-8181è®¿é—®Pandoraï¼Œå¦‚æœé…ç½®äº†è®¿é—®å¯†ç ã€‚è¯·è¾“å…¥ä½ çš„å¯†ç ï¼ï¼ï¼" class="headerlink" title="5ï¼š æ¥ä¸‹æ¥æˆ‘ä»¬è¾“å…¥ip:8181è®¿é—®Pandoraï¼Œå¦‚æœé…ç½®äº†è®¿é—®å¯†ç ã€‚è¯·è¾“å…¥ä½ çš„å¯†ç ï¼ï¼ï¼"></a>5ï¼š æ¥ä¸‹æ¥æˆ‘ä»¬è¾“å…¥<code>ip:8181</code>è®¿é—®Pandoraï¼Œå¦‚æœé…ç½®äº†è®¿é—®å¯†ç ã€‚è¯·è¾“å…¥ä½ çš„å¯†ç ï¼ï¼ï¼</h3><p><img src="https://cloudflare.free-img.ososo.org/file/1732426235930_%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-12-12%20041243.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜"><br>åˆ°äº†è¿™ä¸€æ­¥ï¼Œå¦‚æœä½ è¿˜æ²¡æœ‰openaiè´¦å·å¯ä»¥ç‚¹å‡»é¡µé¢<code>Sign up</code>æ³¨å†Œä½ çš„openè´¦å·ï¼Œæœ€å¥½ç”¨Googleæˆ–å¾®è½¯é‚®ç®±ï¼Œ</p><p>è·å–åˆ°çš„éªŒè¯é“¾æ¥ä¸è¦ç‚¹è¿›å»ï¼ï¼ï¼ï¼ç›´æ¥å³é”®å¤åˆ¶é“¾æ¥<br><img src="https://cloudflare.free-img.ososo.org/file/1732426242218_%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-12-12%20041648.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜"><br>è¿™æ ·ä½ å°±å…ä»£ç†è·å¾—äº†ä¸€ä¸ªopenaiè´¦å·<br><img src="https://cloudflare.free-img.ososo.org/file/1732426244897_%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-12-12%20041931.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜"></p><h3 id="6ï¼šä¸‹é¢è®²ä¸€ä¸‹ChatGPT-Next-Webçš„è®¾ç½®"><a href="#6ï¼šä¸‹é¢è®²ä¸€ä¸‹ChatGPT-Next-Webçš„è®¾ç½®" class="headerlink" title="6ï¼šä¸‹é¢è®²ä¸€ä¸‹ChatGPT-Next-Webçš„è®¾ç½®"></a>6ï¼šä¸‹é¢è®²ä¸€ä¸‹ChatGPT-Next-Webçš„è®¾ç½®</h3><p>è¾“å…¥<code>ip:8090</code>è¿›å…¥ChatGPT-Next-Web</p><p>å¦‚æœæç¤ºè¾“å…¥ å¯†ç è·Ÿ token éšä¾¿è¾“ä¸€ä¸‹ï¼Œå¯ä»¥ä¸ç”¨ç®¡ä»–</p><p>æ¥ä¸‹æ¥ç‚¹å‡»å·¦ä¸‹è§’è®¾ç½®å›¾æ ‡å¦‚å›¾è®¾ç½®<br><img src="https://cloudflare.free-img.ososo.org/file/1732426247275_%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-12-12%20042447.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜"><br><img src="https://cloudflare.free-img.ososo.org/file/1732426239546_%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-12-12%20042731.png" alt="è¾“å…¥å›¾ç‰‡è¯´æ˜"><br>é…ç½®å®Œæˆåå°±èƒ½è·ŸOpenaiç•…èŠäº†</p><p><strong>ï¼ï¼ï¼æ³¨æ„è¿™ä¸ªä¸€ä¸ªèŠå¤©å ç”¨4ä¸ªlicense_id é¢åº¦ï¼Œå¦‚æœé¢åº¦ç´§å¼ çš„è¯å°±åªç”¨Pandoraç½‘é¡µå³å¯ã€‚ä¸€ä¸ªæŒ‡ä»¤ï¼Œå ç”¨1ä¸ªé¢åº¦ã€‚</strong></p><h3 id="å¦‚æœä½ è¿˜æƒ³ä½¿ç”¨åŸŸåè®¿é—®ï¼Œå¯ä»¥dockerå®‰è£…NPM"><a href="#å¦‚æœä½ è¿˜æƒ³ä½¿ç”¨åŸŸåè®¿é—®ï¼Œå¯ä»¥dockerå®‰è£…NPM" class="headerlink" title="å¦‚æœä½ è¿˜æƒ³ä½¿ç”¨åŸŸåè®¿é—®ï¼Œå¯ä»¥dockerå®‰è£…NPM"></a>å¦‚æœä½ è¿˜æƒ³ä½¿ç”¨åŸŸåè®¿é—®ï¼Œå¯ä»¥dockerå®‰è£…NPM</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /opt/docker/npm</span><br><span class="line">nano docker-compose.yml</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">version: &#x27;3&#x27;</span><br><span class="line">services:</span><br><span class="line">app:</span><br><span class="line">image: &#x27;jc21/nginx-proxy-manager:latest&#x27;</span><br><span class="line">restart: unless-stopped</span><br><span class="line">ports:</span><br><span class="line">- &#x27;80:80&#x27; # å†’å·å·¦è¾¹å¯ä»¥æ”¹æˆè‡ªå·±æœåŠ¡å™¨æœªè¢«å ç”¨çš„ç«¯å£</span><br><span class="line">- &#x27;81:81&#x27; # å†’å·å·¦è¾¹å¯ä»¥æ”¹æˆè‡ªå·±æœåŠ¡å™¨æœªè¢«å ç”¨çš„ç«¯å£</span><br><span class="line">- &#x27;443:443&#x27; # å†’å·å·¦è¾¹å¯ä»¥æ”¹æˆè‡ªå·±æœåŠ¡å™¨æœªè¢«å ç”¨çš„ç«¯å£</span><br><span class="line">volumes:</span><br><span class="line">- ./data:/data # å†’å·å·¦è¾¹å¯ä»¥æ”¹è·¯å¾„ï¼Œç°åœ¨æ˜¯è¡¨ç¤ºæŠŠæ•°æ®å­˜æ”¾åœ¨åœ¨å½“å‰æ–‡ä»¶å¤¹ä¸‹çš„ data æ–‡ä»¶å¤¹ä¸­</span><br><span class="line">- ./letsencrypt:/etc/letsencrypt # å†’å·å·¦è¾¹å¯ä»¥æ”¹è·¯å¾„ï¼Œç°åœ¨æ˜¯è¡¨ç¤ºæŠŠæ•°æ®å­˜</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker compose up -d</span><br></pre></td></tr></table></figure><p><strong>è¯·ç¡®ä¿ä½ çš„ç«¯å£æ²¡æœ‰è¢«å ç”¨</strong></p><p>è¾“å…¥ä½ çš„<code>ip:81</code>è®¿é—®npmåå°</p><p>é»˜è®¤è´¦å·å¯†ç </p><p><code>Email: admin@example.com Password: changeme</code></p><p>è¿›å…¥åå°åè¯·åŠæ—¶ä¿®æ”¹è´¦å·ï¼Œå¯†ç ã€‚å…¶ä»–è®¾ç½®è¿˜ä¸æ‡‚è¯·è‡ªè¡Œç™¾åº¦ï¼Œæˆ–è€…é—®GPTã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¼€æºAIäººè„¸æ›¿æ¢å·¥å…·ç¦»çº¿ç‰ˆV3.0 æ•´åˆåŒ…</title>
      <link href="/posts/6e4aa998/"/>
      <url>/posts/6e4aa998/</url>
      
        <content type="html"><![CDATA[<p><img src="https://cloudflare.free-img.ososo.org/file/1732424036332_%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-10-30%20155833.png" alt="å±å¹•æˆªå›¾ 2023-10-30 155833.png"></p><p><img src="https://cloudflare.free-img.ososo.org/file/1732424040558_%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-10-30%20195951.png" alt="å±å¹•æˆªå›¾ 2023-10-30 195951.png"><br>æ— éœ€é…ç½®ä»»ä½•ç¯å¢ƒï¼Œè§£å‹åå³å¯ä½¿ç”¨ï¼Œåªéœ€ä¸€å¼ äººè„¸å›¾ç‰‡ï¼Œå°±å¯ä»¥æŠŠè§†é¢‘ä¸­çš„äººè„¸æ¢æˆä½ éœ€è¦äººç‰©ã€‚æ— ä»»ä½•ä½¿ç”¨é—¨æ§›ï¼Œæ”¯æŒCPUå’ŒGPUè§£ç ï¼</p><p><img src="https://cloudflare.free-img.ososo.org/file/1732424157095_%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-10-30%20200005.png" alt="å±å¹•æˆªå›¾ 2023-10-30 200005.png"><br>å¼€æºé¡¹ç›®ï¼šã€<a href="https://github.com/s0md3v/roop">GitHub</a>ã€‘</p><p>è½¯ä»¶ä½œè€…ï¼š<a href="https://space.bilibili.com/4228235">https://space.bilibili.com/4228235</a></p><p>ä¸‹è½½åœ°å€ï¼š</p><p>è¿…é›·äº‘ç›˜ï¼š<a href="https://pan.xunlei.com/s/VNhzaKoCNgvPBXPcP0_GmFdZA1">https://pan.xunlei.com/s/VNhzaKoCNgvPBXPcP0_GmFdZA1</a></p><p>æå–ç ï¼š<code>rz8k</code></p>]]></content>
      
      
      <categories>
          
          <category> ai </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ai </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸­å¹´ç”Ÿæ´»çš„ä¿¡æ¯ç»ˆç»“è€…ï¼šDocker éƒ¨ç½² RSSæœåŠ¡é‡å¡‘ä¿¡æ¯å…¸é›…</title>
      <link href="/posts/fb6cb13/"/>
      <url>/posts/fb6cb13/</url>
      
        <content type="html"><![CDATA[<p>ä¸­å¹´äººçš„ RSSæœåŠ¡å™¨ Docker éƒ¨ç½²æŒ‡å—</p><blockquote><p>åœ¨å½“ä»Šä¿¡æ¯çˆ†ç‚¸çš„æ—¶ä»£ï¼Œæˆ‘ä»¬ä¸­å¹´äººå¸¸å¸¸é™·å…¥ä¿¡æ¯è¿‡è½½çš„å›°å¢ƒã€‚ç¤¾äº¤åª’ä½“ã€æ–°é—»ç½‘ç«™ã€åšå®¢å’Œè®ºå›ï¼Œæ— å¤„ä¸åœ¨çš„ä¿¡æ¯æºæ¶Œå…¥æˆ‘ä»¬çš„ç”Ÿæ´»ã€‚ç„¶è€Œï¼Œä¸æ­¤åŒæ—¶ï¼Œæˆ‘ä»¬ä¹Ÿé¢ä¸´ç€ä¿¡æ¯è¿‡è½½çš„é—®é¢˜ï¼Œå¾ˆéš¾ä»è¿™æµ·é‡ä¿¡æ¯ä¸­ç­›é€‰å‡ºçœŸæ­£æœ‰ä»·å€¼çš„å†…å®¹ã€‚è¿™å°±æ˜¯é€šå¸¸è¢«æˆç§°ä¸ºâ€œä¿¡æ¯é˜³ç—¿â€çš„å›°æ‰°ã€‚</p><p>å¹¸è¿çš„æ˜¯ï¼Œè‡ªæ‰˜ç®¡RSSé˜…è¯»å™¨ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬è§£å†³è¿™ä¸ªé—®é¢˜ã€‚è€Œä¸”ï¼Œé€šè¿‡ä½¿ç”¨Dockerå®¹å™¨åŒ–æŠ€æœ¯ï¼Œæˆ‘ä»¬èƒ½å¤Ÿè½»æ¾åœ°éƒ¨ç½²å’Œç®¡ç†RSSï¼Œä¸ºçš„ä¿¡æ¯ç®¡ç†æä¾›äº†å…¨æ–°çš„è§£å†³æ–¹æ¡ˆã€‚</p></blockquote><h1 id="TinyTinyRSS-FreshRSSç®€ä»‹"><a href="#TinyTinyRSS-FreshRSSç®€ä»‹" class="headerlink" title="TinyTinyRSS&amp;&amp;FreshRSSç®€ä»‹"></a>TinyTinyRSS&amp;&amp;FreshRSSç®€ä»‹</h1><h1 id=""><a href="#" class="headerlink" title=""></a></h1><blockquote><p><a href="https://tt-rss.org/">TinyTinyRSS</a>&amp;&amp;<a href="https://freshrss.org/">FreshRSS</a>æ˜¯ä¸€ä¸ªå¼€æºçš„è‡ªæ‰˜ç®¡RSSé˜…è¯»å™¨ï¼Œå®ƒå¯ä»¥å¸®åŠ©ä½ è®¢é˜…ä½ å–œçˆ±çš„åšå®¢ã€æ–°é—»ç½‘ç«™å’Œå…¶ä»–ä¿¡æ¯æºã€‚ä¸ä¼ ç»Ÿçš„ç¤¾äº¤åª’ä½“ä¸åŒï¼ŒRSSé˜…è¯»å™¨è®©ä½ å®Œå…¨æŒæ¡ä¿¡æ¯æºï¼Œé¿å…äº†ç®—æ³•è¿‡æ»¤å’Œä¿¡æ¯æ³›æ»¥ã€‚ä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„å…´è¶£è®¢é˜…å„ç§æºï¼Œå°†ä¿¡æ¯é›†ä¸­åœ¨ä¸€ä¸ªå¹³å°ä¸Šè¿›è¡Œé˜…è¯»ã€‚</p></blockquote><p><img src="https://cloudflare.free-img.ososo.org/file/1732424248250_image-ahtz.png" alt="image-ahtz.png"></p><p><img src="https://cloudflare.free-img.ososo.org/file/1732424249234_image-znda.png" alt="image-znda.png"></p><hr><h2 id="ttrsséƒ¨ç½²"><a href="#ttrsséƒ¨ç½²" class="headerlink" title="ttrsséƒ¨ç½²"></a>ttrsséƒ¨ç½²</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /opt/docker/ttrss</span><br><span class="line">cd /opt/docker/ttrss</span><br><span class="line">nano docker-compose.yml</span><br><span class="line"></span><br><span class="line">version: &quot;3&quot;</span><br><span class="line">services:</span><br><span class="line">  service.rss:</span><br><span class="line">    image: wangqiru/ttrss:latest</span><br><span class="line">    container_name: ttrss</span><br><span class="line">    ports:</span><br><span class="line">      - 181:80</span><br><span class="line">    environment:</span><br><span class="line">      - SELF_URL_PATH=http://localhost:181/ # please change to your own domain</span><br><span class="line">      - DB_PASS=ttrss # use the same password defined in database.postgres</span><br><span class="line">      - PUID=1000</span><br><span class="line">      - PGID=1000</span><br><span class="line">    volumes:</span><br><span class="line">      - feed-icons:/var/www/feed-icons/</span><br><span class="line">    networks:</span><br><span class="line">      - public_access</span><br><span class="line">      - service_only</span><br><span class="line">      - database_only</span><br><span class="line">    stdin_open: true</span><br><span class="line">    tty: true</span><br><span class="line">    restart: always</span><br><span class="line"></span><br><span class="line">  service.mercury: # set Mercury Parser API endpoint to service.mercury:3000 on TTRSS plugin setting page</span><br><span class="line">    image: wangqiru/mercury-parser-api:latest</span><br><span class="line">    container_name: mercury</span><br><span class="line">    networks:</span><br><span class="line">      - public_access</span><br><span class="line">      - service_only</span><br><span class="line">    restart: always</span><br><span class="line"></span><br><span class="line">  service.opencc: # set OpenCC API endpoint to service.opencc:3000 on TTRSS plugin setting page</span><br><span class="line">    image: wangqiru/opencc-api-server:latest</span><br><span class="line">    container_name: opencc</span><br><span class="line">    environment:</span><br><span class="line">      - NODE_ENV=production</span><br><span class="line">    networks:</span><br><span class="line">      - service_only</span><br><span class="line">    restart: always</span><br><span class="line"></span><br><span class="line">  database.postgres:</span><br><span class="line">    image: postgres:13-alpine</span><br><span class="line">    container_name: postgres</span><br><span class="line">    environment:</span><br><span class="line">      - POSTGRES_PASSWORD=ttrss # feel free to change the password</span><br><span class="line">    volumes:</span><br><span class="line">      - ~/postgres/data/:/var/lib/postgresql/data # persist postgres data to ~/postgres/data/ on the host</span><br><span class="line">    networks:</span><br><span class="line">      - database_only</span><br><span class="line">    restart: always</span><br><span class="line"></span><br><span class="line">  # utility.watchtower:</span><br><span class="line">  #   container_name: watchtower</span><br><span class="line">  #   image: containrrr/watchtower:latest</span><br><span class="line">  #   volumes:</span><br><span class="line">  #     - /var/run/docker.sock:/var/run/docker.sock</span><br><span class="line">  #   environment:</span><br><span class="line">  #     - WATCHTOWER_CLEANUP=true</span><br><span class="line">  #     - WATCHTOWER_POLL_INTERVAL=86400</span><br><span class="line">  #   restart: always</span><br><span class="line"></span><br><span class="line">volumes:</span><br><span class="line">  feed-icons:</span><br><span class="line"></span><br><span class="line">networks:</span><br><span class="line">  public_access: # Provide the access for ttrss UI</span><br><span class="line">  service_only: # Provide the communication network between services only</span><br><span class="line">    internal: true</span><br><span class="line">  database_only: # Provide the communication between ttrss and database only</span><br><span class="line">    internal: true</span><br></pre></td></tr></table></figure><p>ctrl+x ä¿å­˜</p><h2 id="å¯åŠ¨å®¹å™¨"><a href="#å¯åŠ¨å®¹å™¨" class="headerlink" title="å¯åŠ¨å®¹å™¨"></a>å¯åŠ¨å®¹å™¨</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker compose up -d</span><br></pre></td></tr></table></figure><hr><h2 id="FreshRSSéƒ¨ç½²"><a href="#FreshRSSéƒ¨ç½²" class="headerlink" title="FreshRSSéƒ¨ç½²"></a>FreshRSSéƒ¨ç½²</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /opt/docke/frss</span><br><span class="line">cd /opt/docker/ttrss</span><br><span class="line">nano docker-compose.yml</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">version: &quot;3&quot;</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  freshrss-db:</span><br><span class="line">    image: postgres:latest</span><br><span class="line">    container_name: freshrss-db</span><br><span class="line">    hostname: freshrss-db</span><br><span class="line">    restart: unless-stopped</span><br><span class="line">    volumes:</span><br><span class="line">      - freshrss-db:/var/lib/postgresql/data</span><br><span class="line">    environment:</span><br><span class="line">      POSTGRES_USER: freshrss</span><br><span class="line">      POSTGRES_PASSWORD: freshrss</span><br><span class="line">      POSTGRES_DB: freshrss</span><br><span class="line"></span><br><span class="line">  freshrss-app:</span><br><span class="line">    image: freshrss/freshrss:latest</span><br><span class="line">    container_name: freshrss-app</span><br><span class="line">    hostname: freshrss-app</span><br><span class="line">    restart: unless-stopped</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;8088:80&quot;#å·¦è¾¹ç«¯å£å·è‡ªè¡Œä¿®æ”¹</span><br><span class="line">    depends_on:</span><br><span class="line">      - freshrss-db</span><br><span class="line">    volumes:</span><br><span class="line">      - ./data:/var/www/FreshRSS/data</span><br><span class="line">      - ./extensions:/var/www/FreshRSS/extensions</span><br><span class="line">    environment:</span><br><span class="line">      CRON_MIN: &#x27;*/45&#x27;</span><br><span class="line">      TZ: Asia/Shanghai</span><br><span class="line"></span><br><span class="line">volumes:</span><br><span class="line">  freshrss-db:</span><br></pre></td></tr></table></figure><h2 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker compose up -d</span><br></pre></td></tr></table></figure><h3 id="ä¸€äº›è®¾ç½®"><a href="#ä¸€äº›è®¾ç½®" class="headerlink" title="ä¸€äº›è®¾ç½®"></a>ä¸€äº›è®¾ç½®</h3><p>ä¸€ è®¾ç½®-è´¦æˆ·-è´¦æˆ·ç®¡ç†-APIç®¡ç†è®¾ç½®å¯†ç </p><p>è¾“å…¥â€œ<code>åŸŸå/api/</code>â€è·å–ç¬¬ä¸‰æ–¹å®¢æˆ·ç«¯ç™»é™†åœ°å€</p><p>ä¸»è¦æœ‰ä¸¤ä¸ª</p><p><code>/api/greader.php/</code></p><p><code>/api/fever.php/</code></p><p>äºŒ è®¾ç½®-ç®¡ç†-è®¤è¯</p><p>å‹¾é€‰APIå…è®¸APIè®¿é—®</p><p>é€šè¿‡è¿™ç®€å•çš„å‡ æ­¥ï¼Œä½ å°±æˆåŠŸåœ°å°†Tiny Tiny RSSéƒ¨ç½²åœ¨äº†Dockerå®¹å™¨ä¸­ï¼Œä¸ºä¸­å¹´äººçš„ä¿¡æ¯ç®¡ç†å¸¦æ¥äº†æ–°çš„è§£å†³æ–¹æ¡ˆã€‚ä¸å†è¢«ä¿¡æ¯æ³›æ»¥æ‰€å›°æ‰°ï¼Œä½ å¯ä»¥æ›´åŠ è‡ªç”±ã€é«˜æ•ˆåœ°è·å–åˆ°ä½ æƒ³è¦çš„ä¿¡æ¯ï¼Œè®©ä¿¡æ¯è‡ªç”±èˆªè¡Œåœ¨ä½ çš„ç”Ÿæ´»ä¸­ã€‚</p><h1 id="å®‰å“å®¢æˆ·ç«¯æ¨èFeedMe"><a href="#å®‰å“å®¢æˆ·ç«¯æ¨èFeedMe" class="headerlink" title="å®‰å“å®¢æˆ·ç«¯æ¨èFeedMe"></a>å®‰å“å®¢æˆ·ç«¯æ¨è<a href="https://github.com/seazon/FeedMe/releases">FeedMe</a></h1><blockquote><p>æ³¨</p><p>ttrssåœ°å€ç›´æ¥å¡«å†™æœåŠ¡å™¨åœ°å€ï¼Œfever åœ°å€å›æŠ¥é”™</p><p>freshrssåœ°å€å¡«å†™&#x2F;api&#x2F;greader.php&#x2F;</p></blockquote><p>RSSæºæ¨è <a href="RSSHUB.APP">RSSHUB.APP</a></p>]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æˆéƒ½ç”µä¿¡ Openwrt IPTV è®¾ç½®</title>
      <link href="/posts/8f1784fe/"/>
      <url>/posts/8f1784fe/</url>
      
        <content type="html"><![CDATA[<hr><h2 id="OpenWrt-å…‰çŒ«æ¡¥æ¥-IPTV-é…ç½®æ•™ç¨‹-udpxy"><a href="#OpenWrt-å…‰çŒ«æ¡¥æ¥-IPTV-é…ç½®æ•™ç¨‹-udpxy" class="headerlink" title="OpenWrt å…‰çŒ«æ¡¥æ¥ IPTV é…ç½®æ•™ç¨‹ (udpxy)"></a>OpenWrt å…‰çŒ«æ¡¥æ¥ IPTV é…ç½®æ•™ç¨‹ (udpxy)</h2><p>æœ¬æ•™ç¨‹ä»¥æˆéƒ½ç”µä¿¡ IPTV ä¸ºä¾‹è¿›è¡Œè¯´æ˜ã€‚</p><hr><p><strong>å‡†å¤‡å·¥ä½œ:</strong></p><ul><li>ç¡®ä¿å…‰çŒ«å·²è®¾ç½®ä¸ºæ¡¥æ¥æ¨¡å¼</li><li>å·²ç»åˆ·å…¥ OpenWrt ç³»ç»Ÿçš„è·¯ç”±å™¨ã€‚</li><li>å®‰è£…äº† <code>udpxy</code> æ’ä»¶ (å¦‚æœæœªå®‰è£…ï¼Œè¯·æŒ‰ç…§æ•™ç¨‹æŒ‡ç¤ºå®‰è£…)ã€‚</li><li>çŸ¥é“ä½ çš„ IPTV VLAN ID (æœ¬ä¾‹ä¸­ä¸º <code>43</code>)ã€‚</li><li>éœ€è¦çŸ¥é“ä½ çš„ WAN å£ç‰©ç†è®¾å¤‡åç§° (ä¾‹å¦‚ <code>eth1</code> æˆ– <code>eth2</code>)ã€‚</li></ul><p><strong>é…ç½®æ­¥éª¤:</strong></p><h3 id="ä¸€ã€é…ç½®-IPTV-æ¥å£-å…‰çŒ«æ¡¥æ¥æ¨¡å¼"><a href="#ä¸€ã€é…ç½®-IPTV-æ¥å£-å…‰çŒ«æ¡¥æ¥æ¨¡å¼" class="headerlink" title="ä¸€ã€é…ç½® IPTV æ¥å£ (å…‰çŒ«æ¡¥æ¥æ¨¡å¼)"></a>ä¸€ã€é…ç½® IPTV æ¥å£ (å…‰çŒ«æ¡¥æ¥æ¨¡å¼)</h3><ol><li><p><strong>åˆ›å»º VLAN (802.1q) è®¾å¤‡:</strong></p><ul><li>æ‰“å¼€ OpenWrt è·¯ç”±å™¨çš„ç®¡ç†ç•Œé¢ï¼Œè¿›å…¥ <strong>ç½‘ç»œ</strong> -&gt; <strong>æ¥å£</strong> -&gt; <strong>è®¾å¤‡</strong></li><li>ç‚¹å‡»<strong>æ·»åŠ è®¾å¤‡é…ç½®</strong></li><li>åœ¨å¼¹å‡ºçš„çª—å£ä¸­ï¼š<ul><li><strong>è®¾å¤‡ç±»å‹</strong> é€‰æ‹© <strong>VLAN(802.1q)</strong></li><li><strong>åŸºç¡€è®¾å¤‡</strong> é€‰æ‹© <strong>ä½ çš„Openwrtè·Ÿå…‰çŒ«IPTVå£è¿æ¥çš„æ¥å£</strong></li><li><strong>VLAN ID</strong> å¡«å†™ <strong>43</strong></li><li><strong>è®¾å¤‡å</strong> å¡«å†™ <strong>ä½ çš„ä½ çš„Openwrtè·Ÿå…‰çŒ«IPTVå£è¿æ¥çš„æ¥å£ å¦‚eth1 ï¼Œå°±å¡«å†™eth1.43</strong></li><li><strong>æœ€åä¿å­˜</strong></li></ul></li></ul><p><img src="https://cloudflare.free-img.ososo.org/file/1731216718563_image-xngc.png" alt="æ–°å»º VLAN (802.1q) è®¾å¤‡"></p></li><li><p><strong>åˆ›å»º IPTV æ¥å£:</strong></p><ul><li><p>æ‰“å¼€ OpenWrt è·¯ç”±å™¨çš„ç®¡ç†ç•Œé¢ï¼Œè¿›å…¥ <strong>ç½‘ç»œ</strong> -&gt; <strong>æ¥å£</strong>ã€‚</p></li><li><p>ç‚¹å‡» <strong>æ·»åŠ æ–°æ¥å£â€¦</strong> æŒ‰é’®ã€‚</p></li><li><p>åœ¨å¼¹å‡ºçš„çª—å£ä¸­ï¼š</p><ul><li><strong>åç§°:</strong>  è¾“å…¥ä½ å–œæ¬¢çš„æ¥å£åç§°ï¼Œä¾‹å¦‚ <code>IPTV</code>ã€‚</li><li><strong>åè®®:</strong>  é€‰æ‹© <strong>é™æ€åœ°å€</strong>ã€‚</li><li><strong>è®¾å¤‡:</strong>  ç‚¹å‡» <strong>åˆšæ‰åˆ›å»º VLAN (802.1q) è®¾å¤‡-å¦‚ä¸Š eth1.43</strong>ã€‚</li><li>ç‚¹å‡» <strong>åˆ›å»ºæ¥å£</strong> æŒ‰é’®ã€‚</li></ul></li><li><p><strong>æ¥å£é…ç½®:</strong>  åœ¨æ–°å»ºçš„ <code>IPTV</code> æ¥å£é…ç½®é¡µé¢ï¼š</p><ul><li><strong>IPv4 åœ°å€:</strong>  éšæ„è®¾ç½®ä¸€ä¸ªå†…ç½‘ IP åœ°å€ï¼Œä¾‹å¦‚ <code>192.168.99.1</code>ã€‚</li><li><strong>IPv4 å­ç½‘æ©ç :</strong>  è®¾ç½®ä¸º <code>255.255.255.0</code>ã€‚</li><li><strong>ç‰©ç†è®¾ç½®:</strong>  <strong>è®¾å¤‡</strong> é€‰é¡¹åº”å·²è‡ªåŠ¨ç»‘å®šä¸ºåˆšæ‰åˆ›å»ºçš„ VLAN è®¾å¤‡ï¼Œä¾‹å¦‚ <code>eth1.43</code>ã€‚</li></ul></li></ul><p><img src="https://cloudflare.free-img.ososo.org/file/1731216725307_image-ftgo.png" alt="æ–°å»º IPTV æ¥å£"></p></li><li><p><strong>é«˜çº§è®¾ç½®:</strong></p><ul><li>åˆ‡æ¢åˆ° <strong>é«˜çº§è®¾ç½®</strong> é€‰é¡¹å¡ã€‚</li><li><strong>å–æ¶ˆå‹¾é€‰</strong>  <strong>ä½¿ç”¨é»˜è®¤ç½‘å…³</strong>ã€‚</li><li><strong>ç½‘å…³è·ƒç‚¹:</strong>  è®¾ç½®ä¸º <code>50</code> (æˆ–å…¶ä»–å¤§äº WAN å£è·ƒç‚¹çš„å€¼)ã€‚</li><li>å…¶ä»–è®¾ç½®ä¿æŒé»˜è®¤å³å¯ã€‚</li></ul><p><img src="https://cloudflare.free-img.ososo.org/file/1731216717661_image-regz.png" alt="é«˜çº§è®¾ç½®"></p></li><li><p><strong>é˜²ç«å¢™è®¾ç½®:</strong></p><ul><li>åˆ‡æ¢åˆ° <strong>é˜²ç«å¢™è®¾ç½®</strong> é€‰é¡¹å¡ã€‚</li><li><strong>æ–°å»º&#x2F;åˆ†é…é˜²ç«å¢™åŒºåŸŸ:</strong>  é€‰æ‹© <strong>æ–°å»º</strong>ï¼Œå¹¶åœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥é˜²ç«å¢™åŒºåŸŸåç§°ï¼Œä¾‹å¦‚ <code>IPTV</code>ã€‚</li><li>ç‚¹å‡» <strong>ä¿å­˜</strong> æŒ‰é’®ã€‚</li></ul><p><img src="https://cloudflare.free-img.ososo.org/file/1731216716300_image-xvsc.png" alt="é˜²ç«å¢™è®¾ç½®"></p></li></ol><h3 id="äºŒã€è®¾ç½®-WAN-å£ç½‘ç»œè·ƒç‚¹"><a href="#äºŒã€è®¾ç½®-WAN-å£ç½‘ç»œè·ƒç‚¹" class="headerlink" title="äºŒã€è®¾ç½® WAN å£ç½‘ç»œè·ƒç‚¹"></a>äºŒã€è®¾ç½® WAN å£ç½‘ç»œè·ƒç‚¹</h3><ol><li><strong>ä¿®æ”¹ WAN å£è·ƒç‚¹:</strong><ul><li>è¿”å› <strong>ç½‘ç»œ</strong> -&gt; <strong>æ¥å£</strong> é¡µé¢ã€‚</li><li>ç‚¹å‡» <strong>WAN</strong> æ¥å£çš„ <strong>ç¼–è¾‘</strong> æŒ‰é’®ã€‚</li><li>åˆ‡æ¢åˆ° <strong>é«˜çº§è®¾ç½®</strong> é€‰é¡¹å¡ã€‚</li><li><strong>ç½‘å…³è·ƒç‚¹:</strong>  è®¾ç½®ä¸º <code>20</code> (æˆ–ä»»ä½•å°äº IPTV æ¥å£è·ƒç‚¹çš„å€¼ï¼Œä¾‹å¦‚ <code>30</code>, <code>40</code> ç­‰)ã€‚</li><li>ç‚¹å‡» <strong>ä¿å­˜ &amp; åº”ç”¨</strong> æŒ‰é’®ã€‚</li></ul></li></ol><h3 id="ä¸‰ã€é…ç½®é˜²ç«å¢™åŒºåŸŸ"><a href="#ä¸‰ã€é…ç½®é˜²ç«å¢™åŒºåŸŸ" class="headerlink" title="ä¸‰ã€é…ç½®é˜²ç«å¢™åŒºåŸŸ"></a>ä¸‰ã€é…ç½®é˜²ç«å¢™åŒºåŸŸ</h3><ol><li><p><strong>ç¼–è¾‘ IPTV é˜²ç«å¢™åŒºåŸŸ:</strong></p><ul><li>è¿›å…¥ <strong>ç½‘ç»œ</strong> -&gt; <strong>é˜²ç«å¢™</strong> -&gt; <strong>åŒºåŸŸ</strong> é¡µé¢ã€‚</li><li>æ‰¾åˆ°åä¸º <strong>IPTV</strong> çš„é˜²ç«å¢™åŒºåŸŸï¼Œç‚¹å‡» <strong>ç¼–è¾‘</strong> æŒ‰é’®ã€‚</li><li>æŒ‰ç…§ä¸‹å›¾æ‰€ç¤ºè¿›è¡Œè®¾ç½®ï¼š</li></ul><p><img src="https://cloudflare.free-img.ososo.org/file/1731216719808_image-wumj.png" alt="é˜²ç«å¢™åŒºåŸŸè®¾ç½®"></p><ul><li><strong>åŸºæœ¬è®¾ç½®:</strong><ul><li><strong>åç§°:</strong> <code>IPTV</code> (åº”å·²è‡ªåŠ¨å¡«å†™)</li><li><strong>å…è®¸æ¥è‡ªåŒºåŸŸçš„è½¬å‘:</strong>  å–æ¶ˆå‹¾é€‰æ‰€æœ‰é€‰é¡¹ã€‚</li><li><strong>å…è®¸è½¬å‘åˆ°åŒºåŸŸ:</strong>  å‹¾é€‰ <code>wan</code>ã€‚</li><li><strong>è¦†ç›–é»˜è®¤è§„åˆ™:</strong>  å‹¾é€‰ã€‚</li></ul></li><li><strong>é«˜çº§è®¾ç½®:</strong>  ä¿æŒé»˜è®¤ã€‚</li><li><strong>å…¥ç«™è§„åˆ™:</strong>  <strong>æ¥å—</strong>ã€‚</li><li><strong>å‡ºç«™è§„åˆ™:</strong>  <strong>æ¥å—</strong>ã€‚</li><li><strong>è½¬å‘è§„åˆ™:</strong>  <strong>æ‹’ç»</strong>ã€‚</li><li><strong>å…è®¸è½¬å‘åˆ°ç›®æ ‡åŒºåŸŸçš„ç«¯å£:</strong>  ä¿æŒä¸ºç©ºã€‚</li><li>ç‚¹å‡» <strong>ä¿å­˜ &amp; åº”ç”¨</strong> æŒ‰é’®ã€‚</li></ul></li></ol><h3 id="å››ã€å¯ç”¨å’Œé…ç½®-OpenWrt-ä¸Šçš„-udpxy-æ’ä»¶"><a href="#å››ã€å¯ç”¨å’Œé…ç½®-OpenWrt-ä¸Šçš„-udpxy-æ’ä»¶" class="headerlink" title="å››ã€å¯ç”¨å’Œé…ç½® OpenWrt ä¸Šçš„ udpxy æ’ä»¶"></a>å››ã€å¯ç”¨å’Œé…ç½® OpenWrt ä¸Šçš„ udpxy æ’ä»¶</h3><ol><li><p><strong>å®‰è£… udpxy æ’ä»¶ (å¦‚æœå°šæœªå®‰è£…):</strong></p><ul><li>è¿›å…¥ OpenWrt è·¯ç”±å™¨çš„ <strong>ç³»ç»Ÿ</strong> -&gt; <strong>è½¯ä»¶åŒ…</strong> é¡µé¢ã€‚</li><li>åœ¨ <strong>ä¸‹è½½å¹¶å®‰è£…è½¯ä»¶åŒ…</strong> è¾“å…¥æ¡†ä¸­è¾“å…¥ <code>udpxy</code>ï¼Œç‚¹å‡» <strong>ç¡®å®š</strong>ã€‚</li><li>ç­‰å¾…å®‰è£…å®Œæˆã€‚</li></ul></li><li><p><strong>æ·»åŠ  udpxy é…ç½®:</strong></p><ul><li>è¿›å…¥ <strong>ç½‘ç»œ</strong> -&gt; <strong>Udpxy</strong> é¡µé¢ã€‚</li><li>ç‚¹å‡» <strong>æ·»åŠ </strong> æŒ‰é’®ã€‚</li><li>åœ¨å¼¹å‡ºçš„é…ç½®é¡µé¢ä¸­ï¼š<ul><li><strong>åç§°:</strong>  è‡ªå®šä¹‰é…ç½®åç§°ï¼Œä¾‹å¦‚ <code>IPTV_udpxy</code>ã€‚</li><li><strong>å¯ç”¨:</strong>  å‹¾é€‰ <strong>å¯ç”¨</strong>ã€‚</li><li><strong>ç»‘å®šåœ°å€:</strong>  é€‰æ‹© <code>wan</code> (OpenWrt WAN å£çš„ IP åœ°å€)ã€‚</li><li><strong>ç»‘å®šç«¯å£:</strong>  è®¾ç½®ä¸€ä¸ªç«¯å£å·ï¼Œä¾‹å¦‚ <code>4022</code> ã€‚</li><li><strong>æºæ¥å£:</strong>  é€‰æ‹©ä¹‹å‰åˆ›å»ºçš„ IPTV æ¥å£ï¼Œä¾‹å¦‚ <code>eth1.43</code>æˆ–<strong>ç›´æ¥å¡«å†™IPTVå£çš„IP</strong>ã€‚</li><li>å…¶ä»–è®¾ç½®ä¿æŒé»˜è®¤å³å¯ã€‚</li></ul></li></ul><p><img src="https://cloudflare.free-img.ososo.org/file/1731216717347_image-kkej.png" alt="é…ç½® udpxy"></p></li><li><p><strong>ä¿å­˜å¹¶åº”ç”¨é…ç½®:</strong>  ç‚¹å‡» <strong>ä¿å­˜ &amp; åº”ç”¨</strong> æŒ‰é’®ã€‚</p></li><li><p><strong>éªŒè¯ udpxy çŠ¶æ€:</strong></p><ul><li>åœ¨æµè§ˆå™¨ä¸­è®¿é—® <code>http://192.168.88.1:4022/status</code> (å°† <code>192.168.88.1</code> æ›¿æ¢ä¸º OpenWrt è·¯ç”±å™¨ IP åœ°å€ï¼Œ<code>4022</code> æ›¿æ¢ä¸ºä½ è®¾ç½®çš„ç«¯å£å·)ã€‚</li><li>å¦‚æœé…ç½®æ­£ç¡®ï¼Œé¡µé¢åº”è¯¥æ˜¾ç¤ºç±»ä¼¼ä¸‹å›¾çš„å†…å®¹ï¼š</li></ul><p><img src="https://cloudflare.free-img.ososo.org/file/1731216718062_image-dsxh.png" alt="udpxy çŠ¶æ€"></p></li></ol><h3 id="äº”ã€å¯¼å…¥ç›´æ’­åœ°å€è§‚çœ‹-IPTV"><a href="#äº”ã€å¯¼å…¥ç›´æ’­åœ°å€è§‚çœ‹-IPTV" class="headerlink" title="äº”ã€å¯¼å…¥ç›´æ’­åœ°å€è§‚çœ‹ IPTV"></a>äº”ã€å¯¼å…¥ç›´æ’­åœ°å€è§‚çœ‹ IPTV</h3><ol><li><p><strong>è·å–ç›´æ’­åœ°å€:</strong> </p><ul><li><strong>æˆéƒ½ç”µä¿¡ UDP ç»„æ’­ M3U åˆ—è¡¨:</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://raw.githubusercontent.com/imDazui/Tvlist-awesome-m3u-m3u8/master/m3u/%E5%9B%9B%E5%B7%9D%E6%88%90%E9%83%BD%E7%94%B5%E4%BF%A1udp%E7%BB%84%E6%92%AD.m3u</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>ä¿®æ”¹ç›´æ’­åœ°å€æ ¼å¼:</strong>  å°† M3U åˆ—è¡¨ä¸­çš„ UDP ç»„æ’­åœ°å€ä¿®æ”¹ä¸º udpxy å¯ä»¥è¯†åˆ«çš„ HTTP æ ¼å¼ã€‚</p><ul><li><strong>åŸå§‹ UDP åœ°å€ç¤ºä¾‹:</strong> <code>udp://239.93.0.184:5140</code></li><li><strong>udpxy HTTP åœ°å€æ ¼å¼:</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://[OpenWrt è·¯ç”±å™¨ IP]:[udpxy ç«¯å£]/udp/[UDP ç»„æ’­åœ°å€]:[UDP ç»„æ’­ç«¯å£]</span><br></pre></td></tr></table></figure></li><li><strong>ä¿®æ”¹åçš„ HTTP åœ°å€ç¤ºä¾‹ (å‡è®¾ OpenWrt IP ä¸º 192.168.88.1ï¼Œudpxy ç«¯å£ä¸º 4022):</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.88.1:4022/udp/239.93.0.184:5140</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>å¯¼å…¥ç›´æ’­åœ°å€:</strong>  å°†ä¿®æ”¹åçš„ HTTP åœ°å€å¯¼å…¥åˆ°æ”¯æŒ IPTV çš„æ’­æ”¾å™¨ (ä¾‹å¦‚ VLC, PotPlayer, Kodi ç­‰) ä¸­å³å¯è§‚çœ‹ IPTVã€‚</p></li></ol><h3 id="å…­ã€é…åˆå®¶åº­å½±éŸ³æœåŠ¡å™¨å®ç°å¼‚åœ°è§‚çœ‹"><a href="#å…­ã€é…åˆå®¶åº­å½±éŸ³æœåŠ¡å™¨å®ç°å¼‚åœ°è§‚çœ‹" class="headerlink" title="å…­ã€é…åˆå®¶åº­å½±éŸ³æœåŠ¡å™¨å®ç°å¼‚åœ°è§‚çœ‹"></a>å…­ã€é…åˆå®¶åº­å½±éŸ³æœåŠ¡å™¨å®ç°å¼‚åœ°è§‚çœ‹</h3><ul><li>é€šè¿‡é…ç½®å®¶åº­å½±éŸ³æœåŠ¡å™¨ (ä¾‹å¦‚ Jellyfin, Emby, Plex ç­‰)ï¼Œå¯ä»¥å°† udpxy æœåŠ¡æ¥å…¥ï¼Œä»è€Œå®ç° IPTV çš„å¼‚åœ°è§‚çœ‹åŠŸèƒ½ã€‚  å…·ä½“çš„é…ç½®æ–¹æ³•è‡ªè¡Œç™¾åº¦</li></ul><p><img src="https://cloudflare.free-img.ososo.org/file/1731216723840_image-svwx.png" alt="å¼‚åœ°è§‚çœ‹"></p><hr><p><strong>æ³¨æ„äº‹é¡¹:</strong></p><ul><li>æœ¬æ•™ç¨‹ä»¥æˆéƒ½ç”µä¿¡ IPTV ä¸ºä¾‹ï¼Œå…¶ä»–åœ°åŒºçš„ IPTV é…ç½®å¯èƒ½ç•¥æœ‰ä¸åŒï¼Œè¯·æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´ã€‚</li><li>ç¡®ä¿å…‰çŒ«å·²è®¾ç½®ä¸ºæ¡¥æ¥æ¨¡å¼ã€‚</li><li>ç¡®ä¿ OpenWrt è·¯ç”±å™¨ WAN å£å·²æ­£ç¡®è¿æ¥åˆ°å…‰çŒ«ã€‚</li><li>ç»„æ’­åœ°å€å¯èƒ½å› åœ°åŒºå’Œè¿è¥å•†è€Œå¼‚ï¼Œè¯·ä½¿ç”¨å½“åœ°è¿è¥å•†æä¾›çš„ç»„æ’­åœ°å€åˆ—è¡¨ã€‚</li><li>å¼‚åœ°è§‚çœ‹ IPTV çš„æ•ˆæœå–å†³äºç½‘ç»œç¯å¢ƒå’Œå®¶åº­å½±éŸ³æœåŠ¡å™¨çš„æ€§èƒ½ã€‚</li></ul><hr>]]></content>
      
      
      <categories>
          
          <category> Openwrt </category>
          
          <category> IPTV </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IPTV </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dockeréƒ¨ç½²SearXNG æœç´¢å¼•æ“ï¼Œéšç§æ— å¹¿å‘Š</title>
      <link href="/posts/5afd8d57/"/>
      <url>/posts/5afd8d57/</url>
      
        <content type="html"><![CDATA[<h2 id="SearXNG-Docker-éƒ¨ç½²æ•™ç¨‹"><a href="#SearXNG-Docker-éƒ¨ç½²æ•™ç¨‹" class="headerlink" title="SearXNG Docker éƒ¨ç½²æ•™ç¨‹"></a>SearXNG Docker éƒ¨ç½²æ•™ç¨‹</h2><hr><h3 id="1-å‡†å¤‡å·¥ä½œ"><a href="#1-å‡†å¤‡å·¥ä½œ" class="headerlink" title="1. å‡†å¤‡å·¥ä½œ"></a>1. å‡†å¤‡å·¥ä½œ</h3><p>åœ¨å¼€å§‹éƒ¨ç½²ä¹‹å‰ï¼Œè¯·ç¡®ä¿å·²å®Œæˆä»¥ä¸‹å‡†å¤‡å·¥ä½œï¼š</p><ul><li><strong>Docker ç¯å¢ƒ:</strong> éœ€è¦å®‰è£…å¹¶é…ç½®å¥½ Docker å’Œ Docker Composeã€‚ å¦‚æœæœªè£… Dockerï¼Œè¯·è·³è¿‡æ­¤æ•™ç¨‹ã€‚</li><li><strong>åŸŸåæˆ– IP åœ°å€:</strong>  éœ€è¦ä¸€ä¸ªåŸŸåæˆ–è€…æœåŠ¡å™¨çš„ IP åœ°å€ç”¨äºè®¿é—® SearXNGã€‚ å¦‚æœæ²¡æœ‰åŸŸåï¼Œå¯ä»¥ä½¿ç”¨æœåŠ¡å™¨çš„ IP åœ°å€åŠ ç«¯å£å·è¿›è¡Œè®¿é—®ã€‚</li></ul><h3 id="2-éƒ¨ç½²-SearXNG"><a href="#2-éƒ¨ç½²-SearXNG" class="headerlink" title="2. éƒ¨ç½² SearXNG"></a>2. éƒ¨ç½² SearXNG</h3><h4 id="2-1-Docker-Compose-æ–‡ä»¶å‡†å¤‡"><a href="#2-1-Docker-Compose-æ–‡ä»¶å‡†å¤‡" class="headerlink" title="2.1 Docker Compose æ–‡ä»¶å‡†å¤‡"></a>2.1 Docker Compose æ–‡ä»¶å‡†å¤‡</h4><ol><li><p><strong>åˆ›å»ºç›®å½•:</strong>  åœ¨æœåŠ¡å™¨ä¸Šé€‰æ‹©ä¸€ä¸ªåˆé€‚çš„ç›®å½•ï¼Œç”¨äºå­˜æ”¾ SearXNG çš„ Docker Compose æ–‡ä»¶å’Œç›¸å…³é…ç½®ï¼Œä¾‹å¦‚ <code>/opt/docker/searxng</code>ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /opt/docker/searxng</span><br></pre></td></tr></table></figure></li><li><p><strong>å…‹éš†é¡¹ç›®å¹¶è¿›å…¥ç›®å½•</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/searxng/searxng-docker.git /opt/docker/searxng</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /opt/docker/searxng</span><br></pre></td></tr></table></figure></li><li><p><strong>åˆ›å»º <code>docker-compose.yml</code> æ–‡ä»¶:</strong>  åœ¨è¯¥ç›®å½•ä¸‹åˆ›å»º <code>docker-compose.yml</code> æ–‡ä»¶ï¼Œå¹¶å°† <strong>ä»¥ä¸‹æ–°å†…å®¹</strong> å¤åˆ¶ç²˜è´´åˆ°æ–‡ä»¶ä¸­ï¼š</p></li></ol><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">version: &quot;3.7&quot;</span><br><span class="line"></span><br><span class="line">services:</span><br><span class="line">  redis:</span><br><span class="line">    container_name: redis</span><br><span class="line">    image: docker.io/valkey/valkey:8-alpine</span><br><span class="line">    command: valkey-server --save 30 1 --loglevel warning</span><br><span class="line">    restart: unless-stopped</span><br><span class="line">    networks:</span><br><span class="line">      - searxng</span><br><span class="line">    volumes:</span><br><span class="line">      - valkey-data2:/data</span><br><span class="line">    logging:</span><br><span class="line">      driver: &quot;json-file&quot;</span><br><span class="line">      options:</span><br><span class="line">        max-size: &quot;1m&quot;</span><br><span class="line">        max-file: &quot;1&quot;</span><br><span class="line"></span><br><span class="line">  searxng:</span><br><span class="line">    container_name: searxng</span><br><span class="line">    image: docker.io/searxng/searxng:latest</span><br><span class="line">    restart: unless-stopped</span><br><span class="line">    networks:</span><br><span class="line">      - searxng</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;127.0.0.1:8080:8080&quot;</span><br><span class="line">    volumes:</span><br><span class="line">      - ./searxng:/etc/searxng:rw</span><br><span class="line">    environment:</span><br><span class="line">      - SEARXNG_BASE_URL=https://$&#123;SEARXNG_HOSTNAME:-localhost&#125;/</span><br><span class="line">      - UWSGI_WORKERS=$&#123;SEARXNG_UWSGI_WORKERS:-4&#125;</span><br><span class="line">      - UWSGI_THREADS=$&#123;SEARXNG_UWSGI_THREADS:-4&#125;</span><br><span class="line">    logging:</span><br><span class="line">      driver: &quot;json-file&quot;</span><br><span class="line">      options:</span><br><span class="line">        max-size: &quot;1m&quot;</span><br><span class="line">        max-file: &quot;1&quot;</span><br><span class="line"></span><br><span class="line">networks:</span><br><span class="line">  searxng:</span><br><span class="line"></span><br><span class="line">volumes:</span><br><span class="line">  valkey-data2:</span><br></pre></td></tr></table></figure><p>   <strong>æ–‡ä»¶ç»“æ„è§£é‡Š:</strong></p><ul><li><strong><code>version: &#39;3.7&#39;</code></strong>:  æŒ‡å®š Docker Compose æ–‡ä»¶ç‰ˆæœ¬ã€‚</li><li><strong><code>services:</code></strong>: å®šä¹‰è¦è¿è¡Œçš„æœåŠ¡ã€‚</li><li><strong><code>redis:</code></strong>: å®šä¹‰ Redis æœåŠ¡ã€‚</li><li><code>container_name: redis</code>:  å®¹å™¨åç§°ä¸º <code>redis</code>ã€‚</li><li><code>image: &quot;redis:alpine&quot;</code>:  ä½¿ç”¨ <code>redis:alpine</code> é•œåƒï¼ŒAlpine ç‰ˆæœ¬é•œåƒä½“ç§¯å°å·§ã€‚</li><li><code>command: redis-server --save &quot;&quot; --appendonly &quot;no&quot;</code>:  Redis å¯åŠ¨å‘½ä»¤ï¼Œç¦ç”¨æ•°æ®æŒä¹…åŒ–ä»¥ç®€åŒ–é…ç½® (é€‚ç”¨äºç¼“å­˜åœºæ™¯)ã€‚</li><li><code>networks: - searxng</code>:  å°† Redis å®¹å™¨è¿æ¥åˆ° <code>searxng</code> ç½‘ç»œï¼Œä»¥ä¾¿ SearXNG å®¹å™¨å¯ä»¥è®¿é—® Redisã€‚</li><li><code>tmpfs: - /var/lib/redis</code>:  ä½¿ç”¨ <code>tmpfs</code> å°† Redis æ•°æ®ç›®å½•æŒ‚è½½åˆ°å†…å­˜ä¸­ï¼Œè¿›ä¸€æ­¥æå‡æ€§èƒ½ï¼Œä½†æ•°æ®ä¸ä¼šæŒä¹…åŒ–ã€‚</li><li><code>cap_drop</code> å’Œ <code>cap_add</code>:  Linux capabilitiesï¼Œç”¨äºå®‰å…¨åŠ å›ºï¼Œé™åˆ¶å®¹å™¨æƒé™ã€‚</li><li><strong><code>searxng:</code></strong>: å®šä¹‰ SearXNG æœåŠ¡ (é…ç½®ä¸ä¹‹å‰ç‰ˆæœ¬åŸºæœ¬ç›¸åŒ)ã€‚</li><li><code>container_name: searxng</code>: å®¹å™¨åç§°ä¸º <code>searxng</code>ã€‚</li><li><code>image: searxng/searxng:latest</code>: ä½¿ç”¨æœ€æ–°ç‰ˆ SearXNG é•œåƒã€‚</li><li><code>networks: - searxng</code>:  è¿æ¥åˆ° <code>searxng</code> ç½‘ç»œã€‚</li><li><code>ports: - &quot;8180:8080&quot;</code>:  ç«¯å£æ˜ å°„ï¼Œå°†å®¹å™¨ 8080 ç«¯å£æ˜ å°„åˆ°å®¿ä¸»æœº 8180 ç«¯å£ (å¯ä¿®æ”¹)ã€‚</li><li><code>volumes: - ./searxng:/etc/searxng:rw</code>:  æ•°æ®å·æŒ‚è½½ï¼Œå°†å½“å‰ç›®å½•ä¸‹çš„ <code>searxng</code> å­ç›®å½•æŒ‚è½½åˆ°å®¹å™¨çš„ <code>/etc/searxng</code> ç›®å½•ï¼Œç”¨äºæŒä¹…åŒ–é…ç½®ã€‚</li><li><code>environment: - SEARXNG_BASE_URL=https://$&#123;SEARXNG_HOSTNAME:-localhost&#125;/</code>:  è®¾ç½®ç¯å¢ƒå˜é‡ <code>SEARXNG_BASE_URL</code>ï¼ŒæŒ‡å®š SearXNG çš„åŸºç¡€ URLã€‚</li><li><code>cap_drop</code>, <code>cap_add</code>, <code>logging</code>:  Linux capabilities å’Œæ—¥å¿—é…ç½®ï¼Œä¸ä¹‹å‰ç‰ˆæœ¬ç›¸åŒã€‚</li><li><strong><code>networks:</code></strong>: å®šä¹‰ Docker ç½‘ç»œã€‚</li><li><code>searxng:</code>:  åˆ›å»ºä¸€ä¸ªåä¸º <code>searxng</code> çš„ç½‘ç»œã€‚</li><li><code>ipam: driver: default</code>:  ä½¿ç”¨é»˜è®¤çš„ IP åœ°å€ç®¡ç†é©±åŠ¨ã€‚</li></ul><h4 id="2-2-ç¼–è¾‘-env-æ–‡ä»¶"><a href="#2-2-ç¼–è¾‘-env-æ–‡ä»¶" class="headerlink" title="2.2 ç¼–è¾‘ .env æ–‡ä»¶"></a>2.2 ç¼–è¾‘ <code>.env</code> æ–‡ä»¶</h4><ol><li><p><strong>åˆ›å»º <code>.env</code> æ–‡ä»¶:</strong>  åœ¨åŒä¸€ç›®å½•ä¸‹åˆ›å»º <code>.env</code> æ–‡ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano .<span class="built_in">env</span></span><br></pre></td></tr></table></figure></li><li><p><strong>ç¼–è¾‘ <code>.env</code> æ–‡ä»¶å†…å®¹:</strong>  ä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€ <code>.env</code> æ–‡ä»¶ï¼Œå¹¶æ ¹æ®éœ€æ±‚ä¿®æ”¹ä»¥ä¸‹é…ç½®ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SEARXNG_HOSTNAME=search.example.com#ä¿®æ”¹ä¸ºä½ çš„åŸŸåæˆ–IP+ç«¯å£</span><br><span class="line">#LETSENCRYPT_EMAIL=admin@example.com</span><br></pre></td></tr></table></figure><ul><li><strong><code>SEARXNG_HOSTNAME</code></strong>:  å°† <code>search.example.com</code> æ›¿æ¢ä¸ºä½ çš„åŸŸåæˆ– IP åœ°å€ã€‚ å¦‚æœä½¿ç”¨ IP åœ°å€ï¼Œè¯·ç¡®ä¿åŒ…å«ç«¯å£å·ï¼Œä¾‹å¦‚ <code>your_server_ip:8180</code>ã€‚</li><li><strong><code>LETSENCRYPT_EMAIL</code></strong>:  å¦‚æœè®¡åˆ’ä½¿ç”¨ Letâ€™s Encrypt è‡ªåŠ¨ç­¾å‘ SSL è¯ä¹¦ï¼Œå–æ¶ˆæ³¨é‡Šæ­¤è¡Œå¹¶å¡«å†™ä½ çš„é‚®ç®±åœ°å€ã€‚  <strong>æ³¨æ„ï¼š</strong>  Letâ€™s Encrypt é€šå¸¸éœ€è¦åŸŸåè§£æåˆ°æœåŠ¡å™¨ IP åœ°å€ã€‚ æœ¬æ•™ç¨‹ç®€åŒ–éƒ¨ç½²ï¼Œæš‚ä¸æ¶‰åŠ HTTPS é…ç½®ï¼Œå¯ä»¥é€šè¿‡åå‘ä»£ç† (å¦‚ Nginx) å®ç° HTTPSã€‚</li></ul></li></ol><h4 id="2-3-ç”Ÿæˆå¯†é’¥"><a href="#2-3-ç”Ÿæˆå¯†é’¥" class="headerlink" title="2.3 ç”Ÿæˆå¯†é’¥"></a>2.3 ç”Ÿæˆå¯†é’¥</h4><ol><li><p><strong>è¿›å…¥ <code>searxng</code> ç›®å½•:</strong>  ç¡®ä¿å½“å‰åœ¨ <code>/opt/docker/searxng</code> ç›®å½•ä¸‹ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /opt/docker/searxng</span><br></pre></td></tr></table></figure></li><li><p><strong>ç”Ÿæˆéšæœºå¯†é’¥å¹¶æ›¿æ¢ <code>settings.yml</code> æ–‡ä»¶ä¸­çš„é»˜è®¤å¯†é’¥:</strong>  è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">&quot;s|ultrasecretkey|<span class="subst">$(openssl rand -hex 32)</span>|g&quot;</span> searxng/settings.yml</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå‘½ä»¤ä¼šä½¿ç”¨ <code>openssl</code> ç”Ÿæˆä¸€ä¸ª 32 ä½çš„éšæœºåå…­è¿›åˆ¶å¯†é’¥ï¼Œå¹¶å°†å…¶æ›¿æ¢åˆ° <code>searxng/settings.yml</code> æ–‡ä»¶ä¸­çš„ <code>ultrasecretkey</code> å ä½ç¬¦å¤„ï¼Œä½œä¸º SearXNG çš„å®‰å…¨å¯†é’¥ã€‚</p></li></ol><h4 id="2-4-é…ç½®é˜²ç«å¢™-å¯é€‰"><a href="#2-4-é…ç½®é˜²ç«å¢™-å¯é€‰" class="headerlink" title="2.4 é…ç½®é˜²ç«å¢™ (å¯é€‰)"></a>2.4 é…ç½®é˜²ç«å¢™ (å¯é€‰)</h4><p>å¦‚æœä½¿ç”¨äº†æœåŠ¡å™¨é˜²ç«å¢™æˆ–è€…äº‘æœåŠ¡å•†æä¾›çš„å®‰å…¨ç»„ï¼Œéœ€è¦åœ¨é˜²ç«å¢™ä¸­æ·»åŠ è§„åˆ™ï¼Œ<strong>å…è®¸å¤–éƒ¨è®¿é—®åœ¨ <code>docker-compose.yml</code> æ–‡ä»¶ä¸­æ˜ å°„çš„ç«¯å£</strong> (é»˜è®¤ä¸º <code>8180</code>)ã€‚</p><ul><li><p><strong>æœåŠ¡å•†æ§åˆ¶å°:</strong>  å¦‚æœä½¿ç”¨çš„æ˜¯äº‘æœåŠ¡å™¨ (å¦‚ AWS, Azure, GCP, é˜¿é‡Œäº‘, è…¾è®¯äº‘ ç­‰)ï¼Œé€šå¸¸éœ€è¦åœ¨äº‘æœåŠ¡å•†çš„æ§åˆ¶å°ä¸­é…ç½®å®‰å…¨ç»„è§„åˆ™ï¼Œå…è®¸å…¥ç«™ TCP æµé‡è®¿é—®æœåŠ¡å™¨çš„ 8180 ç«¯å£ã€‚</p></li><li><p><strong>æœ¬åœ°é˜²ç«å¢™ (å¦‚ <code>ufw</code>, <code>firewalld</code>):</strong>  å¦‚æœåœ¨æœåŠ¡å™¨ä¸Šä½¿ç”¨äº†æœ¬åœ°é˜²ç«å¢™ï¼Œä¾‹å¦‚ <code>ufw</code> æˆ– <code>firewalld</code>ï¼Œéœ€è¦é…ç½®é˜²ç«å¢™è§„åˆ™å…è®¸ 8180 ç«¯å£çš„å…¥ç«™è¿æ¥ã€‚</p><p><strong>ä¾‹å¦‚ï¼Œä½¿ç”¨ <code>ufw</code> å…è®¸ 8180 ç«¯å£:</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> ufw allow 8180/tcp</span><br><span class="line"><span class="built_in">sudo</span> ufw reload</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„:</strong>  é˜²ç«å¢™é…ç½®æ˜¯å¯é€‰çš„ï¼Œä½†ä¸ºäº†æœåŠ¡å™¨å®‰å…¨ï¼Œå¼ºçƒˆå»ºè®®é…ç½®é˜²ç«å¢™è§„åˆ™ï¼Œåªå…è®¸å¿…è¦çš„ç«¯å£å¯¹å¤–å¼€æ”¾ã€‚  å¦‚æœä½¿ç”¨äº†åå‘ä»£ç† (å¦‚ Nginx) è¿›è¡Œç«¯å£è½¬å‘ï¼Œåˆ™éœ€è¦å¼€æ”¾åå‘ä»£ç†ç›‘å¬çš„ç«¯å£ (é€šå¸¸æ˜¯ 80 æˆ– 443)ã€‚</p></li></ul><h4 id="2-5-å¯åŠ¨-Docker-å®¹å™¨"><a href="#2-5-å¯åŠ¨-Docker-å®¹å™¨" class="headerlink" title="2.5 å¯åŠ¨ Docker å®¹å™¨"></a>2.5 å¯åŠ¨ Docker å®¹å™¨</h4><ol><li><p><strong>è¿›å…¥ <code>searxng</code> ç›®å½•:</strong>  ç¡®ä¿å½“å‰åœ¨ <code>/opt/docker/searxng</code> ç›®å½•ä¸‹ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /opt/docker/searxng</span><br></pre></td></tr></table></figure></li><li><p><strong>å¯åŠ¨ Docker å®¹å™¨:</strong>  è¿è¡Œä»¥ä¸‹å‘½ä»¤å¯åŠ¨ SearXNG å®¹å™¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure><ul><li><code>-d</code> å‚æ•°è¡¨ç¤ºåœ¨åå°è¿è¡Œå®¹å™¨ (detached mode)ã€‚</li><li>Docker Compose ä¼šè¯»å– <code>docker-compose.yml</code> æ–‡ä»¶ä¸­çš„é…ç½®ï¼Œä¸‹è½½ SearXNG é•œåƒå¹¶åˆ›å»ºå’Œå¯åŠ¨å®¹å™¨ã€‚</li></ul></li><li><p><strong>ç­‰å¾…å®¹å™¨å¯åŠ¨:</strong>  Docker é¦–æ¬¡å¯åŠ¨å¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´ä¸‹è½½é•œåƒã€‚  å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹å®¹å™¨å¯åŠ¨çŠ¶æ€ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose ps</span><br></pre></td></tr></table></figure><p>å½“ <code>searxng</code> æœåŠ¡çš„çŠ¶æ€æ˜¾ç¤ºä¸º <code>Up</code> æ—¶ï¼Œè¡¨ç¤ºå®¹å™¨å·²æˆåŠŸå¯åŠ¨ã€‚</p></li><li><p><strong>è®¿é—® SearXNG:</strong>  åœ¨æµè§ˆå™¨ä¸­è®¿é—®åœ¨ <code>.env</code> æ–‡ä»¶ä¸­é…ç½®çš„åŸŸåæˆ– IP åœ°å€å’Œç«¯å£å· (ä¾‹å¦‚ <code>http://search.example.com:8180</code> æˆ– <code>http://your_server_ip:8180</code>)ï¼Œå³å¯å¼€å§‹ä½¿ç”¨ SearXNG æœç´¢å¼•æ“ã€‚</p></li></ol><h3 id="3-ç»´æŠ¤-SearXNG"><a href="#3-ç»´æŠ¤-SearXNG" class="headerlink" title="3. ç»´æŠ¤ SearXNG"></a>3. ç»´æŠ¤ SearXNG</h3><h4 id="3-1-æ£€æµ‹ç«¯å£å ç”¨"><a href="#3-1-æ£€æµ‹ç«¯å£å ç”¨" class="headerlink" title="3.1 æ£€æµ‹ç«¯å£å ç”¨"></a>3.1 æ£€æµ‹ç«¯å£å ç”¨</h4><p>å¦‚æœåœ¨å¯åŠ¨ Docker å®¹å™¨æ—¶é‡åˆ°ç«¯å£å†²çªï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ£€æµ‹ 8180 ç«¯å£æ˜¯å¦å·²è¢«å ç”¨ï¼š<br>    <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsof -i:8180</span><br></pre></td></tr></table></figure><br>    æˆ–<br>    <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -tulnp | grep 8180</span><br></pre></td></tr></table></figure></p><p>å¦‚æœç«¯å£è¢«å ç”¨ï¼Œéœ€è¦ä¿®æ”¹ <code>docker-compose.yml</code> æ–‡ä»¶ä¸­ç«¯å£æ˜ å°„é…ç½®ï¼Œå°†å®¿ä¸»æœºç«¯å£ <code>8180</code> ä¿®æ”¹ä¸ºå…¶ä»–æœªè¢«å ç”¨çš„ç«¯å£ã€‚</p><h4 id="3-2-æ›´æ–°å®¹å™¨"><a href="#3-2-æ›´æ–°å®¹å™¨" class="headerlink" title="3.2 æ›´æ–°å®¹å™¨"></a>3.2 æ›´æ–°å®¹å™¨</h4><p>è¦æ›´æ–° SearXNG å®¹å™¨åˆ°æœ€æ–°ç‰ˆæœ¬ï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š</p><ol><li><p><strong>è¿›å…¥ <code>searxng</code> ç›®å½•:</strong>  ç¡®ä¿å½“å‰åœ¨ <code>/opt/docker/searxng</code> ç›®å½•ä¸‹ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /opt/docker/searxng</span><br></pre></td></tr></table></figure></li><li><p><strong>æ›´æ–°å®¹å™¨:</strong>  è¿è¡Œä»¥ä¸‹å‘½ä»¤æ›´æ–° SearXNG å®¹å™¨ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker compose pull &amp;&amp; docker compose up -d</span><br></pre></td></tr></table></figure><ul><li><code>docker-compose pull</code> å‘½ä»¤ä¼šæ‹‰å–æœ€æ–°çš„ SearXNG é•œåƒã€‚</li><li><code>docker-compose up -d</code> å‘½ä»¤ä¼šä½¿ç”¨æ–°çš„é•œåƒé‡æ–°åˆ›å»ºå¹¶å¯åŠ¨å®¹å™¨ï¼Œå®ç°å®¹å™¨æ›´æ–°ã€‚  Docker Compose ä¼šæ™ºèƒ½åœ°æ›´æ–°å®¹å™¨ï¼Œè€Œä¸ä¼šä¸¢å¤±æ•°æ®å·é…ç½®ã€‚</li></ul></li></ol>]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>inter 12ä»£å¤„ç†å™¨PVE Sriov æµç¨‹</title>
      <link href="/posts/e953e2f/"/>
      <url>/posts/e953e2f/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€ã€PVEå®‰è£…å‘½ä»¤è¡Œè·³è¿‡æ£€æµ‹æ–¹æ³•ï¼š"><a href="#ä¸€ã€PVEå®‰è£…å‘½ä»¤è¡Œè·³è¿‡æ£€æµ‹æ–¹æ³•ï¼š" class="headerlink" title="ä¸€ã€PVEå®‰è£…å‘½ä»¤è¡Œè·³è¿‡æ£€æµ‹æ–¹æ³•ï¼š"></a>ä¸€ã€PVEå®‰è£…å‘½ä»¤è¡Œè·³è¿‡æ£€æµ‹æ–¹æ³•ï¼š</h2><p>é…ç½®æ–‡ä»¶ä¸­åˆ›å»ºä¸€ä¸ªè®¾å¤‡æè¿°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano /usr/share/X11/xorg.conf.d/10-quirks.conf</span><br></pre></td></tr></table></figure><p>Â åœ¨ç»“å°¾æ·»åŠ ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Section &quot;Device&quot; Â Â Â </span><br><span class="line">Â Â Â Â Identifier &quot;Card0&quot; Â Â Â Â </span><br><span class="line">Â Â Â Â Driver &quot;fbdev&quot;</span><br><span class="line">EndSection</span><br></pre></td></tr></table></figure><p>ctrl+x Â y å›è½¦ä¿å­˜é€€å‡º</p><p>Â <code># xinit</code></p><p>å›è½¦è¿è¡Œåä¼šè¿›å…¥ç†Ÿæ‚‰çš„PVEå›¾å½¢åŒ–å®‰è£…ç•Œé¢ï¼Œå®‰è£…å®Œæˆã€‚</p><p>Â å¯åŠ¨PVEï¼Œè¿›å…¥WebUI</p><h2 id="äºŒã€PVEæ¢æºï¼š"><a href="#äºŒã€PVEæ¢æºï¼š" class="headerlink" title="äºŒã€PVEæ¢æºï¼š"></a>äºŒã€PVEæ¢æºï¼š</h2><h2 id="1ã€æ›´æ¢ä¸ºå›½å†…æ¸…åæºï¼š"><a href="#1ã€æ›´æ¢ä¸ºå›½å†…æ¸…åæºï¼š" class="headerlink" title="1ã€æ›´æ¢ä¸ºå›½å†…æ¸…åæºï¼š"></a>1ã€æ›´æ¢ä¸ºå›½å†…æ¸…åæºï¼š</h2><p>å°†è‡ªå¸¦çš„æºæ–‡ä»¶sources.listå¤‡ä»½</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /etc/apt/sources.list /etc/apt/sources.list_bak</span><br></pre></td></tr></table></figure><p>Â ç¼–è¾‘sources.list</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano /etc/apt/sources.list</span><br></pre></td></tr></table></figure><p>ç²˜è´´ä¸€ä¸‹å†…å®¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/debian/ bullseye main contrib non-free</span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/debian/ bullseye-updates main contrib non-free</span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/debian/ bullseye-backports main contrib non-free</span><br><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/debian-security bullseye-security main contrib non-free</span><br></pre></td></tr></table></figure><p>ctrl+x ç‚¹y å›è½¦ä¿å­˜é€€å‡º</p><p>ç¼–è¾‘pveä¼ä¸šæºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano /etc/apt/sources.list.d/pve-enterprise.list</span><br></pre></td></tr></table></figure><blockquote><p>å°†å…¶ä¸­åŸæœ‰çš„proxmoxå¥é¦–åŠ # æ³¨é‡Šæ‰ï¼Œå˜ä¸ºï¼š#deb <a href="https://enterprise.proxmox.com/debian/pve">https://enterprise.proxmox.com/debian/pve</a> bullseye pve-enterprise</p></blockquote><p>æ·»åŠ ä»¥ä¸‹æ¸…åæºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">deb https://mirrors.tuna.tsinghua.edu.cn/proxmox/debian bullseye pve-no-subscription</span><br></pre></td></tr></table></figure><p>ctrl+x Â y å›è½¦ä¿å­˜é€€å‡º</p><p>æ›´æ–°å¹¶å‡çº§</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt update &amp;&amp; apt dist-upgrade -y</span><br></pre></td></tr></table></figure><h2 id="2ã€LXCæ›´æ¢ä¸ºæ¸…åæºï¼š"><a href="#2ã€LXCæ›´æ¢ä¸ºæ¸…åæºï¼š" class="headerlink" title="2ã€LXCæ›´æ¢ä¸ºæ¸…åæºï¼š"></a>2ã€LXCæ›´æ¢ä¸ºæ¸…åæºï¼š</h2><p><a href="http://å¤‡ä»½aplinfo.pm/">å¤‡ä»½APLInfo.pm</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /usr/share/perl5/PVE/APLInfo.pm /usr/share/perl5/PVE/APLInfo.pm_back</span><br></pre></td></tr></table></figure><p>æ›´æ¢ä¸ºæ¸…åæºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i &#x27;s|http://download.proxmox.com|https://mirrors.tuna.tsinghua.edu.cn/proxmox|g&#x27; /usr/share/perl5/PVE/APLInfo.pm</span><br></pre></td></tr></table></figure><p>é‡å¯æœåŠ¡åç”Ÿæ•ˆ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart pvedaemon.service</span><br></pre></td></tr></table></figure><h2 id="ä¸‰ã€å‡çº§6-2å†…æ ¸ã€headerså’Œfirmware"><a href="#ä¸‰ã€å‡çº§6-2å†…æ ¸ã€headerså’Œfirmware" class="headerlink" title="ä¸‰ã€å‡çº§6.2å†…æ ¸ã€headerså’Œfirmware"></a>ä¸‰ã€å‡çº§6.2å†…æ ¸ã€headerså’Œfirmware</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt update</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install -y pve-kernel-6.2.11-2-pve pve-headers-6.2.11-2-pve pve-firmware</span><br></pre></td></tr></table></figure><p>é‡å¯reboot</p><h2 id="å››ã€ç¼–è¯‘i915-sriové©±åŠ¨"><a href="#å››ã€ç¼–è¯‘i915-sriové©±åŠ¨" class="headerlink" title="å››ã€ç¼–è¯‘i915-sriové©±åŠ¨"></a>å››ã€ç¼–è¯‘i915-sriové©±åŠ¨</h2><p>å®‰è£…å·¥å…·</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install -y build-* git dkms</span><br></pre></td></tr></table></figure><p>æ‹–åº“</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/strongtz/i915-sriov-dkms.git</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Â cd i915-sriov-dkms</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Â nano dkms.conf</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€è¡Œæ”¹ä¸º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PACKAGE_NAME=&quot;i915-sriov-dkms&quot;</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒè¡Œæ”¹ä¸º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PACKAGE_VERSION=&quot;6.2&quot;</span><br></pre></td></tr></table></figure><p>ctrl+x Â y å›è½¦ä¿å­˜é€€å‡º</p><p>å¤åˆ¶æ­¤æ–‡ä»¶å¤¹åˆ°ç›¸åº”ç›®å½•ï¼Œå¼€å§‹ç¼–è¯‘</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp -r /root/i915-sriov-dkms/ /usr/src/i915-sriov-dkms-6.2</span><br></pre></td></tr></table></figure><p>è¿›å…¥ç›®å½•</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/src/i915-sriov-dkms-6.2</span><br></pre></td></tr></table></figure><p>pve7.xæ‰§è¡Œç¼–è¯‘å‘½ä»¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dkms install -m i915-sriov-dkms -v 6.2</span><br></pre></td></tr></table></figure><p>pve8.0æ‰§è¡Œç¼–è¯‘å‘½ä»¤</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dkms install -m i915-sriov-dkms -v 6.2 --force</span><br></pre></td></tr></table></figure><p>Â ç¼–è¯‘å®Œæˆåæ£€æŸ¥çŠ¶æ€</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dkms status</span><br></pre></td></tr></table></figure><h2 id="äº”ã€è®¾ç½®ç›´é€šå’Œi915guc"><a href="#äº”ã€è®¾ç½®ç›´é€šå’Œi915guc" class="headerlink" title="äº”ã€è®¾ç½®ç›´é€šå’Œi915guc"></a>äº”ã€è®¾ç½®ç›´é€šå’Œi915guc</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano /etc/default/grub</span><br></pre></td></tr></table></figure><p>åœ¨quietåæ·»åŠ <code>intel_iommu=on i915.enable_guc=3 i915.max_vfs=7</code></p><blockquote><p>æ”¹æˆGRUB_CMDLINE_LINUX_DEFAULT&#x3D;â€quiet intel_iommu&#x3D;on i915.enable_guc&#x3D;3 i915.max_vfs&#x3D;7â€</p></blockquote><p>ctrl+x Â y å›è½¦ä¿å­˜é€€å‡º</p><p>é¡ºä¾¿æŠŠè®¾å¤‡ç›´é€šçš„å…¶ä»–æ“ä½œä¸€èµ·åšäº†ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano /etc/modules</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vfio</span><br><span class="line"></span><br><span class="line">vfio_iommu_type1</span><br><span class="line"></span><br><span class="line">vfio_pci</span><br><span class="line"></span><br><span class="line">vfio_virqfd</span><br></pre></td></tr></table></figure><p>æ›´æ–°é…ç½®</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">update-grub</span><br><span class="line"></span><br><span class="line">update-initramfs -u</span><br></pre></td></tr></table></figure><h2 id="å…­ã€å®‰è£…sysfsutils"><a href="#å…­ã€å®‰è£…sysfsutils" class="headerlink" title="å…­ã€å®‰è£…sysfsutils"></a>å…­ã€å®‰è£…sysfsutils</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install -y sysfsutils</span><br></pre></td></tr></table></figure><p>æ·»åŠ ä»¥ä¸‹VFså‚æ•°ï¼ŒN100å»ºè®®æœ€é«˜3ï¼Œå¯è‡ªå®šä¹‰æ•°é‡ï¼Œå»ºè®®æŒ‰éœ€è®¾ç½®ï¼Œè®¾ç½®1ä¸ªæ—¶æ€§èƒ½æœ€å¼ºã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;devices/pci0000:00/0000:00:02.0/sriov_numvfs = 3&quot; &gt; /etc/sysfs.conf</span><br></pre></td></tr></table></figure><p>é‡å¯reboot</p><p>lspciæ£€æŸ¥ç›´é€šçš„è™šæ‹Ÿæ˜¾å¡ï¼Œæ˜¾ç¤ºå¦‚ä¸‹ï¼š</p><p>00:02.0 VGA compatible controller: Intel Corporation Device 46d1ï¼ˆç‰©ç†æ ¸æ˜¾ï¼‰</p><p>00:02.1 VGA compatible controller: Intel Corporation Device 46d1ï¼ˆè™šæ‹Ÿæ ¸æ˜¾1ï¼‰</p><p>00:02.2 VGA compatible controller: Intel Corporation Device 46d1ï¼ˆè™šæ‹Ÿæ ¸æ˜¾2ï¼‰</p><p>00:02.3 VGA compatible controller: Intel Corporation Device 46d1ï¼ˆè™šæ‹Ÿæ ¸æ˜¾3ï¼‰</p><p>æ³¨æ„è™šæ‹Ÿæ ¸æ˜¾è¶Šå¤šï¼Œæ€§èƒ½è¶Šä½ã€‚åªéœ€è¦1ä¸ªæ—¶ï¼Œè™šæ‹Ÿ1ä¸ªæ ¸æ˜¾å³å¯ã€‚å°±åƒåˆ‡è¥¿ç“œï¼Œæ•´ä½“å°±è¿™ä¹ˆå¤§ï¼Œäººæ•°è¶Šå¤šæ¯ä¸ªäººåˆ†åˆ°çš„ç“œè¶Šå°ã€‚</p><h2 id="ä¸ƒã€å°†è™šæ‹Ÿæ ¸æ˜¾æ·»åŠ åˆ°è™šæ‹Ÿæœºä¸­ï¼Œå¦‚Win10-11"><a href="#ä¸ƒã€å°†è™šæ‹Ÿæ ¸æ˜¾æ·»åŠ åˆ°è™šæ‹Ÿæœºä¸­ï¼Œå¦‚Win10-11" class="headerlink" title="ä¸ƒã€å°†è™šæ‹Ÿæ ¸æ˜¾æ·»åŠ åˆ°è™šæ‹Ÿæœºä¸­ï¼Œå¦‚Win10&#x2F;11"></a>ä¸ƒã€å°†è™šæ‹Ÿæ ¸æ˜¾æ·»åŠ åˆ°è™šæ‹Ÿæœºä¸­ï¼Œå¦‚Win10&#x2F;11</h2><blockquote><p>ç¡¬ä»¶å†…æ³¨æ„äº‹é¡¹ï¼š</p><p>å†…å­˜ï¼š4GiB ï¼ˆæˆ–è€…æ›´å¤šï¼‰</p><p>CPUç±»åˆ«ï¼šhost ï¼ˆç¡¬è§£å»ºè®®ç»™å…¨éƒ¨æ ¸å¿ƒï¼Œæ¯”å¦‚N100 4coresï¼‰</p><p>BIOSï¼šOVMF(UEFI)</p><p>æ˜¾ç¤ºï¼šé»˜è®¤æ ‡å‡† æ ¸æ˜¾ç›´é€šåå¯æ”¹ä¸ºæ— (none) *æ³¨æ„é€‰æ‹©æ— (none)æ—¶é•¿æ—¶é—´è¿è¡Œä¼šå‡ºé—®é¢˜ã€VM 100 qmp command â€˜set_passwordâ€™ failed - Could not set passwordã€‘å¯¼è‡´è™šæ‹ŸWinæ­»æœºæ—¶ï¼Œåˆ™éœ€æ”¹ä¸ºæ ‡å‡†VGA(std)</p><p>æœºå‹ï¼špc-q35-7.2</p><p>PCIè®¾å¤‡è™šæ‹Ÿæ ¸æ˜¾ï¼šå®‰è£…Winæ—¶å»ºè®®ä¸æ·»åŠ ï¼ŒWinè£…å®Œå…³æœºæ·»åŠ è™šæ‹Ÿæ ¸æ˜¾æ—¶ä¸è¦å‹¾é€‰ä¸»GPUï¼Œå®‰è£…é©±åŠ¨å¹¶é‡å¯åä¸æŠ¥é”™å·¥ä½œæ­£å¸¸åï¼Œå¯ä»¥æ›´æ”¹ä¸ºä¸»GPU</p></blockquote><p>Windowsè™šæ‹Ÿæœº</p><p>ä¸ºäº†æé«˜Winè™šæ‹Ÿæœºçš„æ€§èƒ½ï¼Œå»ºè®®å®‰è£…VirtIOçš„å…¨éƒ¨é©±åŠ¨ï¼Œisoä¸‹è½½åœ°å€ï¼š</p><p><a href="https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/archive-virtio/virtio-win-0.1.229-1/virtio-win-0.1.229.iso">https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/archive-virtio/virtio-win-0.1.229-1/virtio-win-0.1.229.iso</a></p><p>åœ¨å¿…é¡»æ»¡è¶³è™šæ‹Ÿæœºé…ç½®çš„å‰æä¸‹ï¼Œå®‰è£…å½“å‰æœ€æ–°çš„é©±åŠ¨ï¼Œä¸‹é¢2ä¸ªï¼ŒäºŒé€‰ä¸€è‡ªè¡Œæµ‹è¯•ã€‚</p><p>è‹±ç‰¹å°”Â® Arcâ„¢ å’Œé”ç‚¬Â® Xe æ˜¾å¡ - WHQL - Windows* (<a href="http://intel.cn/">intel.cn</a>)</p><p><a href="https://www.intel.cn/content/www/cn/zh/download/726609/intel-arc-iris-xe-graphics-whql-windows.html">https://www.intel.cn/content/www/cn/zh/download/726609/intel-arc-iris-xe-graphics-whql-windows.html</a>?</p><p>è‹±ç‰¹å°”Â® Arcâ„¢ å’Œé”Â®ç‚¬Â® Xe æ˜¾å¡ - BETA - Windows* (<a href="http://intel.cn/">intel.cn</a>)</p><p><a href="https://www.intel.cn/content/www/cn/zh/download/729157/intel-arc-iris-xe-graphics-beta-windows.html">https://www.intel.cn/content/www/cn/zh/download/729157/intel-arc-iris-xe-graphics-beta-windows.html</a></p><p>Linuxè™šæ‹Ÿæœºï¼š</p><p>è™šæ‹ŸUbuntuç›´é€šSRIOVæ ¸æ˜¾å‚ç…§ä»¥ä¸‹â€œLinuxè™šæ‹Ÿæœºâ€éƒ¨åˆ†</p><p><a href="https://foxi.buduanwang.vip/virtualization/pve/2695.html/">https://foxi.buduanwang.vip/virtualization/pve/2695.html/</a></p><p>è™šæ‹ŸDeibanç›´é€šSRIOVæ ¸æ˜¾å‚ç…§ä»¥ä¸‹â€œLinuxè™šæ‹Ÿæœºä½¿ç”¨pveå†…æ ¸â€“ä¸é€‚ç”¨å…¨éƒ¨æƒ…å†µâ€</p><p><a href="https://foxi.buduanwang.vip/virtualization/pve/2695.html/">https://foxi.buduanwang.vip/virtualization/pve/2695.html/</a></p><p>è‹±ç‰¹å°”å®˜ç½‘æ ¸æ˜¾é©±åŠ¨æ–¹æ³•<a href="https://dgpu-docs.intel.com/installation-guides/ubuntu/ubuntu-focal-legacy.html#">https://dgpu-docs.intel.com/installation-guides/ubuntu/ubuntu-focal-legacy.html#</a></p><blockquote><p>å‚è€ƒå¼•ç”¨ï¼š</p><p><a href="https://github.com/strongtz/i915-sriov-dkms">https://github.com/strongtz/i915-sriov-dkms</a></p><p><a href="https://foxi.buduanwang.vip/virtualization/pve/2695.html/">https://foxi.buduanwang.vip/virtualization/pve/2695.html/</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> PVE </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PVE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ©ç”¨CloudflareTunnel ä¸Šçº¿æœ¬åœ°æœåŠ¡ï¼Œæ— éœ€å¤‡æ¡ˆï¼Œå…¬ç½‘æœåŠ¡å™¨ï¼Œç™½å«–ç¦éŸ³</title>
      <link href="/posts/4c6703cc/"/>
      <url>/posts/4c6703cc/</url>
      
        <content type="html"><![CDATA[<blockquote><h3 id="å‰æœŸå‡†å¤‡"><a href="#å‰æœŸå‡†å¤‡" class="headerlink" title="å‰æœŸå‡†å¤‡"></a>å‰æœŸå‡†å¤‡</h3><ol><li>ä¸€ä¸ªè§£æåˆ°cloud flareçš„åŸŸå ï¼ˆæ•™ç¨‹è¯·è‡ªè¡Œæœç´¢ï¼‰</li><li>ä¸€å¼ å¤–å¸ä¿¡ç”¨å¡æˆ–è€… PayPal<br><del>æ¨èä¸€ä¸ªè™šæ‹Ÿä¿¡ç”¨å¡ <a href="https://card.onekey.so/?i=ZEIPBH">Onekey</a></del></li></ol></blockquote><h3 id="1-å¼€é€š-CloudFlare-Tunnel"><a href="#1-å¼€é€š-CloudFlare-Tunnel" class="headerlink" title="1. å¼€é€š CloudFlare Tunnel"></a>1. <strong>å¼€é€š</strong> <a href="https://one.dash.cloudflare.com/"><strong>CloudFlare Tunnel</strong></a></h3><p><img src="https://cloudflare.free-img.ososo.org/file/1732424604409_image-uvix.png"></p><h3 id="2-ç»‘å®šä¸€ä¸ªæ”¯ä»˜æ–¹å¼ï¼Œé€‰æ‹©å…è´¹å¥—é¤ï¼ŒåªåšéªŒè¯ä¸ä¼šæ‰£æ¬¾"><a href="#2-ç»‘å®šä¸€ä¸ªæ”¯ä»˜æ–¹å¼ï¼Œé€‰æ‹©å…è´¹å¥—é¤ï¼ŒåªåšéªŒè¯ä¸ä¼šæ‰£æ¬¾" class="headerlink" title="2. ç»‘å®šä¸€ä¸ªæ”¯ä»˜æ–¹å¼ï¼Œé€‰æ‹©å…è´¹å¥—é¤ï¼ŒåªåšéªŒè¯ä¸ä¼šæ‰£æ¬¾"></a>2. ç»‘å®šä¸€ä¸ªæ”¯ä»˜æ–¹å¼ï¼Œé€‰æ‹©å…è´¹å¥—é¤ï¼ŒåªåšéªŒè¯ä¸ä¼šæ‰£æ¬¾</h3><p><img src="https://cloudflare.free-img.ososo.org/file/1732424733548_image-bdlg.png"></p><h3 id="3-åˆ›å»ºTunnels-éš§é“"><a href="#3-åˆ›å»ºTunnels-éš§é“" class="headerlink" title="3. åˆ›å»ºTunnels éš§é“"></a>3. åˆ›å»º<strong>Tunnels éš§é“</strong></h3><p><img src="https://cloudflare.free-img.ososo.org/file/1732424855800_image-etzj.png"><br><img src="https://cloudflare.free-img.ososo.org/file/1732424907922_image-lvmu.png"></p><h3 id="4-é€‰æ‹©å®‰è£…ç¯å¢ƒ"><a href="#4-é€‰æ‹©å®‰è£…ç¯å¢ƒ" class="headerlink" title="4. é€‰æ‹©å®‰è£…ç¯å¢ƒ"></a>4. é€‰æ‹©å®‰è£…ç¯å¢ƒ</h3><p><img src="https://cloudflare.free-img.ososo.org/file/1732425031804_image-ctxy.png"></p><h4 id="è¿™é‡Œä»¥Dockerä¸ºæ¼”ç¤º"><a href="#è¿™é‡Œä»¥Dockerä¸ºæ¼”ç¤º" class="headerlink" title="è¿™é‡Œä»¥Dockerä¸ºæ¼”ç¤º"></a>è¿™é‡Œä»¥Dockerä¸ºæ¼”ç¤º</h4><p><img src="https://cloudflare.free-img.ososo.org/file/1732425110132_image-yxba.png">åœ¨å®‰è£…æœ‰<code>docker</code>çš„ä¸»æœºä¸Šæ‰§è¡Œä¸Šé¢çš„å‘½ä»¤ï¼Œå®Œæˆå<strong>Status æ˜¾ç¤ºä¸ºå¥åº·</strong>å³å¯æ¥ç€ä¸‹ä¸€æ­¥<br><img src="https://cloudflare.free-img.ososo.org/file/1732425233239_image-dqld.png"></p><h3 id="5-ä¸Šçº¿å†…ç½‘æœåŠ¡"><a href="#5-ä¸Šçº¿å†…ç½‘æœåŠ¡" class="headerlink" title="5. ä¸Šçº¿å†…ç½‘æœåŠ¡"></a>5. ä¸Šçº¿å†…ç½‘æœåŠ¡</h3><ol><li><p>é€‰æ‹©åˆšæ‰åˆ›å»ºçš„éš§é“<br><img src="https://cloudflare.free-img.ososo.org/file/1732425312197_image-guzj.png" alt="image-guzj.png">ç‚¹å‡» Add a public * åˆ›å»ºæœåŠ¡</p></li><li><p>å¡«å†™äºŒçº§åŸŸåä»¥åŠä½ æœ¬åœ°é¡¹ç›®çš„åœ°å€ï¼Œä¹‹åä¿å­˜å³å¯ã€‚<br><img src="https://cloudflare.free-img.ososo.org/file/1732425415007_image-mnie.png"><br> <strong><strong>æ³¨æ„ä½ æœ¬åœ°é¡¹ç›®çš„é€šè®¯ç±»å‹</strong> <em><strong>HTTP</strong></em> <em><strong>HTTPS</strong></em></strong></p></li></ol><h4 id="é¢„è§ˆ"><a href="#é¢„è§ˆ" class="headerlink" title="é¢„è§ˆ"></a>é¢„è§ˆ</h4><p><img src="https://cloudflare.free-img.ososo.org/file/1732425556897_image-xtoz.png" alt="image-xtoz.png"></p><blockquote><p>å¯ä»¥åˆ©ç”¨<code>Access</code>ç»™ä½ çš„ç½‘ç«™æ·»åŠ å¯†ç <br><img src="https://cloudflare.free-img.ososo.org/file/1732425688555_image-tdrd.png"></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Cloudflare </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Cloudflare </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
